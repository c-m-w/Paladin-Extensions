<?xml version="1.0" encoding="utf-8"?>
<templates>
  <template type="admin" title="mjst_department_delete" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('confirm_action') }}</xf:title>

<xf:form action="{{ link('mjst-support/departments/delete', $department) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">
				{{ phrase('please_confirm_that_you_want_to_delete_following:') }}
				<strong><a href="{{ link('mjst-support/departments/edit', $department) }}">{$department.title}</a></strong>
			</xf:inforow>
		</div>
		<xf:submitrow rowtype="simple" icon="delete" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_department_edit" version_id="3000034" version_string="3.0.0"><![CDATA[<xf:if is="$department.isInsert()">
	<xf:title>{{ phrase('mjst_add_department') }}</xf:title>
<xf:else />
	<xf:title>{{ phrase('mjst_edit_department:') }} {$department.title}</xf:title>
</xf:if>

<xf:pageaction if="$department.isUpdate()">
	<xf:button href="{{ link('mjst-support/departments/delete', $department) }}" icon="delete" overlay="true" />
</xf:pageaction>

<xf:form action="{{ link('mjst-support/departments/save', $department) }}" ajax="true" class="block">
	<div class="block-container">
		<div class="block-body">
			<xf:textboxrow name="title" value="{$department.title}" label="{{ phrase('title') }}" />
			<xf:textarearow name="short_description" value="{$department.short_description}" label="{{ phrase('description') }}"
				hint="{{ phrase('you_may_use_html') }}" autosize="true"/>

			<xf:macro template="display_order_macros" name="row"
				arg-value="{$department.display_order}" />

			<xf:if is="$availableFields is not empty">
				<hr class="formRowSep" />

				<xf:checkboxrow name="available_fields" value="{$department.field_cache}" listclass="field listColumns"
					label="{{ phrase('available_fields') }}">

					<xf:options source="$availableFields" />
					<xf:hint>
						<xf:checkbox standalone="true">
							<xf:option check-all=".field.listColumns">{{ phrase('select_all') }}</xf:option>
						</xf:checkbox>
					</xf:hint>
				</xf:checkboxrow>
			<xf:else />
				<hr class="formRowSep" />

				<xf:formrow label="{{ phrase('available_fields') }}">
					{{ phrase('none')|parens }} <a href="{{ link('mjst-support/fields') }}" target="_blank">{{ phrase('add_field') }}</a>
				</xf:formrow>
			</xf:if>

			<xf:if is="$availablePrefixes is not empty">
				<hr class="formRowSep" />

				<xf:checkboxrow name="available_prefixes" value="{$department.prefix_cache}" listclass="prefix listColumns"
					label="{{ phrase('available_prefixes') }}">

					<xf:options source="$availablePrefixes" />
					<xf:hint>
						<xf:checkbox standalone="true">
							<xf:option check-all=".prefix.listColumns">{{ phrase('select_all') }}</xf:option>
						</xf:checkbox>
					</xf:hint>
				</xf:checkboxrow>

				<xf:checkboxrow name="require_prefix" value="{$department.require_prefix}">
					<xf:option value="1"
						label="{{ phrase('require_users_to_select_prefix') }}"
						hint="{{ phrase('mjst_if_selected_users_required_select_prefix_when_creating_editing') }}" />
				</xf:checkboxrow>

			<xf:else />

				<hr class="formRowSep" />

				<xf:formrow label="{{ phrase('available_prefixes') }}">
					{{ phrase('none')|parens }} <a href="{{ link('mjst-support/prefixes') }}" target="_blank">{{ phrase('add_prefix') }}</a>
				</xf:formrow>

			</xf:if>

		</div>
		<xf:submitrow icon="save" sticky="true" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_department_list" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('mjst_departments') }}</xf:title>

<xf:pageaction>
	<xf:button href="{{ link('mjst-support/departments/add') }}" icon="add">{{ phrase('mjst_add_department') }}</xf:button>
</xf:pageaction>

<xf:if is="$departments is not empty">
	<xf:form action="{{ link('mjst-support/departments/toggle') }}" class="block" ajax="true">
		<div class="block-outer">
			<xf:macro template="filter_macros" name="quick_filter" arg-key="mjst-department" arg-class="block-outer-opposite" />
		</div>
		<div class="block-container">
			<div class="block-body">
				<xf:datalist>
					<xf:foreach loop="$departments" value="$department">
						<xf:datarow>
							<xf:cell class="dataList-cell--link dataList-cell--main" hash="{$department.department_id}">
								<a href="{{ link('mjst-support/departments/edit', $department) }}">
									<div class="dataList-mainRow">{$department.title}</div>
								</a>
							</xf:cell>
							<xf:action
								class="{{ {$customPermissions.{$department.department_id}} ? 'dataList-cell--highlighted' : '' }}"
								href="{{ link('mjst-support/departments/permissions', $department) }}">
								{{ phrase('permissions') }}
							</xf:action>
							<xf:action
								href="{{ link('mjst-support/departments/members', $department) }}">
								{{ phrase('mjst_members') }}
							</xf:action>
							<xf:delete href="{{ link('mjst-support/departments/delete', $department) }}" />
						</xf:datarow>
					</xf:foreach>
				</xf:datalist>
			</div>
		</div>
	</xf:form>
<xf:else />
	<div class="blockMessage">{{ phrase('no_items_have_been_created_yet') }}</div>
</xf:if>]]></template>
  <template type="admin" title="mjst_department_member" version_id="3000031" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_department_members:') }} {$department.title}</xf:title>

<xf:pageaction>
	<xf:button href="{{ link('mjst-support/departments/members/add', $department) }}" icon="add">{{ phrase('mjst_add_member') }}</xf:button>
</xf:pageaction>

<xf:if is="$users is not empty">
	<xf:form action="{{ link('mjst-support/departments/members', $department) }}" class="block">
		<xf:if is="!$showingAll">
			<div class="block-outer">
				<div class="block-outer-main">
					<xf:button class="button--link menuTrigger" data-xf-click="menu" aria-expanded="false" aria-haspopup="true">
						{{ phrase('sort_by:') }} {{ $sortOptions.{$order} ?: phrase('user_name') }}
					</xf:button>

					<div class="menu" data-menu="menu" aria-hidden="true">
						<div class="menu-content">
							<h3 class="menu-header">{{ phrase('sort_by...') }}</h3>
							<xf:foreach loop="$sortOptions" key="$sortKey" value="$sortName">
								<a href="{{ link('mjst-support/departments/members', $department, {'criteria': $criteria, 'order': $sortKey}) }}"
									class="menu-linkRow {{ $order == $sortKey ? 'is-selected' : '' }}">
									{$sortName}
								</a>
							</xf:foreach>
						</div>
					</div>
				</div>
				<xf:macro template="filter_macros" name="quick_filter" arg-key="users"
					arg-ajax="{{ link('mjst-support/departments/members', $department, {'criteria': $criteria}) }}"
					arg-class="block-outer-opposite" />
			</div>
		</xf:if>
		<div class="block-container">
			<div class="block-body">
				<xf:datalist>
					<xf:foreach loop="$users" value="$user">
						<xf:datarow>
							<xf:cell class="dataList-cell--min dataList-cell--image dataList-cell--imageSmall"
								href="{{ link('mjst-support/departments/members/edit', $department, {'user_id': $user.user_id}) }}">
								<xf:avatar user="$user" size="s" href="" />
							</xf:cell>
							<xf:main href="{{ link('mjst-support/departments/members/edit', $department, {'user_id': $user.user_id}) }}" label="{$user.username}"
								hint="{$user.email}" />
							<xf:delete href="{{ link('mjst-support/departments/members/remove', $department, {'user_id': $user.user_id}) }}" />
						</xf:datarow>
					</xf:foreach>
					<xf:if is="$filter AND $total > $perPage">
						<xf:datarow rowclass="dataList-row--note dataList-row--noHover js-filterForceShow">
							<xf:cell colspan="3">{{ phrase('more_records_matching_filter_more_specific') }}
							</xf:cell>
						</xf:datarow>
					</xf:if>
				</xf:datalist>
			</div>
			<div class="block-footer block-footer--split">
				<span class="block-footer-counter">{{ display_totals($users, $total) }}</span>
			</div>
		</div>

		<xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}"
			link="mjst-support/departments/members"
			params="{{ {'criteria': $criteria, 'order': $order, 'direction': $direction} }}"
			wrapperclass="js-filterHide block-outer block-outer--after" />
	</xf:form>
<xf:else />
	<div class="blockMessage">{{ phrase('no_records_matched') }}</div>
</xf:if>]]></template>
  <template type="admin" title="mjst_department_member_edit" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:if is="!$user.user_id">
	<xf:title>{{ phrase('mjst_add_member') }}</xf:title>
<xf:else />
	<xf:title>{{ phrase('mjst_edit_member:') }} {$user.username}</xf:title>
</xf:if>

<xf:pageaction if="$user.user_id">
	<xf:button href="{{ link('mjst-support/departments/members/remove', $department, {'user_id': $user.user_id}) }}" icon="delete" overlay="true" />
</xf:pageaction>

<xf:form action="{{ link('mjst-support/departments/members/save', $department) }}" ajax="true" class="block"
	data-xf-init="permission-form"
	data-permission-type="global">

	<div class="block-container">
		<div class="block-body">
			<xf:if is="{$user.user_id}">
				<xf:formrow label="{{ phrase('mjst_member') }}">
					{$user.username}
				</xf:formrow>
			<xf:else />
				<xf:textboxrow name="username" ac="single" value="{$user.username}"
					label="{{ phrase('mjst_user') }}" />
			</xf:if>
		</div>

		<xf:js src="xf/permission.js" min="1" />
		<xf:css src="permission.less" />

		<xf:macro template="permission_macros" name="content_edit_groups"
			arg-interfaceGroups="{$permissionData.interfaceGroups}"
			arg-permissionsGrouped="{$permissionData.permissionsGrouped}"
			arg-values="{$permissionData.values}" />

		<xf:hiddenval name="user_id">{$user.user_id}</xf:hiddenval>
		<xf:submitrow icon="save" sticky="true" />
	</div>

</xf:form>]]></template>
  <template type="admin" title="mjst_department_member_remove" version_id="3000032" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_remove_member:') }} {$user.username}</xf:title>

<xf:form action="{{ link('mjst-support/departments/members/remove', $department) }}" ajax="true" class="block"
	data-xf-init="permission-form"
	data-permission-type="global">

	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">
				{{ phrase('mjst_please_confirm_that_you_want_to_remove_following_member:') }}
				<strong><a href="{{ link('mjst-support/departments/edit', $department) }}">{$user.username}</a></strong>
			</xf:inforow>
		</div>

		<xf:js src="xf/permission.js" min="1" />
		<xf:css src="permission.less" />

		<xf:macro template="permission_macros" name="content_edit_groups"
			arg-interfaceGroups="{$permissionData.interfaceGroups}"
			arg-permissionsGrouped="{$permissionData.permissionsGrouped}"
			arg-values="{$permissionData.values}" />

		<xf:hiddenval name="user_id">{$user.user_id}</xf:hiddenval>
		<xf:submitrow icon="delete" sticky="true" />
	</div>

</xf:form>]]></template>
  <template type="admin" title="mjst_department_permission_edit" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:if is="$userGroup">
	<xf:title>{$userGroup.title}</xf:title>
<xf:else />
	<xf:title>{$user.username}</xf:title>
</xf:if>

<xf:breadcrumb href="{{ link('mjst-support/departments/permissions', $record) }}">{{ phrase('permissions:') }} {$record.title}</xf:breadcrumb>

<xf:macro template="mjst_permission_department_macros" name="edit"
	arg-department="{$record}"
	arg-permissionData="{$permissionData}"
	arg-typeEntries="{$typeEntries}"
	arg-routeBase="mjst-support/departments/permissions"
	arg-saveParams="{$saveParams}" />]]></template>
  <template type="admin" title="mjst_department_permission_list" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('permissions:') }} {$record.title}</xf:title>

<xf:macro template="mjst_permission_department_macros" name="list"
	arg-department="{$record}"
	arg-isPrivate="{$isPrivate}"
	arg-userGroups="{$userGroups}"
	arg-users="{$users}"
	arg-entries="{$entries}"
	arg-routeBase="mjst-support/departments/permissions" />]]></template>
  <template type="admin" title="mjst_department_prefixes" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:macro template="prefix_macros" name="select"
	arg-name="na"
	arg-prefixes="{$prefixes}"
	arg-type="support_ticket" />]]></template>
  <template type="admin" title="mjst_kb_category_delete" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('confirm_action') }}</xf:title>

<xf:form action="{{ link('mjst-support/kb/category/delete', $kbCategory) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">
				{{ phrase('please_confirm_that_you_want_to_delete_following:') }}
				<strong><a href="{{ link('mjst-support/kb/category/edit', $kbCategory) }}">{$kbCategory.title}</a></strong>
			</xf:inforow>
		</div>
		<xf:submitrow rowtype="simple" icon="delete" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_kb_category_edit" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:if is="$kbCategory.isInsert()">
	<xf:title>{{ phrase('mjst_add_kb_category') }}</xf:title>
<xf:else />
	<xf:title>{{ phrase('mjst_edit_kb_category:') }} {$kbCategory.title}</xf:title>
</xf:if>

<xf:pageaction if="$kbCategory.isUpdate()">
	<xf:button href="{{ link('mjst-support/kb/category/delete', $kbCategory) }}" icon="delete" overlay="true" />
</xf:pageaction>

<xf:form action="{{ link('mjst-support/kb/category/save', $kbCategory) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:textboxrow name="title" value="{{ $kbCategory.kb_category_id ? $kbCategory.title : '' }}" label="{{ phrase('title') }}" />
			<xf:textboxrow name="description" value="{$kbCategory.description}" label="{{ phrase('description') }}" />

			<xf:macro template="display_order_macros" name="row"
				arg-value="{$kbCategory.display_order}" />
		</div>
		<xf:submitrow icon="save" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_kb_delete" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('confirm_action') }}</xf:title>

<xf:form action="{{ link('mjst-support/kb/delete', $kb) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">
				{{ phrase('please_confirm_that_you_want_to_delete_following:') }}
				<strong><a href="{{ link('mjst-support/kb/edit', $kb) }}">{$kb.title}</a></strong>
			</xf:inforow>
		</div>
		<xf:submitrow rowtype="simple" icon="delete" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_kb_edit" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:if is="$kb.isInsert()">
	<xf:title>{{ phrase('mjst_add_kb') }}</xf:title>
<xf:else />
	<xf:title>{{ phrase('mjst_edit_kb:') }}</xf:title>
</xf:if>

<xf:pageaction if="$kb.isUpdate()">
	<xf:button href="{{ link('mjst-support/kb/delete', $kb) }}" icon="delete" overlay="true" />
</xf:pageaction>

<xf:macro name="kb_categories" arg-kb="!" arg-kbCategories="!" arg-withRow="1">
	<xf:if is="$withRow">
		<xf:selectrow label="{{ phrase('mjst_kb_category') }}" name="kb_category_id" value="{$kb.kb_category_id}">
			<xf:option value="" label="{{ phrase('(none)') }}" />
			<xf:options source="{$kbCategories}" />
		</xf:selectrow>
	<xf:else />
		<xf:select name="kb_category_id" value="{$kb.kb_category_id}">
			<xf:option value="" label="{{ phrase('(none)') }}" />
			<xf:options source="{$kbCategories}" />
		</xf:select>
	</xf:if>
</xf:macro>
<xf:form action="{{ link('mjst-support/kb/save', $kb) }}" ajax="true" class="block">
	<div class="block-container">
		<div class="block-body">
			<xf:textboxrow name="username" ac="single" value="{{ $kb.User ? $kb.User.username : $xf.visitor.username}}"
				label="{{ phrase('mjst_creator') }}" />

			<xf:textboxrow name="title" value="{$kb.title}" label="{{ phrase('title') }}" />

			<xf:macro name="kb_categories" arg-kb="{$kb}" arg-kbCategories="{$kbCategories}" />

			<hr class="formRowSep" />
			<div data-xf-init="attachment-manager">
				<xf:editorrow name="message" value="{$kb.message}" label="{{ phrase('message') }}"
					attachments="{{ !empty({$attachmentData.attachments}) ? {$attachmentData.attachments} : [] }}"
					data-min-height="200" />
				<xf:formrow>
					<xf:if is="$attachmentData">
						<xf:macro template="public:helper_attach_upload" name="upload_block"
							arg-attachmentData="{$attachmentData}" />
					</xf:if>
				</xf:formrow>
			</div>
			<hr class="formRowSep" />

			<xf:macro template="display_order_macros" name="row"
				arg-value="{$kb.display_order}" />

			<xf:checkboxrow>
				<xf:option name="is_active" label="{{ phrase('mjst_active') }}" selected="{$kb.is_active}" />
			</xf:checkboxrow>
		</div>
		<xf:submitrow sticky="true" icon="save" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_kb_list" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_knowledge_bases') }}</xf:title>

<xf:pageaction>
	<div class="buttonGroup">
		<xf:button href="{{ link('mjst-support/kb/add') }}" icon="add">{{ phrase('mjst_add_kb') }}</xf:button>
		<xf:button href="{{ link('mjst-support/kb/category/add') }}" icon="add" overlay="true">{{ phrase('mjst_add_kb_category') }}</xf:button>
	</div>
</xf:pageaction>

<xf:if is="$kbsGrouped is not empty OR count($kbCategories) > 1">
	<xf:form action="{{ link('mjst-support/kb/toggle') }}" ajax="true" class="block">
		<div class="block-outer">
			<xf:macro template="filter_macros" name="quick_filter" arg-key="mjst-support/kb" arg-class="block-outer-opposite" />
		</div>
		<div class="block-container">
			<div class="block-body">
				<xf:datalist>
					<xf:foreach loop="$kbCategories" key="$kbCategoryId" value="$kbCategory">
						<tbody class="dataList-rowGroup" id="js-kbCategory{$kbCategoryId}">
						<xf:if is="{{ count($kbCategories) > 1 }}">
							<xf:datarow rowtype="subsection" rowclass="{{ !$kbCategoryId ? 'dataList-row--noHover' : '' }}">
								<xf:if is="{{ $kbCategoryId > 0 }}">
									<xf:cell href="{{ link('mjst-support/kb/category/edit', $kbCategory) }}" overlay="true">
										{$kbCategory.title}
									</xf:cell>
									<xf:cell>&nbsp;</xf:cell>
									<xf:delete href="{{ link('mjst-support/kb/category/delete', $kbCategory) }}" />
								<xf:elseif is="{{ count($kbsGrouped.{$kbCategoryId}) }}" />
									<xf:cell>{{ phrase('(ungrouped)') }}</xf:cell>
									<xf:cell>&nbsp;</xf:cell>
									<xf:cell>&nbsp;</xf:cell>
								</xf:if>
							</xf:datarow>
						</xf:if>
						<xf:foreach loop="{$kbsGrouped.{$kbCategoryId}}" key="$kbId" value="$kb">
							<xf:datarow rowclass="kbCategory{$kbCategoryId}{{ !$kb.is_active?' dataList-row--disabled':'' }}">
								<xf:cell href="{{ link('mjst-support/kb/edit', $kb) }}" class="dataList-cell" hash="{$kb.kb_id}">
									{$kb.title}
								</xf:cell>
								<xf:toggle name="is_active[{$kb.kb_id}]"
									selected="$kb.is_active"
									class="dataList-cell--separated" submit="true" />
								<xf:delete href="{{ link('mjst-support/kb/delete', $kb) }}" />
							</xf:datarow>
						<xf:else />
							<xf:if is="{{ count($kbsGrouped.{$kbCategoryId}) || $kbCategoryId > 0 }}">
								<xf:datarow rowclass="dataList-row--noHover">
									<xf:cell colspan="4" class="dataList-cell--noSearch">
										<xf:if is="{{ count($kbCategories) > 1 }}">
											{{ phrase('mjst_no_kbs_have_been_added_to_this_category_yet') }}
										<xf:else />
											{{ phrase('mjst_no_kbs_have_been_added_yet') }}
										</xf:if>
									</xf:cell>
								</xf:datarow>
							</xf:if>
						</xf:foreach>
						</tbody>
					</xf:foreach>
				</xf:datalist>
			</div>
			<div class="block-footer block-footer--split">
				<span class="block-footer-counter">{{ display_totals($kbTotal) }}</span>
				<xf:comment>
					<span class="block-footer-select"><xf:checkbox standalone="true"><xf:option check-all="< .block-container" label="{{ phrase('select_all') }}" /></xf:checkbox></span>
					<span class="block-footer-controls">
						<xf:button type="submit" name="quickset" value="1" class="button--small" overlay="true" accesskey="s">{{ phrase('quick_set') }}</xf:button>
					</span>
				</xf:comment>
			</div>
		</div>
	</xf:form>
<xf:else />
	<div class="blockMessage">{{ phrase('no_items_have_been_created_yet') }}</div>
</xf:if>]]></template>
  <template type="admin" title="mjst_option_macros_option_form_block" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:macro name="option_form_block" arg-group="" arg-options="!" arg-containerBeforeHtml="">
	<xf:if is="$options is not empty">
		<xf:form action="{{ link('options/update') }}" ajax="true" class="block">
			{$containerBeforeHtml|raw}
			<div class="block-container">
				<div class="block-tabHeader block-tabHeader--productTabs tabs hScroller"
					data-xf-init="tabs"
					data-state="replace"
					role="tablist">
					<div class="hScroller" data-xf-init="h-scroller">
						<span class="hScroller-scroll">
							<!--[XF:tabs:start]-->
							<a class="tabs-tab is-active" role="tab" tabindex="0" id="mjs-general" aria-controls="generalOptions">{{ phrase('general_options') }}</a>
							<a class="tabs-tab" role="tab" tabindex="0" id="mjst-ticket" aria-controls="ticketOptions">{{ phrase('mjst_ticket') }}</a>
							<a class="tabs-tab" role="tab" tabindex="0" id="mjst-kb" aria-controls="kbOptions">{{ phrase('mjst_knowledge_base') }}</a>
							<!--[XF:tabs:end]-->
						</span>
					</div>
				</div>
				<ul class="tabPanes">
					<!--[XF:tab_panels:start]-->
					<li class="is-active" role="tabpanel" id="generalOptions">
						<div class="block-body">
							<xf:foreach loop="$options" value="$option">
							<xf:if is="$option.Relations.mjstSupport.display_order < 1000">
								<xf:macro template="option_macros" name="option_row" arg-group="{$group}" arg-option="{$option}" />
							</xf:if>
							</xf:foreach>
						</div>
					</li>
					<li role="tabpanel" id="kbOptions">
						<div class="block-body">
							<xf:foreach loop="$options" value="$option">
							<xf:if is="$option.Relations.mjstSupport.display_order >= 1000 && $option.Relations.mjstSupport.display_order < 2000">
								<xf:macro template="option_macros" name="option_row" arg-group="{$group}" arg-option="{$option}" />
							</xf:if>
							</xf:foreach>
						</div>
					</li>
					<li role="tabpanel" id="kbOptions">
						<div class="block-body">
							<xf:foreach loop="$options" value="$option">
							<xf:if is="$option.Relations.mjstSupport.display_order >= 2000">
								<xf:macro template="option_macros" name="option_row" arg-group="{$group}" arg-option="{$option}" />
							</xf:if>
							</xf:foreach>
						</div>
					</li>
					<!--[XF:tab_panels:end]-->
				</ul>
				<xf:submitrow sticky="true" icon="save" />
			</div>
		</xf:form>
	</xf:if>
</xf:macro>]]></template>
  <template type="admin" title="mjst_option_template_contactAsTicket" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:checkboxrow
	label="{$option.title}"
	hint="{$hintHtml}"
	explain="{$explainHtml}"
	html="{$listedHtml}">

	<xf:option name="{$inputName}[enabled]" selected="$option.option_value.enabled" data-hide="true"
		label="{{ phrase('enable') }}">
		<xf:dependent>
			<xf:checkbox explain="{{ phrase('mjst_disable_contact_email_explain') }}">
				<xf:option name="{$inputName}[disable_email]" value="1" selected="$option.option_value.disable_email">
					{{ phrase('mjst_disable_contact_email') }}
				</xf:option>
			</xf:checkbox>
		</xf:dependent>
		<xf:dependent>
			<div>{{ phrase('mjst_defaut_department:') }}</div>
			<xf:select name="{$inputName}[department_id]" value="{$option.option_value.department_id}">
				<xf:options source="{$choices}" />
			</xf:select>
		</xf:dependent>
	</xf:option>
</xf:checkboxrow>]]></template>
  <template type="admin" title="mjst_option_template_mjstDefaultSortOrder" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:formrow rowtype="input"
	label="{$option.title}"
	hint="{$hintHtml}"
	explain="{$explainHtml}"
	html="{$listedHtml}">
	<div class="inputPair">
		<xf:select name="{$inputName}[order]" value="{$option.option_value.order}" class="input--inline">
			<xf:option value="last_update">{{ phrase('mjst_last_update') }}</xf:option>
			<xf:option value="open_date">{{ phrase('first_message') }}</xf:option>
			<xf:option value="last_message_date">{{ phrase('last_message') }}</xf:option>
			<xf:option value="title">{{ phrase('title') }}</xf:option>
			<xf:option value="reply_count">{{ phrase('replies') }}</xf:option>
		</xf:select>
		<xf:select name="{$inputName}[direction]" value="{$option.option_value.direction}"
				   class="input--inline">
			<xf:option value="desc" label="{{ phrase('descending') }}" />
			<xf:option value="asc" label="{{ phrase('ascending') }}" />
		</xf:select>
	</div>
</xf:formrow>]]></template>
  <template type="admin" title="mjst_option_template_requireCaptcha" version_id="2010670" version_string="2.1.6"><![CDATA[<xf:checkboxrow
	label="{$option.title}"
	hint="{$hintHtml}"
	explain="{$explainHtml}"
	html="{$listedHtml}">

	<xf:option name="{$inputName}[enabled]" selected="$option.option_value.enabled" data-hide="true"
		label="{{ phrase('enable') }}">
		<xf:dependent>
			<xf:checkbox>
				<xf:option name="{$inputName}[only_guest]" value="1" selected="$option.option_value.only_guest">
					<xf:label>{{ phrase('mjst_captcha_use_only_guest') }}</xf:label>
					<xf:hint>{{ phrase('mjst_captcha_use_only_guest_explain') }}</xf:hint>
				</xf:option>
			</xf:checkbox>
		</xf:dependent>
	</xf:option>
</xf:checkboxrow>]]></template>
  <template type="admin" title="mjst_permission_department_edit" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:if is="$userGroup">
	<xf:title>{$userGroup.title}</xf:title>
<xf:else />
	<xf:title>{$user.username}</xf:title>
</xf:if>

<xf:breadcrumb href="{{ link('permissions/mjst-departments', $record) }}">{$record.title}</xf:breadcrumb>

<xf:macro template="mjst_permission_department_macros" name="edit"
	arg-department="{$record}"
	arg-permissionData="{$permissionData}"
	arg-typeEntries="{$typeEntries}"
	arg-routeBase="permissions/mjst-departments"
	arg-saveParams="{$saveParams}" />]]></template>
  <template type="admin" title="mjst_permission_department_list" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{$record.title}</xf:title>

<xf:macro template="mjst_permission_department_macros" name="list"
	arg-department="{$record}"
	arg-isPrivate="{$isPrivate}"
	arg-userGroups="{$userGroups}"
	arg-users="{$users}"
	arg-entries="{$entries}"
	arg-routeBase="permissions/mjst-departments" />]]></template>
  <template type="admin" title="mjst_permission_department_macros" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:macro name="list"
	arg-department="!"
	arg-isPrivate="!"
	arg-userGroups="!"
	arg-users="!"
	arg-entries="!"
	arg-routeBase="!">

	<xf:form action="{{ link($routeBase . '/save', $department) }}" ajax="true" class="block">
		<div class="block-container">
			<div class="block-body">
				<xf:checkboxrow>
					<xf:option name="private" selected="{$isPrivate}"
						label="{{ phrase('mjst_private_department') }}"
						hint="{{ phrase('mjst_private_department_hint') }}" />
				</xf:checkboxrow>
			</div>
			<xf:submitrow icon="save" />
		</div>
		<xf:hiddenval name="type">private</xf:hiddenval>
	</xf:form>

	<div class="block">
		<div class="block-container">
			<h3 class="block-header">{{ phrase('user_groups') }}</h3>
			<div class="block-body">
				<xf:datalist>
					<xf:foreach loop="$userGroups" value="$userGroup">
						<xf:datarow
							label="{$userGroup.title}"
							href="{{ link($routeBase . '/edit', $department, {'user_group_id': $userGroup.user_group_id}) }}"
							rowclass="{{ {$entries.groups.{$userGroup.user_group_id}} ? 'dataList-row--custom' : '' }}" />
					</xf:foreach>
				</xf:datalist>
			</div>
		</div>
	</div>

	<xf:form action="{{ link($routeBase . '/edit', $department) }}" class="block">
		<div class="block-container">
			<h3 class="block-header">{{ phrase('users_with_permissions_set') }}</h3>
			<div class="block-body">
				<xf:if is="$users is not empty">
					<xf:datalist>
						<xf:foreach loop="$users" value="$user">
							<xf:datarow
								label="{$user.username}"
								href="{{ link($routeBase . '/edit', $department, {'user_id': $user.user_id}) }}"
								rowclass="dataList-row--custom" />
						</xf:foreach>
					</xf:datalist>
					<hr class="block-separator" />
				</xf:if>
				<xf:textboxrow name="username" ac="single"
					label="{{ phrase('set_permissions_for_user') }}" />
			</div>
			<xf:submitrow submit="{{ phrase('proceed...') }}" />
		</div>
		<xf:hiddenval name="type">user</xf:hiddenval>
	</xf:form>
</xf:macro>

<xf:macro name="edit"
	arg-department="!"
	arg-permissionData="!"
	arg-typeEntries="!"
	arg-routeBase="!"
	arg-saveParams="!">

	<xf:form action="{{ link($routeBase . '/save', $department, $saveParams) }}" ajax="true" class="block">
		<xf:macro template="permission_macros" name="edit_outer" arg-type="content" />

		<div class="block-container">
			<xf:macro template="permission_macros" name="content_edit_groups"
				arg-permissionsGrouped="{$permissionData.permissionsGrouped}"
				arg-interfaceGroups="{$permissionData.interfaceGroups}"
				arg-values="{$typeEntries}"
			/>
			<xf:submitrow sticky="true" icon="save" />
		</div>
	</xf:form>
</xf:macro>]]></template>
  <template type="admin" title="mjst_permission_department_overview" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('mjst_support_department_permissions') }}</xf:title>

<xf:if is="$departments is not empty">
	<div class="block">
		<div class="block-outer">
			<xf:macro template="filter_macros" name="quick_filter" arg-key="mjst-department" arg-class="block-outer-opposite" />
		</div>
		<div class="block-container">
			<div class="block-body">
				<xf:datalist>
					<xf:foreach loop="$departments" value="$department">
						<xf:datarow rowclass="{{ {$customPermissions.{$department.department_id}} ? 'dataList-row--custom' : '' }}">
							<xf:cell class="dataList-cell--link dataList-cell--main" hash="{$department.department_id}">
								<a href="{{ link('permissions/mjst-departments', $department) }}">
									<div class="dataList-mainRow">{$department.title}</div>
								</a>
							</xf:cell>
							<xf:action href="{{ link('mjst-support/departments/edit', $department) }}">{{ phrase('edit') }}</xf:action>
						</xf:datarow>
					</xf:foreach>
				</xf:datalist>
			</div>
		</div>
	</div>
<xf:else />
	<div class="blockMessage">{{ phrase('no_items_have_been_created_yet') }}</div>
</xf:if>]]></template>
  <template type="admin" title="mjst_pre_reply_delete" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('confirm_action') }}</xf:title>

<xf:form action="{{ link('mjst-support/predefined-replies/delete', $reply) }}" ajax="true" class="block">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">
				{{ phrase('please_confirm_that_you_want_to_delete_following:') }}
				<strong><a href="{{ link('mjst-support/predefined-replies/edit', $reply) }}">{$reply.title}</a></strong>
			</xf:inforow>
		</div>
		<xf:submitrow rowtype="simple" icon="delete" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_pre_reply_edit" version_id="3000034" version_string="3.0.0"><![CDATA[<xf:if is="$reply.isInsert()">
	<xf:title>{{ phrase('mjst_add_pre_reply') }}</xf:title>
<xf:else />
	<xf:title>{{ phrase('mjst_edit_pre_reply:') }}</xf:title>
</xf:if>

<xf:pageaction if="$reply.isUpdate()">
	<xf:button href="{{ link('mjst-support/predefined-replies/delete', $reply) }}" icon="delete" overlay="true" />
</xf:pageaction>

<xf:macro name="pre_reply_groups" arg-reply="!" arg-replyGroups="!" arg-withRow="1">
	<xf:if is="$withRow">
		<xf:selectrow label="{{ phrase('mjst_pre_reply_group') }}" name="reply_group_id" value="{$reply.reply_group_id}">
			<xf:option value="" label="{{ phrase('(none)') }}" />
			<xf:options source="{$replyGroups}" />
		</xf:selectrow>
	<xf:else />
		<xf:select name="reply_group_id" value="{$reply.reply_group_id}">
			<xf:option value="" label="{{ phrase('(none)') }}" />
			<xf:options source="{$replyGroups}" />
		</xf:select>
	</xf:if>
</xf:macro>
<xf:form action="{{ link('mjst-support/predefined-replies/save', $reply) }}" ajax="true" class="block">
	<div class="block-container">
		<div class="block-body">

			<xf:textboxrow name="title" value="{$reply.title}" label="{{ phrase('title') }}" />

			<xf:macro name="pre_reply_groups" arg-reply="{$reply}" arg-replyGroups="{$replyGroups}" />

			<hr class="formRowSep" />
			<xf:editorrow name="message" value="{$reply.message}" data-min-height="200"
				label="{{ phrase('message') }}"
				explain="{{ phrase('mjst_pre_reply_explain') }}" />

			<hr class="formRowSep" />

			<xf:macro template="display_order_macros" name="row"
				arg-value="{$reply.display_order}" />

			<xf:checkboxrow>
				<xf:option name="is_active" label="{{ phrase('mjst_active') }}" selected="{$reply.is_active}" />
			</xf:checkboxrow>

			<xf:macro template="helper_user_group_edit" name="checkboxes"
				arg-selectedUserGroups="{{ $reply.reply_id ? $reply.allowed_user_group_ids : [-1] }}" />
		</div>
		<xf:submitrow sticky="true" icon="save" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_pre_reply_group_delete" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('confirm_action') }}</xf:title>

<xf:form action="{{ link('mjst-support/predefined-replies/group/delete', $replyGroup) }}" ajax="true" class="block">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">
				{{ phrase('please_confirm_that_you_want_to_delete_following:') }}
				<strong><a href="{{ link('mjst-support/predefined-replies/group/edit', $replyGroup) }}" data-xf-click="overlay">{$replyGroup.title}</a></strong>
				{{ phrase('mjst_pre_replies_belonging_to_this_group_will_be_disassociated_rather_than_deleted') }}
			</xf:inforow>
		</div>
		<xf:submitrow rowtype="simple" icon="delete" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_pre_reply_group_edit" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:if is="$replyGroup.isInsert()">
	<xf:title>{{ phrase('mjst_add_pre_reply_group') }}</xf:title>
<xf:else />
	<xf:title>{{ phrase('mjst_edit_pre_reply_group:') }} {$replyGroup.title}</xf:title>
</xf:if>

<xf:pageaction if="$replyGroup.isUpdate()">
	<xf:button href="{{ link('mjst-support/predefined-replies/group/delete', $replyGroup) }}" icon="delete" overlay="true" />
</xf:pageaction>

<xf:form action="{{ link('mjst-support/predefined-replies/group/save', $replyGroup) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:textboxrow name="title" value="{{ $replyGroup.reply_group_id ? $replyGroup.title : '' }}" label="{{ phrase('title') }}" />

			<xf:macro template="display_order_macros" name="row"
				arg-value="{$replyGroup.display_order}" />
		</div>
		<xf:submitrow icon="save" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_pre_reply_list" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('mjst_pre_replies') }}</xf:title>

<xf:pageaction>
	<div class="buttonGroup">
		<xf:button href="{{ link('mjst-support/predefined-replies/add') }}" icon="add">{{ phrase('mjst_add_pre_reply') }}</xf:button>
		<xf:button href="{{ link('mjst-support/predefined-replies/group/add') }}" icon="add" overlay="true">{{ phrase('mjst_add_pre_reply_group') }}</xf:button>
	</div>
</xf:pageaction>

<xf:if is="$repliesGrouped is not empty OR count($replyGroups) > 1">
	<xf:form action="{{ link('mjst-support/predefined-replies/toggle') }}" ajax="true" class="block">
		<div class="block-outer">
			<xf:macro template="filter_macros" name="quick_filter" arg-key="mjst-support/predefined-replies" arg-class="block-outer-opposite" />
		</div>
		<div class="block-container">
			<div class="block-body">
				<xf:datalist>
					<xf:foreach loop="$replyGroups" key="$replyGroupId" value="$replyGroup">
						<tbody class="dataList-rowGroup" id="js-replyGroup{$replyGroupId}">
						<xf:if is="{{ count($replyGroups) > 1 }}">
							<xf:datarow rowtype="subsection" rowclass="{{ !$replyGroupId ? 'dataList-row--noHover' : '' }}">
								<xf:if is="{{ $replyGroupId > 0 }}">
									<xf:cell href="{{ link('mjst-support/predefined-replies/group/edit', $replyGroup) }}" overlay="true">
										{$replyGroup.title}
									</xf:cell>
									<xf:cell>&nbsp;</xf:cell>
									<xf:delete href="{{ link('mjst-support/predefined-replies/group/delete', $replyGroup) }}" />
								<xf:elseif is="{{ count($repliesGrouped.{$replyGroupId}) }}" />
									<xf:cell>{{ phrase('(ungrouped)') }}</xf:cell>
									<xf:cell>&nbsp;</xf:cell>
									<xf:cell>&nbsp;</xf:cell>
								</xf:if>
							</xf:datarow>
						</xf:if>
						<xf:foreach loop="{$repliesGrouped.{$replyGroupId}}" key="$replyId" value="$reply">
							<xf:datarow rowclass="replyGroup{$replyGroupId}{{ !$reply.is_active?' dataList-row--disabled':'' }}">
								<xf:comment>
									<xf:toggle name="reply_ids[]" value="{$reply.reply_id}" />
								</xf:comment>
								<xf:cell href="{{ link('mjst-support/predefined-replies/edit', $reply) }}" class="dataList-cell" hash="{$reply.reply_id}">
									{$reply.title}
								</xf:cell>
								<xf:toggle name="is_active[{$reply.reply_id}]"
									selected="$reply.is_active"
									class="dataList-cell--separated" submit="true" />
								<xf:delete href="{{ link('mjst-support/predefined-replies/delete', $reply) }}" />
							</xf:datarow>
						<xf:else />
							<xf:if is="{{ count($repliesGrouped.{$replyGroupId}) || $replyGroupId > 0 }}">
								<xf:datarow rowclass="dataList-row--noHover">
									<xf:cell colspan="4" class="dataList-cell--noSearch">
										<xf:if is="{{ count($replyGroups) > 1 }}">
											{{ phrase('mjst_no_pre_replies_have_been_added_to_this_group_yet') }}
										<xf:else />
											{{ phrase('mjst_no_pre_replies_have_been_added_yet') }}
										</xf:if>
									</xf:cell>
								</xf:datarow>
							</xf:if>
						</xf:foreach>
						</tbody>
					</xf:foreach>
				</xf:datalist>
			</div>
			<div class="block-footer block-footer--split">
				<span class="block-footer-counter">{{ display_totals($replyTotal) }}</span>
				<xf:comment>
					<span class="block-footer-select"><xf:checkbox standalone="true"><xf:option check-all="< .block-container" label="{{ phrase('select_all') }}" /></xf:checkbox></span>
					<span class="block-footer-controls">
						<xf:button type="submit" name="quickset" value="1" class="button--small" overlay="true" accesskey="s">{{ phrase('quick_set') }}</xf:button>
					</span>
				</xf:comment>
			</div>
		</div>
	</xf:form>
<xf:else />
	<div class="blockMessage">{{ phrase('no_items_have_been_created_yet') }}</div>
</xf:if>]]></template>
  <template type="admin" title="mjst_stats" version_id="3000034" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('statistics') }}</xf:title>

<xf:css>
	.statsOuter{
	}
	.mjstStats{
		width: 33.333333%;
		float: left;
		text-align: center;
	}
	.ticket-stats{
		font-size: 32px;
	}
</xf:css>

<div class="block">
	<div class="block-container">
		<div class="block-body statsOuter u-clearFix">
			<div class="mjstStats">
				<div class="block-row">
					<h3 class="block-textHeader">
						{{ phrase('mjst_total_tickets') }}
					</h3>
					<div class="ticket-stats">
						{$ticketCount|number}
					</div>
				</div>
			</div>
			<div class="mjstStats">
				<div class="block-row">
					<h3 class="block-textHeader">
						{{ phrase('mjst_active_tickets') }}
					</h3>
					<div class="ticket-stats">
						{$activeTickets|number}
					</div>
				</div>
			</div>
			<div class="mjstStats">
				<div class="block-row">
					<h3 class="block-textHeader">
						{{ phrase('mjst_waiting_reply_tickets') }}
					</h3>
					<div class="ticket-stats">
						{$waitTickets|number}
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="block">
	<div class="block-container">
		<div class="block-body statsOuter u-clearFix">
			<div class="mjstStats">
				<div class="block-row">
					<h3 class="block-textHeader">
						{{ phrase('mjst_total_departments') }}
					</h3>
					<div class="ticket-stats">
						{$departmentCount|number}
					</div>
				</div>
			</div>
			<div class="mjstStats">
				<div class="block-row">
					<h3 class="block-textHeader">
						{{ phrase('mjst_total_knowledge_bases') }}
					</h3>
					<div class="ticket-stats">
						{$kbCount|number}
					</div>
				</div>
			</div>
			<div class="mjstStats">
				<div class="block-row">
					<h3 class="block-textHeader">
						{{ phrase('mjst_total_predefined_replies') }}
					</h3>
					<div class="ticket-stats">
						{$preReplyCount|number}
					</div>
				</div>
			</div>
		</div>
	</div>
</div>]]></template>
  <template type="admin" title="mjst_ticket_escalation_delete" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('confirm_action') }}</xf:title>

<xf:form action="{{ link('mjst-support/escalations/delete', $ticketEscalation) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">
				{{ phrase('please_confirm_that_you_want_to_delete_following:') }}
				<strong><a href="{{ link('mjst-support/escalations/edit', $ticketEscalation) }}">{$ticketEscalation.title}</a></strong>
			</xf:inforow>
		</div>
		<xf:submitrow rowtype="simple" icon="delete" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_ticket_escalation_edit" version_id="3000031" version_string="3.0.0"><![CDATA[<xf:if is="$ticketEscalation.isInsert()">
	<xf:title>{{ phrase('mjst_add_escalation') }}</xf:title>
<xf:else />
	<xf:title>{{ phrase('mjst_edit_escalation:') }} {$ticketEscalation.title}</xf:title>
</xf:if>

<xf:pageaction if="$ticketEscalation.isUpdate()">
	<xf:button href="{{ link('mjst-support/escalations/delete', $ticketEscalation) }}" icon="delete" overlay="true" />
</xf:pageaction>

<xf:form action="{{ link('mjst-support/escalations/save', $ticketEscalation) }}" ajax="true" class="block">
	<div class="block-container">
		<div class="block-body">
			<xf:textboxrow name="title" value="{$ticketEscalation.title}" label="{{ phrase('title') }}" />
		</div>
		<h3 class="block-formSectionHeader">
			<span class="block-formSectionHeader-aligner">{{ phrase('mjst_conditions') }}</span>
		</h3>
		<div class="block-body">
			<xf:selectrow name="department_ids[]" value="{$ticketEscalation.department_ids}" multiple="true"
				label="{{ phrase('mjst_departments') }}">
				<xf:foreach loop="$departments" value="$department">
					<xf:option value="{$department.department_id}"> {$department.title}</xf:option>
				</xf:foreach>
			</xf:selectrow>
			<xf:selectrow name="ticket_status_ids[]" value="{$ticketEscalation.ticket_status_ids}" multiple="true"
				label="{{ phrase('mjst_statuses') }}">
				<xf:foreach loop="$ticketStatuses" value="$ticketStatus">
					<xf:option value="{$ticketStatus.ticket_status_id}"> {$ticketStatus.title}</xf:option>
				</xf:foreach>
			</xf:selectrow>
			<xf:selectrow name="priorities[]" value="{$ticketEscalation.priorities}" multiple="true"
				label="{{ phrase('mjst_priorities') }}">
				<xf:option value="1">{{ phrase('mjst_high') }}</xf:option>
				<xf:option value="2">{{ phrase('mjst_medium') }}</xf:option>
				<xf:option value="3">{{ phrase('mjst_low') }}</xf:option>
			</xf:selectrow>
			<xf:numberboxrow name="time_elapsed" value="{{ $ticketEscalation.time_elapsed}}" min="0" step="1"
				label="{{ phrase('mjst_time_elapsed') }}"
				explain="{{ phrase('mjst_time_elapsed_explain') }}" min="0" />
		</div>
		<h3 class="block-formSectionHeader">
			<span class="block-formSectionHeader-aligner">{{ phrase('mjst_actions') }}</span>
		</h3>
		<div class="block-body">
			<xf:selectrow name="new_department_id" value="{$ticketEscalation.new_department_id}"
				label="{{ phrase('mjst_departments') }}">
				<xf:option value="0">{{ phrase('mjst_no_change') }}</xf:option>
				<xf:foreach loop="$departments" value="$department">
					<xf:option value="{$department.department_id}"> {$department.title}</xf:option>
				</xf:foreach>
			</xf:selectrow>
			<xf:selectrow name="new_ticket_status_id" value="{$ticketEscalation.new_ticket_status_id}"
				label="{{ phrase('mjst_statuses') }}">
				<xf:option value="0">{{ phrase('mjst_no_change') }}</xf:option>
				<xf:foreach loop="$ticketStatuses" value="$ticketStatus">
					<xf:option value="{$ticketStatus.ticket_status_id}"> {$ticketStatus.title}</xf:option>
				</xf:foreach>
			</xf:selectrow>
			<xf:selectrow name="new_priority" value="{$ticketEscalation.new_priority}"
				label="{{ phrase('mjst_priorities') }}">
				<xf:option value="0">{{ phrase('mjst_no_change') }}</xf:option>
				<xf:option value="1">{{ phrase('mjst_high') }}</xf:option>
				<xf:option value="2">{{ phrase('mjst_medium') }}</xf:option>
				<xf:option value="3">{{ phrase('mjst_low') }}</xf:option>
			</xf:selectrow>
		</div>
		<h3 class="block-formSectionHeader">
			<span class="block-formSectionHeader-aligner">{{ phrase('mjst_add_reply') }}</span>
		</h3>
		<div class="block-body">
			<xf:textboxrow name="username" ac="single" value="{$ticketEscalation.User.username}"
					label="{{ phrase('mjst_user') }}" />
			<xf:editorrow name="reply_message" value="{$ticketEscalation.reply_message}" data-min-height="200"
				label="{{ phrase('mjst_reply_message') }}" />
		</div>
		<xf:submitrow icon="save" sticky="true" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_ticket_escalation_list" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('mjst_escalations') }}</xf:title>

<xf:pageaction>
	<xf:button href="{{ link('mjst-support/escalations/add') }}" icon="add">{{ phrase('mjst_add_escalation') }}</xf:button>
</xf:pageaction>

<xf:if is="$ticketEscalations is not empty">
	<xf:form action="{{ link('mjst-support/escalations/toggle') }}" class="block" ajax="true">
		<div class="block-outer">
			<xf:macro template="filter_macros" name="quick_filter" arg-key="mjst-escalation" arg-class="block-outer-opposite" />
		</div>
		<div class="block-container">
			<div class="block-body">
				<xf:datalist>
					<xf:foreach loop="$ticketEscalations" value="$ticketEscalation">
						<xf:datarow>
							<xf:cell class="dataList-cell--link dataList-cell--main" hash="{$ticketEscalation.ticket_escalation_id}">
								<a href="{{ link('mjst-support/escalations/edit', $ticketEscalation) }}">
									<div class="dataList-mainRow">{$ticketEscalation.title}</div>
								</a>
							</xf:cell>
							<xf:delete href="{{ link('mjst-support/escalations/delete', $ticketEscalation) }}" />
						</xf:datarow>
					</xf:foreach>
				</xf:datalist>
			</div>
		</div>
	</xf:form>
<xf:else />
	<div class="blockMessage">{{ phrase('no_items_have_been_created_yet') }}</div>
</xf:if>]]></template>
  <template type="admin" title="mjst_ticket_field_delete" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:include template="base_custom_field_delete" />]]></template>
  <template type="admin" title="mjst_ticket_field_edit" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:include template="base_custom_field_edit">
	<xf:set var="$extraOptions">
		<xf:macro template="base_custom_field_macros" name="common_options"
			arg-field="{$field}" />
	</xf:set>
	<xf:set var="$displayOptions">
		<xf:selectrow name="department_ids[]" value="{$departmentIds}" multiple="multiple" size="7"
			label="{{ phrase('mjst_applicable_departments') }}">

			<xf:option value="" selected="!{$departmentIds}">{{ phrase('(none)') }}</xf:option>
			<xf:foreach loop="$departments" value="$department">
				<xf:option value="{$department.department_id}"> {$department.title}</xf:option>
			</xf:foreach>
		</xf:selectrow>
	</xf:set>
</xf:include>]]></template>
  <template type="admin" title="mjst_ticket_field_list" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('mjst_ticket_fields') }}</xf:title>

<xf:include template="base_custom_field_list" />]]></template>
  <template type="admin" title="mjst_ticket_prefix_delete" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:include template="base_prefix_delete" />]]></template>
  <template type="admin" title="mjst_ticket_prefix_edit" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:include template="base_prefix_edit">
	<xf:set var="$extraOptions">
		<xf:macro template="mjst_ticket_prefix_edit_macros" name="department_ids"
			arg-departmentIds="{$prefix.department_ids}"
			arg-departments="{$departments}" />
	</xf:set>
</xf:include>]]></template>
  <template type="admin" title="mjst_ticket_prefix_edit_macros" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:macro name="department_ids" arg-departmentIds="!" arg-departments="!" arg-withRow="1">
	<xf:set var="$inner">
		<ul class="inputList">
			<li><xf:select name="department_ids[]" size="7" multiple="multiple" value="{$departmentIds}" id="js-applicableDepartments">
				<xf:option value="" selected="!{$departmentIds}">{{ phrase('(none)') }}</xf:option>
				<xf:foreach loop="$departments" value="$department">
					<xf:option value="{$department.department_id}"> {$department.title}</xf:option>
				</xf:foreach>
			</xf:select></li>
			<xf:checkbox>
				<xf:option id="js-selectAllDepartments">{{ phrase('select_all') }}</xf:option>
			</xf:checkbox>
		</ul>
	</xf:set>

	<xf:if is="$withRow">
		<xf:formrow rowtype="input"
			label="{{ phrase('mjst_applicable_departments') }}">

			{$inner|raw}
		</xf:formrow>
	<xf:else />
		{$inner|raw}
	</xf:if>

	<xf:js>
		$(function()
		{
			$('#js-selectAllDepartments').click(function(e)
			{
				$('#js-applicableDepartments').find('option:enabled:not([value=""])').prop('selected', this.checked);
			});
		});
	</xf:js>
</xf:macro>]]></template>
  <template type="admin" title="mjst_ticket_prefix_group_delete" version_id="3000031" version_string="3.0.0"><![CDATA[<xf:include template="base_prefix_group_delete" />]]></template>
  <template type="admin" title="mjst_ticket_prefix_group_edit" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:include template="base_prefix_group_edit" />]]></template>
  <template type="admin" title="mjst_ticket_prefix_list" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('mjst_ticket_prefixes') }}</xf:title>

<xf:include template="base_prefix_list" />]]></template>
  <template type="admin" title="mjst_ticket_prefix_quickset_chooser" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:include template="base_prefix_quickset_chooser">
	<xf:set var="$prefixType" value="support_ticket" />
</xf:include>]]></template>
  <template type="admin" title="mjst_ticket_prefix_quickset_editor" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:include template="base_prefix_quickset_editor">
	<xf:set var="$extraOptions">
		<xf:checkboxrow name="apply_department_ids"
			label="{{ phrase('mjst_applicable_departments') }}">

			<xf:option label="{{ phrase('mjst_apply_department_options') }}">
				<xf:dependent>
					<xf:macro template="mjst_ticket_prefix_edit_macros" name="department_ids"
						arg-departmentIds="{$prefix.department_ids}"
						arg-departments="{$departments}"
						arg-withRow="{{ false }}" />
				</xf:dependent>
			</xf:option>
		</xf:checkboxrow>
	</xf:set>
</xf:include>]]></template>
  <template type="admin" title="mjst_ticket_status_delete" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('confirm_action') }}</xf:title>

<xf:form action="{{ link('mjst-support/statuses/delete', $ticketStatus) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">
				{{ phrase('please_confirm_that_you_want_to_delete_following:') }}
				<strong><a href="{{ link('mjst-support/statuses/edit', $ticketStatus) }}">{$ticketStatus.title}</a></strong>
			</xf:inforow>
		</div>
		<xf:submitrow rowtype="simple" icon="delete" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_ticket_status_edit" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:if is="$ticketStatus.isInsert()">
	<xf:title>{{ phrase('mjst_add_ticket_status') }}</xf:title>
<xf:else />
	<xf:title>{{ phrase('mjst_edit_ticket_status:') }} {$ticketStatus.title}</xf:title>
</xf:if>

<xf:pageaction if="$ticketStatus.isUpdate()">
	<xf:button href="{{ link('mjst-support/statuses/delete', $ticketStatus) }}" icon="delete" overlay="true" />
</xf:pageaction>

<xf:form action="{{ link('mjst-support/statuses/save', $ticketStatus) }}" ajax="true" class="block">
	<div class="block-container">
		<div class="block-body">
			<xf:textboxrow name="title" value="{{ $ticketStatus.exists() ? $ticketStatus.MasterTitle.phrase_text : '' }}"
				label="{{ phrase('title') }}" />

			<xf:macro template="public:color_picker_macros" name="color_picker"
				arg-name="status_color"
				arg-value="{$ticketStatus.status_color}"
				arg-label="{{ phrase('mjst_status_color') }}"
				arg-rowClass="formRow-styleProperty" />
			<xf:checkboxrow label="">
				<xf:option name="group_active" selected="$ticketStatus.group_active">{{ phrase('mjst_group_active') }}</xf:option>
				<xf:option name="group_waiting_reply" selected="$ticketStatus.group_waiting_reply">{{ phrase('mjst_group_waiting_reply') }}</xf:option>
			</xf:checkboxrow>
		</div>
		<xf:submitrow icon="save" sticky="true" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="mjst_ticket_status_list" version_id="3000031" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_ticket_statuses') }}</xf:title>

<xf:pageaction>
	<xf:button href="{{ link('mjst-support/statuses/add') }}" icon="add">{{ phrase('mjst_add_ticket_status') }}</xf:button>
</xf:pageaction>
<xf:css>
	.tsColor{
		display: inline-block;
		width: 30px;
		height: 15px;
	}
	.dataList-cell.dataList-cell--min.tsType{
		text-align: right;
	}
</xf:css>
<xf:if is="$ticketStatuses is not empty">
	<xf:form action="{{ link('mjst-support/statuses/toggle') }}" class="block" ajax="true">
		<div class="block-outer">
			<xf:macro template="filter_macros" name="quick_filter" arg-key="mjst-ticket-status" arg-class="block-outer-opposite" />
		</div>
		<div class="block-container">
			<div class="block-body">
				<xf:datalist>
					<xf:foreach loop="$ticketStatuses" value="$ticketStatus">
						<xf:datarow>
							<xf:cell class="dataList-cell--link dataList-cell--main" hash="{$ticketStatus.ticket_status_id}">
								<a href="{{ link('mjst-support/statuses/edit', $ticketStatus) }}">
									<div class="dataList-mainRow">
										{$ticketStatus.title}
										<span class="dataList-hint" dir="auto">
											{{ $ticketStatus.isDefault() ? phrase('default') : '' }}
										</span>
									</div>
								</a>
							</xf:cell>
							<xf:cell class="dataList-cell--min tsType">
								<xf:if is="{$ticketStatus.group_waiting_reply}">
									<span class="tagItem">{{ phrase('mjst_group_waiting_reply') }}</span>
								</xf:if>
								<xf:if is="{$ticketStatus.group_active}">
									<span class="tagItem">{{ phrase('mjst_group_active') }}</span>
								</xf:if>
							</xf:cell>
							<xf:cell class="dataList-cell--min">
								<span class="tsColor" style="background: {$ticketStatus.status_color};"></span>
							</xf:cell>
							<xf:delete href="{{ link('mjst-support/statuses/delete', $ticketStatus) }}" />
						</xf:datarow>
					</xf:foreach>
				</xf:datalist>
			</div>
		</div>
	</xf:form>
<xf:else />
	<div class="blockMessage">{{ phrase('no_items_have_been_created_yet') }}</div>
</xf:if>]]></template>
  <template type="admin" title="mjst_tools_rebuild" version_id="3000031" version_string="3.0.0"><![CDATA[<xf:macro template="tools_rebuild" name="rebuild_job"
	arg-header="{{ phrase('mjst_rebuild_tickets') }}"
	arg-job="MJ\SupportTicket:Ticket" />
<!--[XF:after_rm_ticket]-->

<xf:macro template="tools_rebuild" name="rebuild_job"
	arg-header="{{ phrase('mjst_rebuild_ticket_departments') }}"
	arg-job="MJ\SupportTicket:Department" />
<!--[XF:after_rm_category]-->

<xf:macro template="tools_rebuild" name="rebuild_job"
	arg-header="{{ phrase('mjst_rebuild_user_ticket_counts') }}"
	arg-job="MJ\SupportTicket:UserTicketCount" />
<!--[XF:after_rm_category]-->

<xf:set var="$mdBody">
	<xf:checkboxrow name="options[types]" listclass="listColumns">
		<xf:option value="attachments"
			label="{{ phrase('attachments') }}"
			selected="true" />
	</xf:checkboxrow>
</xf:set>
<xf:macro template="tools_rebuild" name="rebuild_job"
	arg-header="{{ phrase('mjst_rebuild_ticket_embed_metadata') }}"
	arg-body="{$mdBody}"
	arg-job="MJ\SupportTicket:TicketMessageEmbedMetadata" />
<!--[XF:after_rm_metadata]-->]]></template>
  <template type="email" title="mjst_new_ticket" version_id="3000033" version_string="3.0.0"><![CDATA[<mail:subject>
	{{ phrase('mjst_new_ticket_received_x', {
		'title': prefix('support_ticket', $ticket, 'escaped') . $ticket.full_title
	}) }}
</mail:subject>

<xf:if is="$ticket.creator_user_id != $ticket.user_id">
	{{ phrase('mjst_new_open_ticket_email_html', {
		'receiver': $receiver.username,
		'replier': username_link_email($message.User, $message.username),
		'board': '<a href="' . link('canonical:index') . '">' . $xf.options.boardTitle . '</a>'
	}) }}
<xf:else />
	{{ phrase('mjst_new_ticket_email_html', {
		'receiver': $receiver.username,
		'replier': username_link_email($message.User, $message.username),
		'board': '<a href="' . link('canonical:index') . '">' . $xf.options.boardTitle . '</a>'
	}) }}
</xf:if>

<h2><a href="{{ link('canonical:support-tickets/messages', $message) }}">{{ prefix('support_ticket', $ticket, 'escaped') }}{$ticket.full_title}</a></h2>

<xf:if is="!$receiver.user_id && !$ticket.user_id">
	{{ phrase('mjst_ticket_guest_password_email', {
		'password': $ticket.guest_password
	}) }}
</xf:if>

{{ phrase('mjst_ticket_info_email', {
	'ticket_id'  : $ticket.ticket_id,
	'department' : $department.title,
	'priority'   : $ticket.urgency_title,
	'status'     : $ticket.Status.title
}) }}

<xf:if is="$xf.options.mjstFirstMessageInEmail">
	<div class="message">{{ bb_code_type('emailHtml', $message.message, 'support_ticket_message', $message) }}</div>
</xf:if>

<xf:macro template="mjst_ticket_macros" name="go_ticket_bar" arg-ticket="{$ticket}" arg-watchType="departments" />]]></template>
  <template type="email" title="mjst_ticket_macros" version_id="3000334" version_string="3.0.3"><![CDATA[<xf:macro name="go_ticket_bar" arg-ticket="!" arg-watchType="!">
	<table cellpadding="10" cellspacing="0" border="0" width="100%" class="linkBar">
	<tr>
		<td>
			<a href="{{ link('canonical:support-tickets', $ticket) }}" class="button">{{ phrase('mjst_view_this_ticket') }}</a>
		</td>
		<td align="{{ $xf.isRtl ? 'left' : 'right' }}">
			<xf:if is="$watchType == 'ticket'">
				<a href="{{ link('canonical:watched/tickets') }}" class="buttonFake">{{ phrase('mjst_watched_tickets') }}</a>
			<xf:elseif is="$watchType == 'department'" />
				<a href="{{ link('canonical:watched/ticket-departments') }}" class="buttonFake">{{ phrase('mjst_watched_departments') }}</a>
			</xf:if>
		</td>
	</tr>
	</table>
</xf:macro>

<xf:macro name="go_ticket_bar" arg-ticket="!" arg-watchType="!">
	<table cellpadding="10" cellspacing="0" border="0" width="100%" class="linkBar">
	<tr>
		<td>
			<a href="{{ link('canonical:support-tickets', $ticket) }}" class="button">{{ phrase('mjst_view_this_ticket') }}</a>
		</td>
		<td align="{{ $xf.isRtl ? 'left' : 'right' }}">
			<xf:if is="$watchType == 'ticket'">
				<a href="{{ link('canonical:watched/tickets') }}" class="buttonFake">{{ phrase('mjst_watched_tickets') }}</a>
			<xf:elseif is="$watchType == 'department'" />
				<a href="{{ link('canonical:watched/ticket-departments') }}" class="buttonFake">{{ phrase('mjst_watched_departments') }}</a>
			</xf:if>
		</td>
	</tr>
	</table>
</xf:macro>

<xf:macro name="watched_department_footer" arg-ticket="!" arg-department="!">
	{{ phrase('mjst_watched_department_email_html_footer', {
		'department': $department.title,
		'board': $xf.options.boardTitle,
		'disable_this_link': link('canonical:email-stop/content', $xf.toUser, {'t': 'support_department', 'id': $department.department_id}),
		'disable_all_link': link('canonical:email-stop/all', $xf.toUser)
	}) }}
</xf:macro>

<xf:macro name="watched_ticket_footer" arg-ticket="!">
	{{ phrase('mjst_watched_ticket_email_html_footer', {
		'ticket':  $ticket.title,
		'board': $xf.options.boardTitle,
		'disable_this_link': link('canonical:email-stop/content', $xf.toUser, {'t': 'support_ticket', 'id': $ticket.support_ticket_id}),
		'disable_all_link': link('canonical:email-stop/all', $xf.toUser)
	}) }}
	<xf:if is="$ticket.user_id">
	{{ phrase('mjst_watched_ticket_email_html_footer_disable', {
		'disable_this_link': link('canonical:email-stop/content', $xf.toUser, {'t': 'support_ticket', 'id': $ticket.support_ticket_id}),
		'disable_all_link': link('canonical:email-stop/all', $xf.toUser)
	}) }}
	</xf:if>
</xf:macro>]]></template>
  <template type="email" title="mjst_watched_department_reply" version_id="3000033" version_string="3.0.0"><![CDATA[<mail:subject>
	{{ phrase('mjst_new_message_in_watched_department_x', {
		'title': prefix('support_ticket', $ticket, 'escaped') . $ticket.title
	}) }}
</mail:subject>

{{ phrase('mjst_watched_department_message_email_html', {
	'receiver': $receiver.username,
	'replier': username_link_email($message.User, $message.username),
	'board': '<a href="' . link('canonical:index') . '">' . $xf.options.boardTitle . '</a>'
}) }}

<h2><a href="{{ link('canonical:support-tickets/messages', $message) }}">{{ prefix('support_ticket', $ticket, 'escaped') }}{$ticket.full_title}</a></h2>

<xf:if is="$xf.options.mjstFirstMessageInEmail">
	<div class="message">{{ bb_code_type('emailHtml', $message.message, 'support_ticket_message', $message) }}</div>
</xf:if>

<xf:macro template="mjst_ticket_macros" name="go_ticket_bar" arg-ticket="{$ticket}" arg-watchType="departments" />

<xf:macro template="mjst_ticket_macros" name="watched_department_footer" arg-ticket="{$ticket}" arg-department="{$department}" />]]></template>
  <template type="email" title="mjst_watched_department_ticket" version_id="3000031" version_string="3.0.0"><![CDATA[<mail:subject>
	{{ phrase('mjst_new_ticket_in_watched_department_x', {
		'title': prefix('support_ticket', $ticket, 'escaped') . $ticket.full_title
	}) }}
</mail:subject>

{{ phrase('mjst_watched_department_ticket_email_html', {
	'receiver': $receiver.username,
	'replier': username_link_email($message.User, $message.username),
	'board': '<a href="' . link('canonical:index') . '">' . $xf.options.boardTitle . '</a>'
}) }}

<h2><a href="{{ link('canonical:support-tickets/messages', $message) }}">{{ prefix('support_ticket', $ticket, 'escaped') }}{$ticket.full_title}</a></h2>

<xf:if is="!$receiver.user_id && !$ticket.user_id">
	{{ phrase('mjst_ticket_guest_password_email', {
		'password': $ticket.guest_password
	}) }}
</xf:if>

{{ phrase('mjst_ticket_info_email', {
	'ticket_id'  : $ticket.ticket_id,
	'department' : $department.title,
	'priority'   : $ticket.urgency_title,
	'status'     : $ticket.Status.title
}) }}

<xf:if is="$xf.options.mjstFirstMessageInEmail">
	<div class="message">{{ bb_code_type('emailHtml', $message.message, 'support_ticket_message', $message) }}</div>
</xf:if>

<xf:macro template="mjst_ticket_macros" name="go_ticket_bar" arg-ticket="{$ticket}" arg-watchType="departments" />

<xf:macro template="mjst_ticket_macros" name="watched_department_footer" arg-ticket="{$ticket}" arg-department="{$department}" />]]></template>
  <template type="email" title="mjst_watched_ticket_reply" version_id="3000334" version_string="3.0.3"><![CDATA[<mail:subject>
	{{ phrase('mjst_reply_to_watched_ticket_x', {
		'title': prefix('support_ticket', $ticket, 'escaped') . $ticket.full_title
	}) }}
</mail:subject>

{{ phrase('mjst_watched_ticket_reply_email_html', {
	'receiver': $receiver.username,
	'replier': username_link_email($message.User, $message.username),
	'board': '<a href="' . link('canonical:index') . '">' . $xf.options.boardTitle . '</a>'
}) }}

<h2><a href="{{ link('canonical:support-tickets/messages', $message) }}">{{ prefix('support_ticket', $ticket, 'escaped') }}{$ticket.full_title}</a></h2>

{{ phrase('mjst_ticket_info_email', {
	'ticket_id'  : $ticket.ticket_id,
	'department' : $department.title,
	'priority'   : $ticket.urgency_title,
	'status'     : $ticket.Status.title
}) }}

<xf:if is="$xf.options.mjstFirstMessageInEmail">
	<div class="message">{{ bb_code_type('emailHtml', $message.message, 'support_ticket_message', $message) }}</div>
</xf:if>

<xf:macro template="mjst_ticket_macros" name="go_ticket_bar" arg-ticket="{$ticket}" arg-watchType="tickets" />
<xf:macro template="mjst_ticket_macros" name="watched_ticket_footer" arg-ticket="{$ticket}" />]]></template>
  <template type="public" title="alert_user_mjst_message_copy" version_id="3000031" version_string="3.0.0"><![CDATA[{{ phrase('mjst_your_message_in_ticket_x_was_copied_to_y', {
	'title': $extra.title,
	'target': '<a href="' . base_url($extra.targetLink) . '" class="fauxBlockLink-blockLink">' . prefix('ticket', $extra.prefix_id) . $extra.targetTitle . '</a>'
}) }}
<xf:if is="$extra.reason">{{ phrase('reason:') }} {$extra.reason}</xf:if>]]></template>
  <template type="public" title="alert_user_mjst_message_delete" version_id="3000031" version_string="3.0.0"><![CDATA[{{ phrase('mjst_your_message_in_ticket_x_was_deleted', {
	'title': '<a href="' . base_url($extra.ticketLink) . '" class="fauxBlockLink-blockLink">' . prefix('ticket', $extra.prefix_id) . $extra.full_title . '</a>'
}) }}
<xf:if is="$extra.reason">{{ phrase('reason:') }} {$extra.reason}</xf:if>]]></template>
  <template type="public" title="alert_user_mjst_message_edit" version_id="3000031" version_string="3.0.0"><![CDATA[{{ phrase('mjst_your_message_in_ticket_x_was_edited', {'title': '<a href="' . base_url($extra.link) . '" class="fauxBlockLink-blockLink">' . prefix('ticket', $extra.prefix_id) . $extra.full_title . '</a>'}) }}
<xf:if is="$extra.reason">{{ phrase('reason:') }} {$extra.reason}</xf:if>]]></template>
  <template type="public" title="alert_user_mjst_message_merge" version_id="3000031" version_string="3.0.0"><![CDATA[{{ phrase('mjst_your_messages_in_ticket_x_were_merged_together', {
	'source': '<a href="' . base_url($extra.ticketLink) . '" class="fauxBlockLink-blockLink">' . prefix('support_ticket', $extra.prefix_id) . $extra.full_title . '</a>'
}) }}
<xf:if is="$extra.reason">{{ phrase('reason:') }} {$extra.reason}</xf:if>]]></template>
  <template type="public" title="alert_user_mjst_message_move" version_id="3000031" version_string="3.0.0"><![CDATA[{{ phrase('mjst_your_message_in_ticket_x_was_moved_to_y', {
	'title': $extra.title,
	'target': '<a href="' . base_url($extra.targetLink) . '" class="fauxBlockLink-blockLink">' . prefix('support_ticket', $extra.prefix_id) . $extra.targetTitle . '</a>'
}) }}
<xf:if is="$extra.reason">{{ phrase('reason:') }} {$extra.reason}</xf:if>]]></template>
  <template type="public" title="alert_user_mjst_ticket_delete" version_id="3000031" version_string="3.0.0"><![CDATA[{{ phrase('mjst_your_ticket_x_was_deleted', {
	'title': prefix('support_ticket', $extra.prefix_id) . $extra.full_title
}) }}
<xf:if is="$extra.reason">{{ phrase('reason:') }} {$extra.reason}</xf:if>]]></template>
  <template type="public" title="alert_user_mjst_ticket_merge" version_id="3000031" version_string="3.0.0"><![CDATA[{{ phrase('mjst_your_ticket_x_was_merged_into_y', {
	'title': $extra.title,
	'target': '<a href="' . base_url($extra.targetLink) . '" class="fauxBlockLink-blockLink">' . prefix('support_ticket', $extra.prefix_id) . $extra.targetTitle . '</a>'
}) }}
<xf:if is="$extra.reason">{{ phrase('reason:') }} {$extra.reason}</xf:if>]]></template>
  <template type="public" title="alert_user_mjst_ticket_move" version_id="3000031" version_string="3.0.0"><![CDATA[{{ phrase('mjst_your_ticket_x_was_moved_to_different_department', {
	'title': '<a href="' . base_url($extra.link) . '" class="fauxBlockLink-blockLink">' . prefix('support_ticket', $extra.prefix_id) . $extra.full_title . '</a>'
}) }}
<xf:if is="$extra.reason">{{ phrase('reason:') }} {$extra.reason}</xf:if>]]></template>
  <template type="public" title="mjst.less" version_id="3000031" version_string="3.0.0"><![CDATA[// ############################ RESOURCE LIST ######################
.ticketId{
	color: @xf-textColorAttention;
	font-family: @xf-fontFamilyCode;
	word-wrap: normal;
}
.structItem-ticketTagLine
{
	font-size: @xf-fontSizeSmaller;
	margin-top: @xf-paddingSmall;
}

.structItem-cell.structItem-cell--ticketMeta
{
	width: 210px;
}

.structItem-metaItem--rating
{
	font-size: @xf-fontSizeSmall;
}

.mjstStatus{
	border: 1px solid transparent;
	border-radius: @xf-borderRadiusMedium;
	display: inline-block;
	padding: 1px .35em;
	font-size: 80%;
	line-height: ((@xf-lineHeightDefault) * .9);
	text-decoration: none;
}
.structItem-cell{
	.mjstStatus{
		float: right;
	}
}
.mjstPrioriy{
	border: 1px solid transparent;
	border-radius: @xf-borderRadiusMedium;
	display: inline-block;
	padding: 1px .35em;
	font-size: 80%;
	line-height: ((@xf-lineHeightDefault) * .9);
	text-decoration: none;
	color: #ffffff;
	&--1{
		background: #e20000;
		border-color: #af0000;
	}
	&--2{
		background: #7cc3e0;
		border-color: #53b0d6;
	}
	&--3{
		color: #000000;
		background: #c0c0c0;
		border-color: #a7a7a7;
	}
}

@media (max-width: @xf-responsiveWide)
{
	.structItem-cell.structItem-cell--ticketMeta
	{
		width: 190px;
		font-size: @xf-fontSizeSmaller;
	}
}

@media (max-width: @xf-responsiveMedium)
{
	.structItem-cell.structItem-cell--ticketMeta
	{
		display: block;
		width: auto;
		float: left;
		padding-top: 0;
		padding-left: 0;
		padding-right: 0;
		color: @xf-textColorMuted;

		.pairs
		{
			display: inline;

			&:before,
			&:after
			{
				display: none;
			}

			> dt,
			> dd
			{
				display: inline;
				float: none;
				margin: 0;
			}
		}

		.structItem-metaItem
		{
			display: inline;
		}

		.ratingStarsRow
		{
			display: inline;

			.ratingStarsRow-text
			{
				display: none;
			}
		}

		.structItem-metaItem--lastUpdate > dt
		{
			display: none;
		}

		.structItem-metaItem + .structItem-metaItem:before
		{
			display: inline;
			content: "\20\00B7\20";
			color: @xf-textColorMuted;
		}
	}
}

// #################################### RESOURCE BODY / VIEW ########################

.ticketBody
{
	display: flex;
}

.ticketBody-main
{
	flex: 1;
	min-width: 0;
	padding: @xf-blockPaddingV @xf-blockPaddingH;
}

.ticketBody-sidebar
{
	flex: 0 0 auto;
	width: 250px;
	.xf-contentAltBase();
	border-left: @xf-borderSize solid @xf-borderColor;
	padding: @xf-blockPaddingV @xf-blockPaddingH;
	font-size: @xf-fontSizeSmall;

	> :first-child
	{
		margin-top: 0;
	}

	> :last-child
	{
		margin-bottom: 0;
	}
}

.ticketBody-fields
{
	&.ticketBody-fields--before
	{
		margin-bottom: @xf-paddingLarge;
		padding-bottom: @xf-paddingMedium;
		border-bottom: @xf-borderSize solid @xf-borderColorLight;
	}

	&.ticketBody-fields--after
	{
		margin-top: @xf-paddingLarge;
		padding-top: @xf-paddingMedium;
		border-top: @xf-borderSize solid @xf-borderColorLight;
	}
}

.ticketBody-attachments
{
	margin: .5em 0;
}

.ticketBody .actionBar-set
{
	margin-top: @xf-messagePadding;
	font-size: @xf-fontSizeSmall;
}

.ticketSidebarGroup
{
	margin-bottom: @xf-elementSpacer;

	&.ticketSidebarGroup--buttons
	{
		> .button
		{
			display: block;
			margin: 5px 0;

			&:first-child
			{
				margin-top: 0;
			}

			&:last-child
			{
				margin-bottom: 0;
			}
		}
	}
}

.ticketSidebarGroup-title
{
	margin: 0;
	padding: 0;

	font-size: @xf-fontSizeLarge;
	font-weight: @xf-fontWeightNormal;
	color: @xf-textColorFeature;
	padding-bottom: @xf-paddingMedium;

	.m-hiddenLinks();
}

.ticketSidebarList
{
	.m-listPlain();

	> li
	{
		padding: @xf-paddingSmall 0;

		&:first-child
		{
			padding-top: 0;
		}

		&:last-child
		{
			padding-bottom: 0;
		}
	}
}
.urgency{
	line-height: 48px;
	width: 30px;
	text-align: center;
	display: inline-block;
	i{
		font-size: 24px;
		color: #e20000;
	}
	&.urgency-2{
		i{
			color: #7cc3e0;
		}
	}
	&.urgency-3{
		i{
			color: #c0c0c0;
		}
	}
}

@media (max-width: @xf-responsiveWide)
{
	.ticketBody
	{
		display: block;
	}

	.ticketBody-sidebar
	{
		width: auto;
		border-left: none;
		border-top: @xf-borderSize solid @xf-borderColor;
	}

	.ticketSidebarGroup
	{
		max-width: 600px;
		margin-left: auto;
		margin-right: auto;
	}
}

{{ include('mjst_status_styles.less') }}]]></template>
  <template type="public" title="mjst_account_preferences" version_id="3000230" version_string="3.0.2"><![CDATA[<xf:checkboxrow label="">
	<xf:if is="$xf.options.mjstDisableEmail">
		<xf:option name="option[disable_email_on_support_ticket]" checked="{{ !{$xf.visitor.Option.disable_email_on_support_ticket} }}"
			   label="{{ phrase('mjst_receive_email_when_new_ticket_message_is_received') }}" />
	<xf:else />
		<xf:option name="option[email_on_support_ticket]" checked="{$xf.visitor.Option.email_on_support_ticket}"
			   label="{{ phrase('mjst_receive_email_when_new_ticket_message_is_received') }}" />
	</xf:if>
	<xf:explain>{{ phrase('mjst_receive_email_ticket_explain') }}</xf:explain>
</xf:checkboxrow>]]></template>
  <template type="public" title="mjst_account_visitor_menu" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:if is="$xf.visitor.canViewSupportTickets() && $xf.options.mjstDisplayOption.nav_visitor_tab">
	<li><a href="{{ link('support-tickets/yours') }}" class="menu-linkRow">{{ phrase('mjst_your_tickets') }}</a></li>
</xf:if>]]></template>
  <template type="public" title="mjst_alert_support_ticket_assign" version_id="3000033" version_string="3.0.0"><![CDATA[{{ phrase('mjst_ticket_x_assigned_to_you', {
	'title': '<a href="' . link('support-tickets', $content) . '" class="fauxBlockLink-blockLink">' . prefix('support_ticket', $content) . $content.title . '</a>'
}) }}]]></template>
  <template type="public" title="mjst_alert_support_ticket_message_insert" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:if is="$content.isFirstMessage()">
	{{ phrase('mjst_x_created_ticket_y', {
		'name': username_link($user, false, {'defaultname': $alert.username}),
		'title': '<a href="' . link('support-tickets', $content.Ticket) . '" class="fauxBlockLink-blockLink">' . prefix('support_ticket', $content.Ticket) . $content.Ticket.title . '</a>'
	}) }}
<xf:else />
	{{ phrase('mjst_x_replied_to_ticketd_y_may_be_more', {
		'name': username_link($user, false, {'defaultname': $alert.username}),
		'title': '<a href="' . link('support-tickets/messages', $content) . '" class="fauxBlockLink-blockLink">' . prefix('support_ticket', $content.Ticket) . $content.Ticket.title . '</a>'
	}) }}
</xf:if>]]></template>
  <template type="public" title="mjst_alert_support_ticket_message_mention" version_id="3000033" version_string="3.0.0"><![CDATA[{{ phrase('mjst_x_mentioned_you_in_message_in_ticket_y', {
	'name': username_link($user, false, {'defaultname': $alert.username}),
	'title': '<a href="' . link('support-tickets/messages', $content) . '" class="fauxBlockLink-blockLink">' . prefix('support_ticket', $content.Ticket) . $content.Ticket.full_title . '</a>'
}) }}]]></template>
  <template type="public" title="mjst_alert_support_ticket_message_open" version_id="2010670" version_string="1.0.0"><![CDATA[{{ phrase('mjst_x_opened_ticket_for_you', {
	'name': username_link($user, false, {'defaultname': $alert.username}),
	'title': '<a href="' . link('support-tickets/messages', $content) . '" class="fauxBlockLink-blockLink">' . prefix('support_ticket', $content.Ticket) . $content.Ticket.title . '</a>'
}) }}]]></template>
  <template type="public" title="mjst_alert_support_ticket_message_quote" version_id="3000033" version_string="3.0.0"><![CDATA[{{ phrase('mjst_x_quoted_you_in_message_in_ticket_y', {
	'name': username_link($user, false, {'defaultname': $alert.username}),
	'title': '<a href="' . link('support-tickets/messages', $content) . '" class="fauxBlockLink-blockLink">' . prefix('support_ticket', $content.Ticket) . $content.Ticket.full_title . '</a>'
}) }}]]></template>
  <template type="public" title="mjst_department_custom_fields" version_id="3000030" version_string="3.0.0"><![CDATA[<hr class="formRowSep" />
<xf:macro template="custom_fields_macros" name="custom_fields_edit"
		  arg-type="tickets"
		  arg-set="{$ticket.custom_fields}"
		  arg-editMode="{{ $ticket.getFieldEditMode() }}"
		  arg-rowType="{$rowType}"
		  arg-onlyInclude="{$department.field_cache}" />]]></template>
  <template type="public" title="mjst_department_list.less" version_id="3000030" version_string="3.0.0"><![CDATA[@_departmentList-statsCellBreakpoint: 1000px;
.department
{
	& + .department
	{
		border-top: @xf-borderSize solid @xf-borderColorFaint;
	}
}

.department-body
{
	display: table;
	table-layout: fixed;
	width: 100%;
}
.department-main
{
	display: table-cell;
	vertical-align: middle;
	padding: @xf-paddingLarge;
}

.department-stats
{
	display: table-cell;
	width: 170px;
	vertical-align: middle;
	text-align: center;
	padding: @xf-paddingLarge 0;

	> dl.pairs.pairs--rows
	{
		width: 50%;
		float: left;
		margin: 0;
		padding: 0 @xf-paddingMedium/2;

		&:first-child
		{
			padding-left: 0;
		}

		&:last-child
		{
			padding-right: 0;
		}
	}

	&.department-stats--single
	{
		width: 100px;

		> dl.pairs.pairs--rows
		{
			width: 100%;
			float: none;
		}
	}

	&.department-stats--triple
	{
		width: 240px;

		> dl.pairs.pairs--rows
		{
			width: 33.333%;
		}
	}

	@media (max-width: @_departmentList-statsCellBreakpoint)
	{
		display: none;
	}
}

.department-title
{
	margin: 0;
	padding: 0;
	font-size: @xf-fontSizeLarge;
	font-weight: @xf-fontWeightNormal;

	.department--unread &
	{
		font-weight: @xf-fontWeightHeavy;
	}
}

.department-description
{
	font-size: @xf-fontSizeSmall;
	color: @xf-textColorDimmed;

	&.department-description--tooltip
	{
		.has-js.has-no-touchevents &
		{
			display: none;
		}
	}
}

.department-meta
{
	font-size: @xf-fontSizeSmall;
}

.department-statsMeta
{
	display: none;

	@media (max-width: @_departmentList-statsCellBreakpoint)
	{
		display: inline;
	}
}

.department-bonus
{
	font-size: @xf-fontSizeSmall;
	color: @xf-textColorMuted;
	text-align: right;
}

@media (max-width: @xf-responsiveMedium)
{
	.department-main
	{
		display: block;
		width: auto;
	}

	.department-description,
	.department-stats
	{
		display: none;
	}
}]]></template>
  <template type="public" title="mjst_department_list_macros" version_id="3000031" version_string="3.0.0"><![CDATA[<xf:macro name="simple_list_block"
	arg-departments="!" arg-selected="{{ 0 }}">
	<div class="block">
		<div class="block-container">
			<h3 class="block-header">{{ phrase('mjst_departments') }}</h3>
			<div class="block-body">
				<xf:if is="$departments is not empty">
					<ol class="categoryList is-active">
						<xf:foreach loop="$departments" key="$id" value="$department">
							<xf:set var="$isSelected" value="{{ $department.department_id == $selected }}" />
							<li class="categoryList-item">
								<div class="categoryList-itemRow">
									<a href="{{ link('support-tickets/departments', $department) }}" class="categoryList-link{{ $isSelected ? ' is-selected' : '' }}">
										{$department.title}
									</a>
									<xf:if is="{$department.canViewAnyTicket()}">
										<span class="categoryList-label">
											<span class="label label--subtle label--smallest">{$department.wait_reply_count|number_short}/{$department.active_count|number_short}/{$department.ticket_count|number_short}</span>
										</span>
									</xf:if>
								</div>
							</li>
						</xf:foreach>
					</ol>
				<xf:else />
					<div class="block-row">{{ phrase('n_a') }}</div>
				</xf:if>
			</div>
		</div>
	</div>
</xf:macro>

<xf:macro name="department"
	arg-department="!"
	arg-chooseName=""
	arg-bonusInfo="">
	<xf:css src="mjst_department_list.less" />
	<div class="department department--ticketDepartment department--ticketDepartment{$department.department_id}">
		<div class="department-body">
			<div class="department-main js-departmentMain">
				<xf:if is="$chooseName">
					<xf:checkbox standalone="true">
						<xf:option labelclass="u-pullRight" class="js-chooseItem" name="{$chooseName}[]" value="{$department.department_id}" />
					</xf:checkbox>
				</xf:if>

				<h3 class="department-title">
					<a href="{{ link('support-tickets/departments', $department) }}" data-xf-init="element-tooltip" data-shortcut="department-description">{$department.title}</a>
				</h3>
				<xf:if is="$department.short_description">
					<div class="department-description department-description--tooltip js-departmentDescTooltip">{$department.short_description|raw}</div>
				</xf:if>
				<xf:if is="{$department.canViewAnyTicket()}">
				<div class="department-meta">
					<div class="department-statsMeta">
						<dl class="pairs pairs--inline">
							<dt>{{ phrase('mjst_tickets') }}</dt>
							<dd>{$department.ticket_count|number}</dd>
						</dl>
					</div>
				</div>
				</xf:if>

				<xf:if is="$bonusInfo is not empty">
					<div class="department-bonus">{$bonusInfo}</div>
				</xf:if>
			</div>

			<div class="department-stats department-stats--single">
				<dl class="pairs pairs--rows">
					<dt>{{ phrase('mjst_tickets') }}</dt>
					<dd>{$department.ticket_count|number}</dd>
				</dl>
			</div>
		</div>
	</div>

</xf:macro>]]></template>
  <template type="public" title="mjst_department_macros" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:macro name="department_page_options" arg-department="!" arg-ticket="">
	<xf:page option="department" value="{$department}" />

	<xf:if is="{$ticket}">
		<xf:page option="searchConstraints" value="{{ {
			phrase('mjst_tickets'): {'search_type': 'support_ticket_message'},
			phrase('mjst_this_department'): {'search_type': 'support_ticket_message', 'c': {'departments': [$department.department_id], 'child_departments': 1}},
			phrase('mjst_this_ticket'): {'search_type': 'support_ticket_message', 'c': {'ticket': $ticket.support_ticket_id}}
		} }}" />
	<xf:else />
		<xf:page option="searchConstraints" value="{{ {
			phrase('mjst_tickets'): {'search_type': 'support_ticket_message'},
			phrase('mjst_this_department'): {'search_type': 'support_ticket_message', 'c': {'departments': [$department.department_id], 'child_departments': 1}}
		} }}" />
	</xf:if>
</xf:macro>]]></template>
  <template type="public" title="mjst_department_prefixes" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:macro template="prefix_macros" name="select"
	arg-name="na"
	arg-prefixes="{$prefixes}"
	arg-type="support_ticket" />]]></template>
  <template type="public" title="mjst_department_view" version_id="3000032" version_string="3.0.0"><![CDATA[<xf:title page="{$page}">{$department.title}</xf:title>
<xf:description>{$department.short_description|raw}</xf:description>

<xf:macro template="metadata_macros" name="canonical_url"
	arg-canonicalUrl="{{ link('canonical:support-tickets/departments', $department, {'page': $page}) }}" />

<xf:breadcrumb source="$department.getBreadcrumbs(false)" />

<xf:macro template="mjst_ticket_page_macros" name="ticket_page_options"
	arg-department="{$department}" />

<xf:pageaction if="$department.canOpenTicket()">
	<xf:button href="{{ link('support-tickets/open', null, {'department_id': $department.department_id}) }}" class="button--cta" icon="write" overlay="{{ {$xf.options.mjstOpenTicketOverlay} ? 'true' : '' }}">{{ phrase('mjst_open_ticket...') }}</xf:button>
</xf:pageaction>

<xf:if is="$canInlineMod">
	<xf:js src="xf/inline_mod.js" min="1" />
</xf:if>

<div class="block" data-xf-init="{{ $canInlineMod ? 'inline-mod' : '' }}" data-type="support_ticket" data-href="{{ link('inline-mod') }}">
	<div class="block-outer"><xf:trim>

		<xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}"
			link="support-tickets/departments" data="{$department}" params="{$filters}"
			wrapperclass="block-outer-main" />

		<xf:if contentcheck="true">
			<div class="block-outer-opposite">
				<div class="buttonGroup">
				<xf:contentcheck>
					<xf:if is="$canInlineMod">
						<xf:macro template="inline_mod_macros" name="button" />
					</xf:if>
					<xf:if is="$department.canWatch()">
						<xf:button href="{{ link('support-tickets/departments/watch', $department) }}" class="button--link"
							data-xf-click="switch-overlay"
							data-sk-watch="{{ phrase('watch') }}"
							data-sk-unwatch="{{ phrase('unwatch') }}">
							<xf:if is="{$department.Watch.{$xf.visitor.user_id}}">{{ phrase('unwatch') }}<xf:else />{{ phrase('watch') }}</xf:if>
						</xf:button>
					</xf:if>
				</xf:contentcheck>
				</div>
			</div>
		</xf:if>

	</xf:trim></div>

	<div class="block-container">
		<div class="block-body">
			<xf:if is="$tickets is not empty">
				<div class="structItemContainer">
					<xf:foreach loop="$tickets" value="$ticket">
						<xf:macro template="mjst_ticket_list_macros" name="ticket"
							arg-ticket="{$ticket}" />
					</xf:foreach>
				</div>
			<xf:elseif is="$filters" />
				<div class="block-row">{{ phrase('mjst_there_no_tickets_matching_your_filters') }}</div>
			<xf:else />
				<div class="block-row">{{ phrase('mjst_no_tickets_have_been_created_yet') }}</div>
			</xf:if>
		</div>
	</div>

	<div class="block-outer block-outer--after">
		<xf:pagenav
			page="{$page}" perpage="{$perPage}" total="{$total}"
			link="support-tickets" params="{$filters}"
			wrapperclass="block-outer-main" />
		<xf:showignored wrapperclass="block-outer-opposite" />
	</div>
</div>

<xf:page option="sideNavTitle">{{ phrase('mjst_departments') }}</xf:page>
<xf:sidenav>
	<xf:macro template="mjst_department_list_macros" name="simple_list_block"
		arg-departments="{$departments}"
		arg-selected="{$department.department_id}" />

	<div class="block">
		<div class="block-container">
			<h3 class="block-header">{{ phrase('mjst_filters') }}</h3>
			<div class="block-body">
				<xf:include template="mjst_filters" />
			</div>
		</div>
	</div>
</xf:sidenav>

<xf:widgetpos id="mjst_overview_sidenav" position="sidenav" />]]></template>
  <template type="public" title="mjst_department_watch" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:if is="$isWatched">
	<xf:title>{{ phrase('mjst_unwatch_department') }}</xf:title>
<xf:else />
	<xf:title>{{ phrase('mjst_watch_department') }}</xf:title>
</xf:if>

<xf:breadcrumb source="{$department.getBreadcrumbs()}" />

<xf:form action="{{ link('support-tickets/departments/watch', $department) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:if is="$isWatched">
				<xf:inforow rowtype="confirm">
					{{ phrase('mjst_you_sure_you_want_to_unwatch_this_department') }}
				</xf:inforow>
				<xf:hiddenval name="stop">1</xf:hiddenval>
			<xf:else />
				<xf:radiorow name="notify" value="ticket"
					label="{{ phrase('send_notifications_for') }}">

					<xf:option value="ticket">{{ phrase('mjst_new_tickets') }}</xf:option>
					<xf:option value="message">{{ phrase('new_messages') }}</xf:option>
					<xf:option value="" hint="{{ phrase('no_notifications_department_watch_description') }}">{{ phrase('dont_send_notifications') }}</xf:option>
				</xf:radiorow>

				<xf:checkboxrow label="{{ phrase('send_notifications_via') }}">
					<xf:option name="send_alert" value="1" selected="true">{{ phrase('alerts') }}</xf:option>
					<xf:option name="send_email" value="1">{{ phrase('emails') }}</xf:option>
				</xf:checkboxrow>
			</xf:if>
		</div>
		<xf:if is="$isWatched">
			<xf:submitrow submit="{{ phrase('unwatch') }}" rowtype="simple" icon="notificationsOff" />
		<xf:else />
			<xf:submitrow submit="{{ phrase('watch') }}" icon="notificationsOn" />
		</xf:if>
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_editor_pre_replies" version_id="3000032" version_string="3.0.0"><![CDATA[<xf:if is="count($preRepliesInfo.repliesGrouped) > 1">
	<div>
		<h3 class="tabs tabs--editor hScroller" data-xf-init="tabs h-scroller" role="tablist">
			<span class="hScroller-scroll">
			<xf:foreach loop="$preRepliesInfo.replyGroups" key="$groupId" value="$group"
				if="{$preRepliesInfo.repliesGrouped.{$groupId}} is not empty" i="$i">
				<a class="tabs-tab {{ $i == 1 ? 'is-active' : '' }}"
					role="tab" tabindex="0" aria-controls="{{ unique_id('repliesGrouped' . $i) }}">{{ $groupId ? $group.title : phrase('(ungrouped)') }}</a>
			</xf:foreach>
			</span>
		</h3>

		<ul class="tabPanes is-structureList">
			<xf:foreach loop="$preRepliesInfo.replyGroups"
				key="$groupId"
				value="$group"
				if="{$preRepliesInfo.repliesGrouped.{$groupId}} is not empty"
				i="$i">

				<li class="{{ $i == 1 ? 'is-active' : '' }} reply" role="tabpanel" id="{{ unique_id('repliesGrouped' . $i) }}">
					<ul class="listPlain is-structureList">
					<xf:foreach loop="{$preRepliesInfo.repliesGrouped.{$groupId}}" value="$reply">
						<li class="reply" data-fullmessage="">
							<div class="replyTitle">{$reply.title}</div>
							<div class="block-rowMessage">{{ snippet($reply.message, $xf.options.mjstReplySnippetLength, {'stripBbCode': true}) }}</div>
							<div class="reply-full">{{ bb_code($reply.message, 'support_pre_reply', $reply) }}</div>
						</li>
					</xf:foreach>
					</ul>
				</li>
			</xf:foreach>
		</ul>
	</div>
<xf:else />
	<div class="block-body block-row">
	<xf:foreach loop="$preRepliesInfo.replyGroups"
		key="$groupId"
		value="$group"
		if="{$preRepliesInfo.repliesGrouped.{$groupId}} is not empty"
		i="$i">
		<ul class="listPlain is-structureList">
		<xf:foreach loop="{$preRepliesInfo.repliesGrouped.{$groupId}}" value="$reply">
			<li class="reply">
				<div class="replyTitle">{$reply.title}</div>
				<div class="block-rowMessage">{{ snippet($reply.message, $xf.options.mjstReplySnippetLength, {'stripBbCode': true}) }}</div>
				<div class="reply-full">{{ bb_code($reply.message, 'support_pre_reply', $reply) }}</div>
			</li>
		</xf:foreach>
		</ul>
	</xf:foreach>
	</div>
</xf:if>]]></template>
  <template type="public" title="mjst_editor_pre_reply" version_id="3000034" version_string="3.0.0"><![CDATA[<xf:if is="{$mjstPreReplyEditor}"><xf:css src="mjst_editor_pre_reply.less" />
<xf:js src="mj/mjst/pre-reply.js" min="1" />
<script class="js-mjstPreReply" type="application/json">
	{
		"submitter": "{{ $mjstTicket.username|escape('json') }}"
	}
</script></xf:if>]]></template>
  <template type="public" title="mjst_editor_pre_reply.less" version_id="3000032" version_string="3.0.0"><![CDATA[.mjstEditorPreReplies
{
	display: none;
	border: @xf-borderSize solid @xf-borderColorHeavy;
	border-top: none;
	background: @xf-editorToolbarBg;
	overflow: hidden;
	.m-transition();
	.m-transitionProperty(all, -xf-height;);
	height: 0;

	&.is-active
	{
		display: block;
		height: auto;
	}

	&.is-transitioning
	{
		display: block;
	}

	.smilie
	{
		cursor: pointer;
	}

	.tabPanes > li
	{
		padding: @xf-blockPaddingV @xf-blockPaddingH;
	}
	.replyTitle{
		font-weight: bold;
		cursor: pointer;
	}
	.reply-full{
		display: none;
	}
}]]></template>
  <template type="public" title="mjst_filters" version_id="3000033" version_string="3.0.0"><![CDATA[<xf:form action="{{ link($department ? 'support-tickets/departments' : 'support-tickets', $department) }}" method="get">
	<!--[XF:above_created_by]-->
	<xf:if is="{{ ($xf.visitor.user_id && $xf.visitor.mjst_department_ids) || $xf.visitor.hasPermission('mjstSupport', 'viewAnyTicket') }}">
		<div class="menu-row menu-row--separated">
			{{ phrase('mjst_owner_name:') }}
			<div class="u-inputSpacer">
				<xf:textbox name="owner" value="{{ $ownerFilter ? $ownerFilter.username : '' }}" ac="single" />
			</div>
		</div>
		<div class="menu-row menu-row--separated">
			{{ phrase('mjst_assigned_to:') }}
			<div class="u-inputSpacer">
				<xf:textbox name="assigned" value="{{ $assignedFilter ? $assignedFilter.username : '' }}" ac="single" />
			</div>
		</div>
	<xf:else />
		<xf:hiddenval name="owner_id" value="{$xf.visitor.user_id}" />
	</xf:if>

	<div class="menu-row menu-row--separated">
		{{ phrase('mjst_ticket_id:') }}
		<div class="u-inputSpacer">
			<xf:textbox name="ticket_id" value="{$filters.ticket_id}" ac="single" />
		</div>
	</div>

	<!--[XF:above_status]-->
	<div class="menu-row menu-row--separated">
		{{ phrase('mjst_status:') }}
		<div class="u-inputSpacer">
			<xf:set var="$ticketStatuses" value="{{ $xf.app.em.getRepository('MJ\SupportTicket:TicketStatus').findTicketStatusList() }}" />
			<xf:select name="ticket_status_id" value="{$filters.ticket_status_id}">
				<xf:option value="">{{ phrase('(any)') }}</xf:option>
				<xf:foreach loop="$ticketStatuses" value="$_ticketStatus">
					<xf:option value="{$_ticketStatus.ticket_status_id}">{$_ticketStatus.title}</xf:option>
				</xf:foreach>
			</xf:select>
		</div>
	</div>

	<!--[XF:above_priority]-->
	<div class="menu-row menu-row--separated">
		{{ phrase('mjst_priority:') }}
		<div class="u-inputSpacer">
			<xf:select name="urgency" value="{$filters.urgency}">
				<xf:option value="">{{ phrase('(any)') }}</xf:option>
				<xf:option value="1"><span class="mjstPrioriy mjstPrioriy--1">{{ phrase('mjst_high') }}</span></xf:option>
				<xf:option value="2"><span class="mjstPrioriy mjstPrioriy--2">{{ phrase('mjst_medium') }}</span></xf:option>
				<xf:option value="3"><span class="mjstPrioriy mjstPrioriy--3">{{ phrase('mjst_low') }}</span></xf:option>
			</xf:select>
		</div>
	</div>

	<!--[XF:above_sort_by]-->
	<div class="menu-row menu-row--separated">
		{{ phrase('sort_by:') }}
		<div class="inputGroup u-inputSpacer">
			<span class="u-srOnly" id="ctrl_sort_by">{{ phrase('sort_order') }}</span>
			<xf:select name="order" value="{{ $filters.order ?: $xf.options.mjstDefaultSortOrder.order }}" aria-labelledby="ctrl_sort_by">
				<xf:option value="last_update">{{ phrase('mjst_last_update') }}</xf:option>
				<xf:option value="open_date">{{ phrase('first_message') }}</xf:option>
				<xf:option value="last_message_date">{{ phrase('last_message') }}</xf:option>
				<xf:option value="title">{{ phrase('title') }}</xf:option>
				<xf:option value="reply_count">{{ phrase('replies') }}</xf:option>
			</xf:select>
			<span class="inputGroup-splitter"></span>
			<span class="u-srOnly" id="ctrl_sort_direction">{{ phrase('sort_direction') }}</span>
			<xf:select name="direction" value="{{ $filters.direction ?: $xf.options.mjstDefaultSortOrder.direction }}" aria-labelledby="ctrl_sort_direction">
				<xf:option value="desc">{{ phrase('descending') }}</xf:option>
				<xf:option value="asc">{{ phrase('ascending') }}</xf:option>
			</xf:select>
		</div>
	</div>

	<!--[XF:above_submit]-->
	<div class="menu-footer">
		<span class="menu-footer-controls">
			<xf:button type="submit" class="button--primary">{{ phrase('filter') }}</xf:button>
		</span>
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_footer_link" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:if is="$xf.visitor.canViewSupportTickets() && $xf.options.mjstDisplayOption.footer">
	<li><a href="{{ link('support-tickets') }}">{{ phrase('mjst_support_tickets') }}</a></li>
</xf:if>]]></template>
  <template type="public" title="mjst_helper_action" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:macro name="ticket_alert" arg-selected="{{ false }}" arg-alertName="starter_alert" arg-reasonName="starter_alert_reason">
	<xf:checkboxrow>
		<xf:option name="{$alertName}" selected="{$selected}"
			label="{{ phrase('mjst_notify_ticket_starter_of_this_action') }} {{ phrase('reason:') }}">

			<xf:textbox name="{$reasonName}" placeholder="{{ phrase('optional') }}" />
			<xf:afterhint>{{ phrase('mjst_note_ticket_starter_see_alert_even_no_longer_view_ticket') }}</xf:afterhint>
		</xf:option>
	</xf:checkboxrow>
</xf:macro>]]></template>
  <template type="public" title="mjst_inline_mod_message_copy" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_inline_moderation_copy_messages') }}</xf:title>

<xf:form action="{{ link('inline-mod') }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body js-prefixListenContainer">
			<xf:inforow rowtype="confirm">{{ phrase('mjst_you_sure_you_want_to_copy_x_messages_to_new_ticket', {'count': $total}) }}</xf:inforow>

			<xf:radiorow name="ticket_type" value="{$type}">
				<xf:option value="new" checked="checked" labelclass="u-featuredText">
					<xf:label>{{ phrase('mjst_new_ticket') }}</xf:label>
					<xf:dependent>
						<label>{{ phrase('mjst_destination_department:') }}</label>
						<xf:select name="department_id" value="{$first.Ticket.department_id}" class="js-departmentList">
							<xf:foreach loop="$departments" value="$department">
								<xf:option value="{$department.department_id}">{$department.title}</xf:option>
							</xf:foreach>
						</xf:select>
					</xf:dependent>

					<xf:dependent>
						<label>{{ phrase('mjst_new_ticket_title:') }}</label>
						<xf:prefixinput
							prefixes="{$prefixes}"
							type="support_ticket"
							prefix-value="{$first.Ticket.prefix_id}"
							textbox-value="{$first.Ticket.title}"
							autofocus="autofocus"
							href="{{ link('departments/prefixes') }}"
							listen-to="< .js-prefixListenContainer | .js-departmentList"
							maxlength="{{ max_length($first.Ticket, 'title') }}" />
					</xf:dependent>
				</xf:option>

				<xf:option value="existing" labelclass="u-featuredText">
					<xf:label>{{ phrase('mjst_existing_ticket') }}</xf:label>
					<xf:dependent>
						<label>{{ phrase('mjst_ticket_url:') }}</label>
						<xf:textbox name="existing_url" type="url" />
					</xf:dependent>
				</xf:option>
			</xf:radiorow>

			<xf:macro template="helper_action" name="author_alert" arg-selected="{{ $total == 1 }}" />
		</div>
		<xf:submitrow icon="copy" />
	</div>

	<xf:foreach loop="$messages" value="$message">
		<xf:hiddenval name="ids[]">{$message.message_id}</xf:hiddenval>
	</xf:foreach>

	<xf:hiddenval name="type">support_ticket_message</xf:hiddenval>
	<xf:hiddenval name="action">copy</xf:hiddenval>
	<xf:hiddenval name="confirmed">1</xf:hiddenval>

	<xf:redirect url="{$redirect}" />
</xf:form>]]></template>
  <template type="public" title="mjst_inline_mod_message_delete" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('mjst_inline_moderation_delete_messages') }}</xf:title>

<xf:form action="{{ link('inline-mod') }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">{{ phrase('mjst_you_sure_you_want_to_delete_x_messages', {'count': $total}) }}</xf:inforow>

			<xf:if is="$firstMessageCount">
				<xf:inforow>
					<div class="blockMessage blockMessage--important"><strong>{{ phrase('note:') }}</strong> {{ phrase('mjst_x_tickets_will_be_deleted_when_these_messages_deleted', {'count': $firstMessageCount|number}) }}</div>
				</xf:inforow>
			</xf:if>

			<xf:macro template="helper_action" name="delete_type" arg-canHardDelete="{$canHardDelete}" />

			<xf:macro template="helper_action" name="author_alert" />
		</div>
		<xf:submitrow icon="delete" />
	</div>

	<xf:foreach loop="$messages" value="$message">
		<xf:hiddenval name="ids[]">{$message.message_id}</xf:hiddenval>
	</xf:foreach>

	<xf:hiddenval name="type">support_ticket_message</xf:hiddenval>
	<xf:hiddenval name="action">delete</xf:hiddenval>
	<xf:hiddenval name="confirmed">1</xf:hiddenval>

	<xf:redirect url="{$redirect}" />
</xf:form>]]></template>
  <template type="public" title="mjst_inline_mod_message_merge" version_id="3000034" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_inline_moderation_merge_messages') }}</xf:title>

<xf:form action="{{ link('inline-mod') }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">{{ phrase('mjst_you_sure_you_want_to_merge_x_messages_together', {'count': $total}) }}</xf:inforow>

			<xf:selectrow name="target_message_id" value="{$first.message_id}"
				label="{{ phrase('mjst_merge_into_message') }}">

				<xf:foreach loop="$messages" key="$messageId" value="$message">
					<xf:option value="{$messageId}">{{ $message.User.username ?: $message.username }} &middot; {{ date_time($message.message_date) }}</xf:option>
				</xf:foreach>
			</xf:selectrow>

			<xf:textarearow name="message" value="{$messageText}" rows="5" autosize="true"
				label="{{ phrase('preview') }}"
				maxlength="{$xf.options.messageMaxLength}" />

			<xf:macro template="helper_action" name="author_alert" arg-selected="{{ $total == 1 }}" />
		</div>
		<xf:submitrow icon="merge" />
	</div>

	<xf:foreach loop="$messages" value="$message">
		<xf:hiddenval name="ids[]">{$message.message_id}</xf:hiddenval>
	</xf:foreach>

	<xf:hiddenval name="type">support_ticket_message</xf:hiddenval>
	<xf:hiddenval name="action">merge</xf:hiddenval>
	<xf:hiddenval name="confirmed">1</xf:hiddenval>

	<xf:redirect url="{$redirect}" />
</xf:form>]]></template>
  <template type="public" title="mjst_inline_mod_message_move" version_id="3000033" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_inline_moderation_move_messages') }}</xf:title>

<xf:form action="{{ link('inline-mod') }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body js-prefixListenContainer">
			<xf:inforow rowtype="confirm">{{ phrase('mjst_you_sure_you_want_to_move_x_messages_to_new_ticket', {'count': $total}) }}</xf:inforow>

			<xf:radiorow name="ticket_type" value="{$type}">
				<xf:option value="new" checked="checked" labelclass="u-featuredText">
					<xf:label>{{ phrase('mjst_new_ticket') }}</xf:label>
					<xf:dependent>
						<label>{{ phrase('mjst_destination_department:') }}</label>
						<xf:select name="department_id" value="{$first.Ticket.department_id}" class="js-departmentList">
							<xf:foreach loop="$departments" value="$department">
								<xf:option value="{$department.department_id}">{$department.title}</xf:option>
							</xf:foreach>
						</xf:select>
					</xf:dependent>

					<xf:dependent>
						<label>{{ phrase('mjst_new_ticket_title:') }}</label>
						<xf:prefixinput
							prefixes="{$prefixes}"
							type="support_ticket"
							prefix-value="{$first.Ticket.prefix_id}"
							textbox-value="{$first.Ticket.title}"
							autofocus="autofocus"
							href="{{ link('support-tickets/departments/prefixes') }}"
							listen-to="< .js-prefixListenContainer | .js-departmentList"
							maxlength="{{ max_length($first.Ticket, 'title') }}" />
					</xf:dependent>
				</xf:option>

				<xf:option value="existing" labelclass="u-featuredText">
					<xf:label>{{ phrase('mjst_existing_ticket') }}</xf:label>
					<xf:dependent>
						<label>{{ phrase('mjst_ticket_url:') }}</label>
						<xf:textbox name="existing_url" type="url" />
					</xf:dependent>
				</xf:option>
			</xf:radiorow>

			<xf:macro template="helper_action" name="author_alert" arg-selected="{{ $total == 1 }}" />
		</div>
		<xf:submitrow icon="move" />
	</div>

	<xf:foreach loop="$messages" value="$message">
		<xf:hiddenval name="ids[]">{$message.message_id}</xf:hiddenval>
	</xf:foreach>

	<xf:hiddenval name="type">support_ticket_message</xf:hiddenval>
	<xf:hiddenval name="action">move</xf:hiddenval>
	<xf:hiddenval name="confirmed">1</xf:hiddenval>

	<xf:redirect url="{$redirect}" />
</xf:form>]]></template>
  <template type="public" title="mjst_inline_mod_ticket_apply_prefix" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('mjst_inline_moderation_ticket_prefix') }}</xf:title>

<xf:form action="{{ link('inline-mod') }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">{{ phrase('mjst_you_sure_you_want_to_prefix_x_tickets', {'count': $total}) }}</xf:inforow>

			<xf:macro template="prefix_macros" name="row"
				arg-type="support_ticket"
				arg-prefixes="{$prefixes}"
				arg-selected="{$selectedPrefix}"
				arg-explain="{{ ($departmentCount > 1) ? phrase('mjst_apply_ticket_prefix_to_multiple_departments') : '' }}" />
		</div>
		<xf:submitrow icon="confirm" />
	</div>

	<xf:foreach loop="$tickets" value="$ticket">
		<xf:hiddenval name="ids[]">{$ticket.support_ticket_id}</xf:hiddenval>
	</xf:foreach>

	<xf:hiddenval name="type">support_ticket</xf:hiddenval>
	<xf:hiddenval name="action">apply_prefix</xf:hiddenval>
	<xf:hiddenval name="confirmed">1</xf:hiddenval>

	<xf:redirect url="{$redirect}" />
</xf:form>]]></template>
  <template type="public" title="mjst_inline_mod_ticket_delete" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('mjst_inline_moderation_delete_tickets') }}</xf:title>

<xf:form action="{{ link('inline-mod') }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">{{ phrase('mjst_you_sure_you_want_to_delete_x_tickets', {'count': $total}) }}</xf:inforow>

			<xf:macro template="mjst_helper_action" name="ticket_alert" />
		</div>
		<xf:submitrow icon="delete" />
	</div>

	<xf:foreach loop="$tickets" value="$ticket">
		<xf:hiddenval name="ids[]">{$ticket.support_ticket_id}</xf:hiddenval>
	</xf:foreach>

	<xf:hiddenval name="type">support_ticket</xf:hiddenval>
	<xf:hiddenval name="action">delete</xf:hiddenval>
	<xf:hiddenval name="confirmed">1</xf:hiddenval>

	<xf:redirect url="{$redirect}" />
</xf:form>]]></template>
  <template type="public" title="mjst_inline_mod_ticket_merge" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_inline_moderation_merge_tickets') }}</xf:title>

<xf:form action="{{ link('inline-mod') }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">{{ phrase('mjst_you_sure_you_want_to_merge_x_tickets', {'total': $total}) }}</xf:inforow>

			<xf:selectrow name="target_ticket_id" value="{$first.support_ticket_id}"
				label="{{ phrase('mjst_destination_ticket') }}"
				explain="{{ phrase('mjst_all_messages_from_other_tickets_will_be_merged_into_this_ticket') }}">

				<xf:foreach loop="$tickets" value="$ticket">
					<xf:option value="{$ticket.support_ticket_id}">{{ prefix('support_ticket', $ticket, 'escaped') }}{$ticket.title}</xf:option>
				</xf:foreach>
			</xf:selectrow>

			<xf:macro template="mjst_helper_action" name="ticket_alert" arg-selected="{{ $total == 1 }}" />
		</div>
		<xf:submitrow icon="merge" />
	</div>

	<xf:foreach loop="$tickets" value="$ticket">
		<xf:hiddenval name="ids[]">{$ticket.support_ticket_id}</xf:hiddenval>
	</xf:foreach>

	<xf:hiddenval name="type">support_ticket</xf:hiddenval>
	<xf:hiddenval name="action">merge</xf:hiddenval>
	<xf:hiddenval name="confirmed">1</xf:hiddenval>

	<xf:redirect url="{$redirect}" />
</xf:form>]]></template>
  <template type="public" title="mjst_inline_mod_ticket_move" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:js src="xf/prefix_menu.js" min="1" />

<xf:title>{{ phrase('mjst_inline_moderation_move_tickets') }}</xf:title>

<xf:form action="{{ link('inline-mod') }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body js-prefixListenContainer">
			<xf:inforow rowtype="confirm">{{ phrase('mjst_you_sure_you_want_to_move_x_tickets', {'count': $total}) }}</xf:inforow>
			<xf:selectrow name="target_department_id" value="{$first.department_id}" class="js-departmentList"
				label="{{ phrase('mjst_destination_department') }}">

				<xf:foreach loop="$departments" value="$department">
					<xf:option value="{$department.department_id}">{$department.title}</xf:option>
				</xf:foreach>
			</xf:selectrow>

			<xf:checkboxrow>
				<xf:option name="apply_ticket_prefix"
					label="{{ phrase('mjst_apply_prefix_to_selected_tickets') }}">

					<xf:dependent>
						<xf:macro template="prefix_macros" name="select"
							arg-type="support_ticket"
							arg-prefixes="{$prefixes}"
							arg-href="{{ link('support-tickets/departments/prefixes') }}"
							arg-listenTo="< .js-prefixListenContainer | .js-departmentList" />
					</xf:dependent>
				</xf:option>
			</xf:checkboxrow>

			<xf:checkboxrow>
				<xf:option name="notify_watchers" value="1" selected="{{ $total == 1 }}">{{ phrase('mjst_notify_members_watching_destination_department') }}</xf:option>
			</xf:checkboxrow>

			<xf:macro template="mjst_helper_action" name="ticket_alert" arg-selected="{{ $total == 1 }}" />
		</div>
		<xf:submitrow icon="move" />
	</div>

	<xf:foreach loop="$tickets" value="$ticket">
		<xf:hiddenval name="ids[]">{$ticket.support_ticket_id}</xf:hiddenval>
	</xf:foreach>

	<xf:hiddenval name="type">support_ticket</xf:hiddenval>
	<xf:hiddenval name="action">move</xf:hiddenval>
	<xf:hiddenval name="confirmed">1</xf:hiddenval>

	<xf:redirect url="{$redirect}" />
</xf:form>]]></template>
  <template type="public" title="mjst_kb.less" version_id="3000332" version_string="3.0.3"><![CDATA[.kbBlocks {
	list-style: none;
	margin: 0;
	padding: 0;
	display: flex;
	flex-wrap: wrap;
	align-items: stretch;
}

.kbBlock{
	display: flex;
	flex-direction: column;
	width: 50%;
	max-width: 100%;
	padding: 6px 10px;
}
.kbBlock-vote-text{
	padding: 10px;
}]]></template>
  <template type="public" title="mjst_kb_category_view" version_id="3000332" version_string="3.0.3"><![CDATA[<xf:title page="{$page}">{$kbCategory.title}</xf:title>
<xf:description>{$kbCategory.description|raw}</xf:description>

<xf:page option="searchConstraints" value="{{ {
	phrase('mjst_tickets'): {'search_type': 'support_kb'}
} }}" />

<xf:breadcrumb href="{{ link('support-tickets/knowledge-base') }}">{{ phrase('mjst_knowledge_base') }}</xf:breadcrumb>
<xf:breadcrumb href="{{ link('support-tickets/knowledge-base/category', $kbCategory) }}">{$kbCategory.title}</xf:breadcrumb>

<xf:css src="mjst_kb.less" />

<xf:set var="$fpSnippet" value="{{ snippet($kbCategory.description, 0, {'stripBbCode': true}) }}" />

<xf:macro template="metadata_macros" name="metadata"
	arg-description="{$fpSnippet}"
	arg-shareUrl="{{ link('canonical:support-tickets/knowledge-base/category', $kbCategory, {'page': $page}) }}"
	arg-canonicalUrl="{{ link('canonical:support-tickets/knowledge-base/category', $kbCategory) }}" />

<xf:pageaction if="$xf.visitor.hasPermission('mjstKb', 'create')">
	<xf:button href="{{ link('support-tickets/knowledge-base/create', '' ,{'kb_category_id': {$kbCategory.kb_category_id}}) }}" class="button--cta" icon="write" overlay="true">{{ phrase('mjst_create_kb...') }}</xf:button>
</xf:pageaction>

<div class="block">
	<div class="block-outer"><xf:trim>
		<xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}"
			link="support-tickets/knowledge-base/category" data="{$kbCategory}"
			wrapperclass="block-outer-main" />
	</xf:trim></div>

	<div class="block-container">
		<ul class="kbItems u-clearFix">
			<xf:foreach loop="$kbs" key="$id" value="$kb">
				<xf:macro template="mjst_kb_index" name="kb_item" arg-kb="{$kb}" />
			</xf:foreach>
		</ul>
	</div>

	<div class="block-outer block-outer--after">
		<xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}"
			link="support-tickets/knowledge-base/category" data="{$kbCategory}"
			wrapperclass="block-outer-main" />
	</div>
</div>

<xf:sidenav>
	<xf:macro name="simple_list_block" />
</xf:sidenav>

<xf:macro name="simple_list_block" arg-selected="{{ 0 }}">
	<xf:set var="$categories" value="{{ $xf.app.em.getRepository('MJ\SupportTicket:KnowledgeBase').getKbCategories() }}" />

	<div class="block">
		<div class="block-container">
			<h3 class="block-header">{{ phrase('mjst_kb_categories') }}</h3>
			<div class="block-body">
				<xf:if is="$categories is not empty">
					<ol class="categoryList is-active">
						<xf:foreach loop="$categories" key="$id" value="$kbCategory">
							<xf:set var="$isSelected" value="{{ $kbCategory.kb_category_id == $selected }}" />
							<li class="categoryList-item">
								<div class="categoryList-itemRow">
									<a href="{{ link('support-tickets/knowledge-base/category', $kbCategory) }}" title="{$kbCategory.title}" class="categoryList-link{{ $isSelected ? ' is-selected' : '' }}">
										{$kbCategory.title}
									</a>
									<span class="categoryList-label">
										<span class="label label--subtle label--smallest">{$kbCategory.KnowledgeBases.count()|number_short}</span>
									</span>
								</div>
							</li>
						</xf:foreach>
					</ol>
				<xf:else />
					<div class="block-row">{{ phrase('n_a') }}</div>
				</xf:if>
			</div>
		</div>
	</div>
</xf:macro>]]></template>
  <template type="public" title="mjst_kb_delete" version_id="3000032" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('confirm_action') }}</xf:title>

<xf:form action="{{ link('support-tickets/knowledge-base/delete', $kb) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">
				{{ phrase('please_confirm_that_you_want_to_delete_following:') }}
				<strong><a href="{{ link('support-tickets/knowledge-base/edit', $kb) }}">{$kb.title}</a></strong>
			</xf:inforow>
		</div>
		<xf:submitrow rowtype="simple" icon="delete" />
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_kb_edit" version_id="3000031" version_string="3.0.0"><![CDATA[<xf:if is="$kb.isInsert()">
	<xf:title>{{ phrase('mjst_add_kb') }}</xf:title>
<xf:else />
	<xf:title>{{ phrase('mjst_edit_kb:') }}</xf:title>
</xf:if>

<xf:pageaction if="$kb.isUpdate()">
	<xf:button href="{{ link('support-tickets/knowledge-base/delete', $kb) }}" icon="delete" overlay="true" />
</xf:pageaction>

<xf:macro name="kb_categories" arg-kb="!" arg-kbCategories="!" arg-withRow="1">
	<xf:if is="$withRow">
		<xf:selectrow label="{{ phrase('mjst_kb_category') }}" name="kb_category_id" value="{$kb.kb_category_id}">
			<xf:option value="" label="{{ phrase('(none)') }}" />
			<xf:options source="{$kbCategories}" />
		</xf:selectrow>
	<xf:else />
		<xf:select name="kb_category_id" value="{$kb.kb_category_id}">
			<xf:option value="" label="{{ phrase('(none)') }}" />
			<xf:options source="{$kbCategories}" />
		</xf:select>
	</xf:if>
</xf:macro>
<xf:form action="{{ link('support-tickets/knowledge-base/save', $kb) }}" ajax="true" class="block">
	<div class="block-container">
		<div class="block-body">
			<xf:textboxrow name="title" value="{$kb.title}" label="{{ phrase('title') }}" />

			<xf:macro name="kb_categories" arg-kb="{$kb}" arg-kbCategories="{$kbCategories}" />

			<hr class="formRowSep" />
			<div data-xf-init="attachment-manager">
				<xf:editorrow name="message" value="{$kb.message}" label="{{ phrase('message') }}"
					attachments="{{ !empty({$attachmentData.attachments}) ? {$attachmentData.attachments} : [] }}"
					data-min-height="200" />
				<xf:formrow>
					<xf:if is="$attachmentData">
						<xf:macro template="public:helper_attach_upload" name="upload_block"
							arg-attachmentData="{$attachmentData}" />
					</xf:if>
				</xf:formrow>
			</div>
			<hr class="formRowSep" />

			<xf:numberboxrow name="display_order" value="{$kb.display_order}" min="0" step="1"
				label="{{ phrase('display_order') }}" />

			<xf:checkboxrow>
				<xf:option name="is_active" label="{{ phrase('mjst_active') }}" selected="{$kb.is_active}" />
			</xf:checkboxrow>
		</div>
		<xf:submitrow sticky="true" icon="save" />
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_kb_index" version_id="3000332" version_string="3.0.3"><![CDATA[<xf:title page="{$page}">{{ phrase('mjst_knowledge_bases') }}</xf:title>

<xf:page option="searchConstraints" value="{{ {
	phrase('mjst_tickets'): {'search_type': 'support_kb'}
} }}" />

<xf:pageaction if="$xf.visitor.hasPermission('mjstKb', 'create')">
	<xf:button href="{{ link('support-tickets/knowledge-base/create') }}" class="button--cta" icon="write" overlay="true">{{ phrase('mjst_create_kb...') }}</xf:button>
</xf:pageaction>

<xf:css src="mjst_kb.less" />

<div class="block block--treeEntryChooser">
	<div class="block-outer"><xf:trim>
		<xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}"
			link="support-tickets/knowledge-base"
			wrapperclass="block-outer-main" />
	</xf:trim></div>

	<div class="block-container">
		<div class="kbBlocks">
			<xf:if is="{$kbs} && $kbs is not empty">
			<div class="kbBlock">
			</xf:if>
				<h3 class="block-textHeader">
					<span class="kbBlockBlock-title">{{ phrase('mjst_kb_categories') }}</span>
				</h3>
				<xf:if is="$kbCategories is not empty">
				<xf:foreach loop="$kbCategories" key="$id" value="$kbCategory">
					<xf:macro name="kb_category" arg-kbCategory="{$kbCategory}" />
				</xf:foreach>
				<xf:else />
					<div class="block-row">{{ phrase('n_a') }}</div>
				</xf:if>
			<xf:if is="{$kbs} && $kbs is not empty">
			</div>
			<div class="kbBlock">
				<h3 class="block-textHeader">
					<span class="kbBlockBlock-title">{{ phrase('mjst_frequently_asked_questions') }}</span>
				</h3>
				<xf:foreach loop="$kbs" key="$id" value="$kb">
					<xf:macro name="kb_item" arg-kb="{$kb}" />
				</xf:foreach>
			</div>
			</xf:if>
		</div>
	</div>

	<div class="block-outer block-outer--after">
		<xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}"
			link="support-tickets/knowledge-base"
			wrapperclass="block-outer-main" />
	</div>
</div>

<xf:macro name="kb_category" arg-kbCategory="!">
	<div class="block-row block-row--clickable block-row--separated fauxBlockLink">
		<div class="contentRow contentRow--alignMiddle">
			<div class="contentRow-main">
				<h3 class="contentRow-title">
					<a href="{{ link('support-tickets/knowledge-base/category', $kbCategory) }}" class="fauxBlockLink-blockLink" title="{$kbCategory.title}">
						{$kbCategory.title}
					</a>
				</h3>
				<xf:if is="$kbCategory.description">
					<div class="contentRow-minor contentRow-minor--singleLine">
						{$kbCategory.description|strip_tags}
					</div>
				</xf:if>
			</div>
			<div class="contentRow-suffix">
				<dl class="pairs pairs--rows pairs--rows--centered">
					<dt>{{ phrase('mjst_knowledge_bases') }}</dt>
					<dd>{$kbCategory.KnowledgeBases.count()|number_short}</dd>
				</dl>
			</div>
		</div>
	</div>
</xf:macro>

<xf:macro name="kb_item" arg-kb="!">
	<div class="block-row block-row--clickable block-row--separated fauxBlockLink">
		<div class="contentRow contentRow--alignMiddle">
			<div class="contentRow-main">
				<h3 class="contentRow-title">
					<xf:if is="{$xf.options.mjstDisplayFullKb}">
					<a class="collapseTrigger collapseTrigger--block" title="{$kb.title}" data-xf-click="toggle" data-target="< :up:next">
						<span class="block-formSectionHeader-aligner">{$kb.title}</span>
					</a>
					<xf:else />
					<a href="{{ link('support-tickets/knowledge-base', $kb) }}" title="{$kb.title}" class="fauxBlockLink-blockLink">
						{$kb.title}
					</a>
					</xf:if>
				</h3>
				<xf:if is="$kb.message">
					<xf:if is="!{$xf.options.mjstDisplayFullKb}">
						<div class="contentRow-minor contentRow-minor--singleLine">
							{{ snippet($kb.message, $xf.options.mjstKbPreLength, {'stripQuote': true}) }}
						</div>
					<xf:else />
						<div class="block-body block-body--collapsible">
							{{ bb_code($kb.message, 'support_kb', $kb) }}
						</div>
					</xf:if>
				</xf:if>
			</div>
		</div>
	</div>
</xf:macro>]]></template>
  <template type="public" title="mjst_kb_suggest" version_id="3000033" version_string="3.0.0"><![CDATA[<xf:if is="{$kbs} && $kbs is not empty">
<div class="mjstKnowledgeBase">
	<h3 class="block-header block-header--separated">
		<span class="collapseTrigger collapseTrigger--block is-active" data-xf-click="toggle" data-target="< :up :next" data-xf-init="toggle-storage" data-storage-key="sp-publicFooter">
			<span class="u-anchorTarget" id="sp-publicFooter"></span><span>{{ phrase('mjst_kb_suggestion') }}</span>
			<span class="block-desc">{{ phrase('mjst_kb_suggestion_explain') }}</span>
		</span>
	</h3>
	<div class="block-body block-body--collapsible is-active">
		<div class="block-row">
			<ul class="listPlain">
				<xf:foreach loop="$kbs" value="$kb">
				<li class="block-row">
					<a href="{{ link('support-tickets/knowledge-base', $kb) }}" class="fauxBlockLink-blockLink" title="{$kb.title}" target="_blank">
						{$kb.title}
					</a>
					<xf:if is="{$xf.options.mjstKbPreLength}">
						<div class="kbSnippet">{{ snippet($kb.message, $xf.options.mjstKbPreLength, {'stripBbCode': true}) }}</div>
					</xf:if>
				</li>
				</xf:foreach>
			</ul>
		</div>
	</div>
</div>
<xf:else />
	<div></div>
</xf:if>]]></template>
  <template type="public" title="mjst_kb_view" version_id="3000332" version_string="3.0.3"><![CDATA[<xf:title>{$kb.title}</xf:title>

<xf:page option="searchConstraints" value="{{ {
	phrase('mjst_tickets'): {'search_type': 'support_kb'}
} }}" />

<xf:set var="$fpSnippet" value="{{ snippet($kb.message, 0, {'stripBbCode': true}) }}" />

<xf:macro template="metadata_macros" name="metadata"
	arg-description="{$fpSnippet}"
	arg-shareUrl="{{ link('canonical:support-tickets/knowledge-base', $kb) }}"
	arg-canonicalUrl="{{ link('canonical:support-tickets/knowledge-base', $kb) }}" />

<xf:css src="mjst_kb.less" />

<xf:breadcrumb href="{{ link('support-tickets/knowledge-base') }}">{{ phrase('mjst_knowledge_base') }}</xf:breadcrumb>
<xf:breadcrumb href="{{ link('support-tickets/knowledge-base/category', $kb.Category) }}">{$kb.Category.title}</xf:breadcrumb>

<xf:pageaction if="$kb.canEdit()">
	<xf:button href="{{ link('support-tickets/knowledge-base/edit', $kb) }}" icon="edit" overlay="true" />
</xf:pageaction>

<div class="block">
	<div class="block-container">
		<div class="block-body">
			<div class="block-row">
				<div class="message-userContent lbContainer js-lbContainer {{ $isIgnored ? 'is-ignored' : '' }}"
					data-lb-id="message-{$message.message_id}"
					data-lb-caption-desc="{{ $kb.User ? $kb.User.username : $kb.username }} &middot; {{ date_time($kb.kb_date) }}">

					<article class="message-body">
						{{ bb_code($kb.message, 'support_kb', $kb) }}
					</article>
				</div>
			</div>
		</div>
		<xf:if is="{$kb.canRate()}">
			<xf:form action="{{ link('support-tickets/knowledge-base/rate', $kb) }}" ajax="true" class="kbBlock-vote block-footer">
				<div class="inputGroup">
					<span class="kbBlock-vote-text">{{ phrase('mjst_was_this_answer_helpful') }}</span>
					<span class="inputGroup-splitter"></span>
					<xf:select class="input--autoSize" label="{{ phrase('mjst_was_this_answer_helpful') }}">
						<xf:option value="1" label="{{ phrase('yes') }}" />
						<xf:option value="0" label="{{ phrase('no') }}" />
					</xf:select>
					<span class="inputGroup-splitter"></span>
					<xf:button type="submit">{{ phrase('mjst_vote') }}</xf:button>
				</div>
			</xf:form>
		</xf:if>
	</div>
</div>

<xf:sidenav>
	<xf:macro template="mjst_kb_category_view" name="simple_list_block" />
</xf:sidenav>

<div class="blockMessage blockMessage--none">
	<xf:macro template="share_page_macros" name="buttons" arg-iconic="{{ true }}" arg-label="{{ phrase('share:') }}" />
</div>]]></template>
  <template type="public" title="mjst_message" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:if is="$canInlineMod">
	<xf:js src="xf/inline_mod.js" min="1" />
</xf:if>

<div class="block" data-xf-init="{{ $canInlineMod ? 'inline-mod' : '' }}" data-type="support_ticket_message" data-href="{{ link('inline-mod') }}">
	<div class="block-container">
		<div class="block-body">
			<xf:macro template="mjst_message_macros" name="message" arg-message="{$message}" arg-ticket="{$ticket}" />
		</div>
	</div>
</div>]]></template>
  <template type="public" title="mjst_message_delete" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_delete_message') }}</xf:title>

<xf:breadcrumb source="$ticket.getBreadcrumbs()" />

<xf:form action="{{ link('support-tickets/messages/delete', $message) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:if is="$message.isFirstPost()">
				<xf:inforow>
					<div class="blockMessage blockMessage--important"><strong>{{ phrase('note:') }}</strong> {{ phrase('mjst_this_is_first_message_in_ticket') }}</div>
				</xf:inforow>
			</xf:if>
			<xf:macro template="helper_action" name="delete_type" arg-canHardDelete="{$message.canDelete('hard')}" />

			<xf:if is="$message.canSendModeratorActionAlert()">
				<xf:macro template="helper_action" name="author_alert" />
			</xf:if>
		</div>
		<xf:submitrow icon="delete" sticky="true" />
	</div>
	<xf:redirect />
</xf:form>]]></template>
  <template type="public" title="mjst_message_edit" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_edit_message') }}</xf:title>

<xf:breadcrumb source="$ticket.getBreadcrumbs()" />

<xf:form action="{{ link('support-tickets/messages/edit', $message) }}" ajax="true" class="block"
	data-xf-init="attachment-manager{{ ($message.isFirstMessage() AND $ticket.canEdit()) ? ' message-edit' : '' }}"
	data-preview-url="{{ link('support-tickets/messages/preview', $message) }}">

	<div class="block-container">
		<div class="block-body">
			<span class="u-anchorTarget js-editContainer"></span>
			<xf:if is="$message.isFirstMessage() AND $ticket.canEdit()">
				<xf:prefixinputrow
					label="{{ phrase('title') }}"
					prefixes="{$prefixes}"
					type="ticket"
					prefix-value="{$ticket.prefix_id}"
					textbox-value="{$ticket.title}"
					placeholder="{{ phrase('title...') }}"
					rowtype="{{ $quickEdit ? 'fullWidth' : '' }}"
					maxlength="{{ max_length($ticket, 'title') }}"/>
			</xf:if>

			<xf:editorrow name="message" value="{$message.message}"
				attachments="{$attachmentData.attachments}"
				rowtype="{{ $quickEdit ? 'fullWidth noLabel' : '' }}"
				data-min-height="100"
				label="{{ phrase('message') }}" />

			<xf:formrow rowtype="{{ $quickEdit ? 'fullWidth noLabel' : '' }}">
				<xf:if is="$attachmentData">
					<xf:macro template="helper_attach_upload" name="upload_block" arg-attachmentData="{$attachmentData}" />
				</xf:if>
				<xf:button class="button--link u-jsOnly" data-xf-click="preview-click" icon="preview" />
			</xf:formrow>

			<xf:if is="$message.isFirstMessage() AND $ticket.canEdit()">
				<xf:macro template="custom_fields_macros" name="custom_fields_edit"
					arg-type="tickets"
					arg-set="{$ticket.custom_fields}"
					arg-editMode="{{ $ticket.getFieldEditMode() }}"
					arg-onlyInclude="{$department.field_cache}"
					arg-rowType="{{ $quickEdit ? 'fullWidth' : '' }}" />
			</xf:if>

			<xf:if is="$message.canEditSilently()">
				<xf:formrow rowtype="{{ $quickEdit ? 'fullWidth noLabel' : '' }}">
					<xf:macro template="helper_action" name="edit_type" arg-canEditSilently="{$message.canEditSilently()}" />
				</xf:formrow>
			</xf:if>

			<xf:if is="$message.canSendModeratorActionAlert()">
				<xf:formrow rowtype="{{ $quickEdit ? 'fullWidth noLabel' : '' }}">
					<xf:macro template="helper_action" name="author_alert" arg-row="{{ false }}" />
				</xf:formrow>
			</xf:if>
		</div>
		<xf:submitrow icon="save" sticky="true" rowtype="{{ $quickEdit ? 'simple' : '' }}">
			<xf:html>
				<xf:button class="u-jsOnly" data-xf-click="preview-click" icon="preview" />
				<xf:if is="$quickEdit">
					<xf:button class="js-cancelButton">{{ phrase('button.cancel') }}</xf:button>
				</xf:if>
			</xf:html>
		</xf:submitrow>
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_message_edit_new_message" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ prefix('support_ticket', $ticket, 'escaped') }}{$ticket.title}</xf:title>
<xf:h1>{{ prefix('support_ticket', $ticket) }}{$ticket.title}</xf:h1>

<div class="block-outer js-ticketStatusField"><xf:trim>
	<xf:if contentcheck="true">
		<div class="blockStatus blockStatus--info">
			<xf:contentcheck>
				<xf:macro template="custom_fields_macros" name="custom_fields_view"
					arg-type="tickets"
					arg-group="ticket_status"
					arg-onlyInclude="{$ticket.Department.field_cache}"
					arg-set="{$ticket.custom_fields}"
					arg-wrapperClass="blockStatus-message" />
			</xf:contentcheck>
		</div>
	</xf:if>
</xf:trim></div>

<xf:macro template="mjst_message_macros" name="message" arg-message="{$message}" arg-ticket="{$ticket}" />]]></template>
  <template type="public" title="mjst_message_macros" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:macro name="message" arg-message="!" arg-ticket="!">
	<xf:css src="message.less" />
	<xf:set var="$isIgnored" value="{{ $message.isIgnored() }}" />
	<article class="message message--message js-message js-inlineModContainer {{ $isIgnored ? 'is-ignored' : '' }} {{ $message.isUnread() ? ' is-unread' : '' }}"
		data-author="{{ $message.User.username ?: $message.username }}"
		data-content="message-{$message.message_id}"
		id="js-message-{$message.message_id}">

		<span class="u-anchorTarget" id="message-{$message.message_id}"></span>

		<div class="message-inner">
			<div class="message-cell message-cell--user">
				<xf:set var="$dateHtml"><a href="{{ link('support-tickets/message', $ticket, {'message_id': $message.message_id}) }}" class="u-concealed" rel="nofollow"><xf:date time="{$message.message_date}" /></a></xf:set>
				<xf:set var="$linkHtml"><a href="{{ link('support-tickets/message', $ticket, {'message_id': $message.message_id}) }}" class="u-concealed" rel="nofollow">#{{ number($message.position + 1) }}</a></xf:set>
				<xf:macro template="message_macros" name="user_info" arg-user="{$message.User}" arg-fallbackName="{$message.username}" arg-dateHtml="{$dateHtml}" arg-linkHtml="{$linkHtml}" />
			</div>
			<div class="message-cell message-cell--main">
				<div class="message-main js-quickEditTarget">

					<header class="message-attribution">
						<a href="{{ link('support-tickets/message', $ticket, {'message_id': $message.message_id}) }}" class="message-attribution-main u-concealed" rel="nofollow"><xf:date time="{$message.message_date}" /></a>
						<div class="message-attribution-opposite">
							<xf:if is="$message.isUnread()">
								<span class="message-newIndicator">{{ phrase('new') }}</span>
							</xf:if>
							<a href="{{ link('support-tickets/message', $ticket, {'message_id': $message.message_id}) }}" class="u-concealed" rel="nofollow">#{{ number($message.position + 1) }}</a>
						</div>
					</header>

					<div class="message-content js-messageContent">

						<xf:if is="$message.message_state == 'deleted'">
							<div class="messageNotice messageNotice--deleted">
								<xf:macro template="deletion_macros" name="notice" arg-log="{$message.DeletionLog}" />
							</div>
						<xf:elseif is="$message.message_state == 'moderated'" />
							<div class="messageNotice messageNotice--moderated">
								{{ phrase('this_message_is_awaiting_moderator_approval_and_is_invisible_to_normal') }}
							</div>
						</xf:if>
						<xf:if is="$isIgnored">
							<div class="messageNotice messageNotice--ignored">
								{{ phrase('you_are_ignoring_content_by_this_member') }}
								<xf:showignored />
							</div>
						</xf:if>

						<div class="message-userContent lbContainer js-lbContainer {{ $isIgnored ? 'is-ignored' : '' }}"
							data-lb-id="message-{$message.message_id}"
							data-lb-caption-desc="{{ $message.User ? $message.User.username : $message.username }} &middot; {{ date_time($message.message_date) }}">

							<xf:if is="$message.isFirstMessage()">
								<xf:macro template="custom_fields_macros" name="custom_fields_view"
									arg-type="tickets"
									arg-group="before"
									arg-onlyInclude="{$ticket.Department.field_cache}"
									arg-set="{$ticket.custom_fields}"
									arg-wrapperClass="message-fields message-fields--before" />
							</xf:if>

							<article class="message-body js-selectToQuote">
								<xf:ad position="message_above_content" arg-message="{$message}" />
								{{ bb_code($message.message, 'support_ticket_message', $message) }}
								<div class="js-selectToQuoteEnd">&nbsp;</div>
								<xf:ad position="message_below_content" arg-message="{$message}" />
							</article>

							<xf:if is="$message.isFirstMessage()">
								<xf:macro template="custom_fields_macros" name="custom_fields_view"
									arg-type="tickets"
									arg-group="after"
									arg-onlyInclude="{$ticket.Department.field_cache}"
									arg-set="{$ticket.custom_fields}"
									arg-wrapperClass="message-fields message-fields--after" />
							</xf:if>

							<xf:if is="$message.attach_count">
								<xf:macro template="message_macros" name="attachments"
									arg-attachments="{$message.Attachments}"
									arg-message="{$message}"
									arg-canView="{{ $ticket.canViewAttachments() }}" />
							</xf:if>
						</div>

						<xf:if is="$message.last_edit_date">
							<div class="message-lastEdit">
								<xf:if is="$message.user_id == $message.last_edit_user_id">
									{{ phrase('last_edited:') }} <xf:date time="{$message.last_edit_date}" />
								<xf:else />
									{{ phrase('last_edited_by_moderator:') }} <xf:date time="{$message.last_edit_date}" />
								</xf:if>
							</div>
						</xf:if>

						<xf:macro template="message_macros" name="signature" arg-user="{$message.User}" />
					</div>

					<footer class="message-footer">
						<xf:if contentcheck="true">
							<div class="message-actionBar actionBar">
								<xf:contentcheck>
									<xf:if contentcheck="true">
										<div class="actionBar-set actionBar-set--external">
										<xf:contentcheck>
											<xf:if is="$ticket.canReply()">
												<xf:set var="$quoteLink">{{ link('support-tickets/reply', $ticket, {'quote': $message.message_id}) }}</xf:set>

												<xf:if is="$xf.options.multiQuote">
													<a href="{$quoteLink}"
														class="actionBar-action actionBar-action--mq u-jsOnly js-multiQuote"
														title="{{ phrase('toggle_multi_quote_tooltip')|for_attr }}"
														data-message-id="{$message.message_id}"
														data-mq-action="add">{{ phrase('quote') }}</a>
												</xf:if>

												<a href="{$quoteLink}"
													class="actionBar-action actionBar-action--reply"
													title="{{ phrase('reply_quoting_this_message')|for_attr }}"
													data-xf-click="quote"
													data-quote-href="{{ link('support-tickets/messages/quote', $message) }}">{{ phrase('reply') }}</a>
											</xf:if>
										</xf:contentcheck>
										</div>
									</xf:if>

									<xf:if contentcheck="true">
										<div class="actionBar-set actionBar-set--internal">
										<xf:contentcheck>
											<xf:if is="$message.canUseInlineModeration()">
												<span class="actionBar-action actionBar-action--inlineMod">
													<xf:checkbox standalone="true">
														<xf:option value="{$message.message_id}" class="js-inlineModToggle"
															data-xf-init="tooltip"
															title="{{ phrase('select_for_moderation')|for_attr }}"
															label="{{ phrase('select_for_moderation') }}"
															hiddenlabel="true" />
													</xf:checkbox>
												</span>
											</xf:if>

											<xf:set var="$hasActionBarMenu" value="{{ false }}" />
											<xf:if is="$message.canEdit()">
												<xf:js src="xf/message.js" min="1" />
												<a href="{{ link('support-tickets/messages/edit', $message) }}"
													class="actionBar-action actionBar-action--edit actionBar-action--menuItem"
													data-xf-click="quick-edit"
													data-editor-target="#js-message-{$message.message_id} .js-quickEditTarget"
													data-menu-closer="true">{{ phrase('edit') }}</a>

												<xf:set var="$hasActionBarMenu" value="{{ true }}" />
											</xf:if>
											<xf:if is="$message.edit_count && $message.canViewHistory()">
												<a href="{{ link('support-tickets/messages/history', $message) }}"
													class="actionBar-action actionBar-action--history actionBar-action--menuItem"
													data-xf-click="toggle"
													data-target="#js-message-{$message.message_id} .js-historyTarget"
													data-menu-closer="true">{{ phrase('history') }}</a>

												<xf:set var="$hasActionBarMenu" value="{{ true }}" />
											</xf:if>
											<xf:if is="$message.canDelete('soft')">
												<a href="{{ link('support-tickets/messages/delete', $message) }}"
													class="actionBar-action actionBar-action--delete actionBar-action--menuItem"
													data-xf-click="overlay">{{ phrase('delete') }}</a>

												<xf:set var="$hasActionBarMenu" value="{{ true }}" />
											</xf:if>
											<xf:if is="$message.canCleanSpam()">
												<a href="{{ link('spam-cleaner', $message) }}"
													class="actionBar-action actionBar-action--spam actionBar-action--menuItem"
													data-xf-click="overlay">{{ phrase('spam') }}</a>

												<xf:set var="$hasActionBarMenu" value="{{ true }}" />
											</xf:if>
											<xf:if is="$xf.visitor.canViewIps() && $message.ip_id">
												<a href="{{ link('support-tickets/messages/ip', $message) }}"
													class="actionBar-action actionBar-action--ip actionBar-action--menuItem"
													data-xf-click="overlay">{{ phrase('ip') }}</a>

												<xf:set var="$hasActionBarMenu" value="{{ true }}" />
											</xf:if>

											<xf:if is="$hasActionBarMenu">
												<a class="actionBar-action actionBar-action--menuTrigger"
													data-xf-click="menu"
													title="{{ phrase('more_options')|for_attr }}"
													role="button"
													tabindex="0"
													aria-expanded="false"
													aria-haspopup="true">&#8226;&#8226;&#8226;</a>

												<div class="menu" data-menu="menu" aria-hidden="true" data-menu-builder="actionBar">
													<div class="menu-content">
														<h4 class="menu-header">{{ phrase('more_options') }}</h4>
														<div class="js-menuBuilderTarget"></div>
													</div>
												</div>
											</xf:if>
										</xf:contentcheck>
										</div>
									</xf:if>

								</xf:contentcheck>
							</div>
						</xf:if>
						<div class="js-historyTarget message-historyTarget toggleTarget" data-href="trigger-href"></div>
					</footer>
				</div>
			</div>
		</div>
	</article>

	<xf:ad position="message_below_container" arg-message="{$message}" />
</xf:macro>

<xf:macro name="message_deleted" arg-message="!" arg-ticket="!">
	<xf:css src="message.less" />
	<div class="message message--deleted message--message{{ $message.isIgnored() ? ' is-ignored' : '' }}{{ $message.isUnread() ? ' is-unread' : '' }} js-message js-inlineModContainer"
		data-author="{{ $message.User.username ?: $message.username }}"
		data-content="message-{$message.message_id}">

		<span class="u-anchorTarget" id="message-{$message.message_id}"></span>
		<div class="message-inner">
			<div class="message-cell message-cell--user">
				<xf:macro template="message_macros" name="user_info" arg-user="{$message.User}" arg-fallbackName="{$message.username}" />
			</div>
			<div class="message-cell message-cell--main">
				<div class="message-attribution">
					<ul class="listInline listInline--bullet message-attribution-main">
						<li><a href="{{ link('support-tickets/message', $ticket, {'message_id': $message.message_id}) }}" class="u-concealed" rel="nofollow"><xf:date time="{$message.message_date}" /></a></li>
						<li><xf:username user="{$message.User}" defaultname="{$message.username}" class="u-concealed" /></li>
					</ul>
				</div>

				<div class="messageNotice messageNotice--deleted">
					<xf:macro template="deletion_macros" name="notice" arg-log="{$message.DeletionLog}" />

					<a href="{{ link('support-tickets/messages/show', $message) }}" class="u-jsOnly" data-xf-click="inserter" data-replace="[data-content=message-{$message.message_id}]">{{ phrase('show...') }}</a>
				</div>
			</div>
		</div>
	</div>

	<xf:ad position="message_below_container" arg-message="{$message}" />
</xf:macro>]]></template>
  <template type="public" title="mjst_moderator_bar" version_id="3000031" version_string="3.0.0"><![CDATA[<xf:if is="$xf.visitor.is_moderator && $xf.visitor.canViewSupportTickets()">
	<xf:set var="$ticketCounts" value="{{ $xf.visitor.getTicketCounts() }}" />
	<xf:if is="{$ticketCounts}">
		<a href="{{ link('support-tickets') }}" class="p-staffBar-link badgeContainer badgeContainer--{{ $ticketCounts.waitReply > 0 ? 'highlighted' : 'visible' }}" data-badge="{$ticketCounts.waitReply|number}/{$ticketCounts.active|number}">
			{{ phrase('mjst_support_tickets') }}
		</a>
	</xf:if>
</xf:if>]]></template>
  <template type="public" title="mjst_overview" version_id="3000033" version_string="3.0.0"><![CDATA[<xf:title page="{$page}">{{ phrase('mjst_tickets') }}</xf:title>

<xf:macro template="metadata_macros" name="canonical_url"
	arg-canonicalUrl="{{ link('canonical:support-tickets', null, {'page': $page}) }}" />

<xf:page option="searchConstraints" value="{{ {
	phrase('mjst_tickets'): {'search_type': 'support_ticket'}
} }}" />

<xf:pageaction if="$xf.visitor.canOpenTicket()">
	<xf:button href="{{ link('support-tickets/open') }}" class="button--cta" icon="write" overlay="{{ {$xf.options.mjstOpenTicketOverlay} ? 'true' : '' }}">{{ phrase('mjst_open_ticket...') }}</xf:button>
</xf:pageaction>

<xf:if is="$canInlineMod">
	<xf:js src="xf/inline_mod.js" min="1" />
</xf:if>

<div class="block" data-xf-init="{{ $canInlineMod ? 'inline-mod' : '' }}" data-type="support_ticket" data-href="{{ link('inline-mod') }}">
	<div class="block-outer"><xf:trim>

		<xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}"
			link="support-tickets" params="{$filters}"
			wrapperclass="block-outer-main" />

		<xf:if contentcheck="true">
			<div class="block-outer-opposite">
				<div class="buttonGroup">
				<xf:contentcheck>
					<xf:if is="$canInlineMod">
						<xf:macro template="inline_mod_macros" name="button" />
					</xf:if>
				</xf:contentcheck>
				</div>
			</div>
		</xf:if>

	</xf:trim></div>

	<div class="block-container">
		<div class="block-body">
			<xf:if is="$tickets is not empty">
				<div class="structItemContainer">
					<xf:foreach loop="$tickets" value="$ticket">
						<xf:macro template="mjst_ticket_list_macros" name="ticket"
							arg-ticket="{$ticket}" />
					</xf:foreach>
				</div>
			<xf:elseif is="$filters" />
				<div class="block-row">{{ phrase('mjst_there_no_tickets_matching_your_filters') }}</div>
			<xf:else />
				<div class="block-row">{{ phrase('mjst_no_tickets_have_been_created_yet') }}</div>
			</xf:if>
		</div>
	</div>

	<div class="block-outer block-outer--after">
		<xf:pagenav
			page="{$page}" perpage="{$perPage}" total="{$total}"
			link="support-tickets" params="{$filters}"
			wrapperclass="block-outer-main" />
		<xf:showignored wrapperclass="block-outer-opposite" />
	</div>
</div>

<xf:page option="sideNavTitle">{{ phrase('mjst_departments') }}</xf:page>
<xf:sidenav>
	<xf:macro template="mjst_department_list_macros" name="simple_list_block"
		arg-departments="{$departments}" />

	<div class="block">
		<div class="block-container">
			<h3 class="block-header">{{ phrase('mjst_filters') }}</h3>
			<div class="block-body">
				<xf:include template="mjst_filters" />
			</div>
		</div>
	</div>
</xf:sidenav>

<xf:widgetpos id="mjst_overview_sidenav" position="sidenav" />]]></template>
  <template type="public" title="mjst_overview_macros" version_id="3000030" version_string="3.0.0"><![CDATA[]]></template>
  <template type="public" title="mjst_status_styles.less" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:foreach loop="$mjstStatusStyles" key="$id" value="$color" if="$color">
	.mjstStatus.mjstStatus--style{$id}
	{
		color: {$color|raw};
		border-color: {$color|raw};
	}
</xf:foreach>]]></template>
  <template type="public" title="mjst_ticket_assign" version_id="3000033" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_assign_ticket') }}</xf:title>

<xf:breadcrumb source="$ticket.getBreadcrumbs()" />

<xf:form action="{{ link('support-tickets/assign', $ticket) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:if is="$ticket.AssignedUser">
				<xf:formrow label="{{ phrase('mjst_current_assigned_to') }}">
					{$ticket.AssignedUser.username}
					<xf:button href="{{ link('support-tickets/unassign', $ticket) }}">{{ phrase('mjst_unassign') }}</xf:button>
				</xf:formrow>
			</xf:if>
			<xf:textboxrow name="username" value="{$ticket.AssignedUser.username}" ac="single" autocomplete="off"
				maxlength="{{ max_length($xf.visitor, 'username') }}"
				label="{{ phrase('mjst_assign_to') }}" />
		</div>
		<xf:submitrow icon="assign" />
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_ticket_close" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_close_ticket') }}</xf:title>

<xf:breadcrumb source="$ticket.getBreadcrumbs()" />

<xf:form action="{{ link('support-tickets/close', $ticket) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">
				{{ phrase('mjst_please_confirm_that_you_want_to_close_following:') }}
				<strong><a href="{{ link('support-tickets', $ticket) }}">{$ticket.title}</a></strong>
			</xf:inforow>

			<xf:if is="$ticket.canSendModeratorActionAlert()">
				<xf:macro template="mjst_helper_action" name="ticket_alert" />
			</xf:if>
		</div>
		<xf:submitrow submit="{{ phrase('mjst_close') }}" icon="lock" />
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_ticket_created" version_id="3000033" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_support_ticket_created') }}</xf:title>

<xf:css>
	.blockMessage{
		text-align: center;
		font-size: 18px;
	}
	.bigText{
		font-size: 22px;
	}
	.codeText{
		font-family: @xf-fontFamilyCode;
		direction: ltr;
		//white-space: nowrap;
		word-wrap: normal;
	}
</xf:css>

<div class="blockMessage blockMessage--success">
	{{ phrase('mjst_support_ticket_create_successfully') }}
</div>

<div class="blockMessage blockMessage--important bigText">
	<div>
		{{ phrase('mjst_ticket:') }}
		<a href="{{ link('support-tickets', $ticket) }}" title="" class="codeText">#{$ticket.ticket_id}</a>
	</div>
	<xf:if is="!{$ticket.user_id}">
		{{ phrase('mjst_password:') }} <a href="{{ link('support-tickets', $ticket) }}" title="" class="codeText">{$ticket.guest_password}</a>
	</xf:if>
</div>
]]></template>
  <template type="public" title="mjst_ticket_delete" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('mjst_delete_ticket') }}</xf:title>

<xf:breadcrumb source="$ticket.getBreadcrumbs()" />

<xf:form action="{{ link('support-tickets/delete', $ticket) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:inforow rowtype="confirm">
				{{ phrase('please_confirm_that_you_want_to_delete_following:') }}
				<strong><a href="{{ link('support-tickets', $ticket) }}">{$ticket.title}</a></strong>
			</xf:inforow>

			<xf:if is="$ticket.canSendModeratorActionAlert()">
				<xf:macro template="mjst_helper_action" name="ticket_alert" />
			</xf:if>
		</div>
		<xf:submitrow icon="delete" />
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_ticket_edit" version_id="3000033" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_edit_ticket') }}</xf:title>

<xf:js src="mj/mjst/ticket.js" min="1" />

<xf:breadcrumb source="$ticket.getBreadcrumbs()" />

<xf:form action="{{ link('support-tickets/edit', $ticket) }}"
	class="block"
	ajax="true"
	data-xf-init="ticket-edit-form"
	data-item-selector=".js-ticketListItem-{$ticket.support_ticket_id}">

	<div class="block-container">
		<div class="block-body">
			<xf:if is="$ticket.canEditTicketDepartment() && {$departments}">
				<xf:macro template="mjst_ticket_edit_macros" name="department"
					arg-departments="{$departments}"
					arg-ticket="{$ticket}" />
			</xf:if>

			<xf:if is="$ticket.canEditTicketStatus() && {$ticketStatuses}">
				<xf:macro template="mjst_ticket_edit_macros" name="status"
					arg-ticketStatuses="{$ticketStatuses}"
					arg-ticket="{$ticket}"/>
			</xf:if>

			<xf:macro template="mjst_ticket_edit_macros" name="title"
				arg-ticket="{$ticket}"
				arg-prefixes="{$prefixes}" />

			<xf:macro template="mjst_ticket_edit_macros" name="urgency"
				arg-ticket="{$ticket}" />

			<xf:macro template="mjst_ticket_edit_macros" name="custom_fields"
				arg-ticket="{$ticket}"
				arg-department="{$department}" />

			<xf:if is="{$ticket.canChangeOwner()}">
				<xf:checkboxrow>
					<xf:option name="change_owner" value="1" data-hide="true"
						label="{{ phrase('mjst_change_ticket_owner_to...') }}" >
						<xf:dependent>
							<xf:macro template="mjst_ticket_edit_macros" name="owner_type"
								arg-ticket="{$ticket}" />
						</xf:dependent>
					</xf:option>
				</xf:checkboxrow>
			</xf:if>
		</div>

		<xf:submitrow icon="save" sticky="true">
			<xf:html>
				<xf:if is="$ticket.canDelete()">
					<xf:button href="{{ link('tickets/delete', $ticket) }}" icon="delete" overlay="true">{{ phrase('delete...') }}</xf:button>
				</xf:if>
			</xf:html>
		</xf:submitrow>
	</div>

	<xf:if is="$noInlineMod">
		<xf:hiddenval name="_xfNoInlineMod">1</xf:hiddenval>
	</xf:if>
	<xf:if is="$departmentName">
		<xf:hiddenval name="_xfDepartmentName">1</xf:hiddenval>
	</xf:if>
</xf:form>]]></template>
  <template type="public" title="mjst_ticket_edit_macros" version_id="3000250" version_string="3.0.2"><![CDATA[<xf:macro name="department"
	arg-ticket="!"
	arg-departments="!"
	arg-rowtype="">
	<xf:if is="{$departments.count} == 1">
		<xf:set var="$department" value="{{ $departments.first() }}" />
		<xf:formrow label="{{ phrase('mjst_department') }}" rowtype="{$rowtype}">
			{$department.title}
			<xf:hiddenval name="department_id" value="{$department.department_id}" />
		</xf:formrow>
	<xf:else />
		<xf:selectrow name="department_id" rowtype="{$rowtype}"
			value="{$ticket.department_id}" class="js-departmentList"
			label="{{ phrase('mjst_department') }}">
			<xf:foreach loop="$departments" value="$department">
				<xf:option value="{$department.department_id}">{$department.title}</xf:option>
			</xf:foreach>
		</xf:selectrow>
	</xf:if>
</xf:macro>

<xf:macro name="urgency" arg-ticket="!" arg-rowtype="">
	<xf:radiorow name="urgency" value="{$ticket.urgency}" listclass="listInline"
		rowtype="{$rowtype}"
		label="{{ phrase('mjst_priority') }}">
		<xf:option value="1"><span class="mjstPrioriy mjstPrioriy--1">{{ phrase('mjst_high') }}</span></xf:option>
		<xf:option value="2"><span class="mjstPrioriy mjstPrioriy--2">{{ phrase('mjst_medium') }}</span></xf:option>
		<xf:option value="3"><span class="mjstPrioriy mjstPrioriy--3">{{ phrase('mjst_low') }}</span></xf:option>
	</xf:radiorow>
</xf:macro>

<xf:macro name="status" arg-ticket="!" arg-ticketStatuses="!" arg-rowtype="">
	<xf:selectrow name="ticket_status_id" rowtype="{$rowtype}"
		value="{$ticket.ticket_status_id}"
		label="{{ phrase('mjst_status') }}">
		<xf:foreach loop="$ticketStatuses" value="$_ticketStatus">
			<xf:option value="{$_ticketStatus.ticket_status_id}">{$_ticketStatus.title}</xf:option>
		</xf:foreach>
	</xf:selectrow>
</xf:macro>

<xf:macro name="title" arg-ticket="!" arg-prefixes="!">
	<xf:prefixinputrow
		label="{{ phrase('title') }}"
		prefixes="{$prefixes}"
		type="support_ticket"
		prefix-value="{$ticket.prefix_id}"
		textbox-value="{$ticket.title_}"
		textbox-class="input--title"
		href="{{ link('support-tickets/departments/prefixes') }}"
		listen-to="< .js-prefixListenContainer | .js-departmentList"
		rowtype="fullWidth noLabel"
		autofocus="autofocus"
		maxlength="{{ max_length($ticket, 'title') }}"
		placeholder="{{ phrase('title...') }}" />
</xf:macro>

<xf:macro name="message" arg-message="" arg-attachmentData="{{ [] }}">
	<div data-xf-init="attachment-manager">
		<xf:editorrow name="message" value="{$message}" data-min-height="200"
			attachments="{$attachmentData.attachments}"
			rowtype="fullWidth noLabel"
			label="{{ phrase('message') }}" />

		<xf:formrow>
			<xf:if is="$attachmentData">
				<xf:macro template="helper_attach_upload" name="upload_block" arg-attachmentData="{$attachmentData}" />
			</xf:if>
		</xf:formrow>
	</div>
</xf:macro>

<xf:macro name="custom_fields" arg-ticket="!" arg-department="!" arg-rowtype="">
	<xf:js src="mj/mjst/custom-field.js" />
	<div class="customFields" data-xf-init="mjst-custom-field"
		data-listen-to="< .js-prefixListenContainer | .js-departmentList"
		data-tid="{$ticket.support_ticket_id}"
		data-row-type="{$rowtype}"
		data-emode="{{ $ticket.getFieldEditMode() }}"
		data-href="{{ link('support-tickets/departments/custom-fields') }}">
		<xf:if contentcheck="true">
			<hr class="formRowSep" />
			<xf:contentcheck>
				<xf:macro template="custom_fields_macros" name="custom_fields_edit"
					arg-type="tickets"
					arg-set="{$ticket.custom_fields}"
					arg-editMode="{{ $ticket.getFieldEditMode() }}"
					arg-rowType="{$rowtype}"
					arg-onlyInclude="{$department.field_cache}" />
			</xf:contentcheck>
		</xf:if>
	</div>
</xf:macro>

<xf:macro name="watch_input"
	arg-ticket="!"
	arg-rowType=""
	arg-visible="{{ true }}">

	<xf:set var="$ticketWatch" value="{$ticket.Watch.{$xf.visitor.user_id}}" />
	<xf:set var="$defaultTicketWatch" value="{{
		$ticket.isInsert() ? $xf.visitor.Option.creation_watch_state : $xf.visitor.Option.interaction_watch_state
	}}" />
	<xf:set var="$watchChecked" value="{{ ($ticket.support_ticket_id AND $ticketWatch is not empty) ?: ($defaultTicketWatch != '') }}" />
	<xf:set var="$watchEmailChecked" value="{{ ($ticket.support_ticket_id AND $ticketWatch.email_subscribe) ?: ($defaultTicketWatch == 'watch_email') }}" />

	<xf:if is="$visible">
		<xf:checkboxrow label="{{ phrase('options') }}" rowtype="{$rowType}">
			<xf:option name="watch_ticket" value="1" selected="$watchChecked"
				label="{{ phrase('mjst_watch_this_ticket...') }}">

				<xf:checkbox>
					<xf:option name="watch_ticket_email" value="1" selected="$watchEmailChecked"
						label="{{ phrase('and_receive_email_notifications') }}"/>

				</xf:checkbox>
			</xf:option>
		</xf:checkboxrow>
	<xf:else />
		<xf:hiddenval name="watch_ticket" value="{$watchChecked}" />
		<xf:hiddenval name="watch_ticket_email" value="{$watchEmailChecked}" />
	</xf:if>
	<xf:hiddenval name="_xfSet[watch_ticket]" value="1" />
</xf:macro>

<xf:macro name="owner_type"
	arg-ticket="!"
	arg-draft="{{ [] }}"
	arg-rowType="">
	<xf:set var="$targetType" value="{{ $ticket.support_ticket_id ? ($ticket.user_id ? 'member' : 'guest') : ($draft.target_type ? $draft.target_type : 'member') }}" />
	<xf:radio name="target_type" value="{$targetType}">
		<xf:option value="member" data-hide="true"
			label="{{ phrase('mjst_member') }}">
			<xf:dependent>
				<div>{{ phrase('mjst_receiver:') }}</div>
				<xf:textbox name="target_member" value="{{ $ticket.username ? $ticket.username : $draft.target_member }}" ac="single" autocomplete="off"
					maxlength="{{ max_length($xf.visitor, 'username') }}"
					placeholder="{{ phrase('name...') }}" />
			</xf:dependent>
		</xf:option>
		<xf:option value="guest" data-hide="true"
			label="{{ phrase('mjst_guest') }}">
			<xf:dependent>
				<div>{{ phrase('name:') }}</div>
				<xf:textbox name="guest_username" value="{{ $ticket.username ? $ticket.username : $draft.guest_username }}"
					maxlength="{{ max_length($xf.visitor, 'username') }}"
					placeholder="{{ phrase('name...') }}" />
			</xf:dependent>
			<xf:dependent>
				<div>{{ phrase('email:') }}</div>
				<xf:textbox name="guest_email" value="{{ $ticket.user_email ? $ticket.user_email : $draft.guest_email }}"
					maxlength="{{ max_length($xf.visitor, 'email') }}"
					placeholder="{{ phrase('email...') }}" />
			</xf:dependent>
		</xf:option>
	</xf:radio>
</xf:macro>]]></template>
  <template type="public" title="mjst_ticket_edit_new_ticket" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:macro template="mjst_ticket_list_macros" name="item"
	arg-ticket="{$ticket}"
	arg-allowInlineMod="{{ $noInlineMod ? false : true }}"
	arg-department="{{ $departmentName ? null : $department }}" />]]></template>
  <template type="public" title="mjst_ticket_list_macros" version_id="3000033" version_string="3.0.0"><![CDATA[<xf:macro name="ticket"
	arg-ticket="!"
	arg-department="{{ null }}"
	arg-forceRead="{{ false }}"
	arg-showWatched="{{ true }}"
	arg-allowInlineMod="{{ true }}"
	arg-chooseName=""
	arg-extraInfo="">

	<xf:css src="structured_list.less" />
	<xf:css src="mjst.less" />

	<div class="structItem structItem--ticket {{ $ticket.isIgnored() ? 'is-ignored' : '' }}{{ ($ticket.isUnread() AND !$forceRead) ? ' is-unread' : '' }} js-inlineModContainer js-ticketListItem-{$ticket.support_ticket_id}" data-author="{{ $ticket.User.username ?: $ticket.username }}">
		<div class="structItem-cell structItem-cell--icon">
			<div class="structItem-iconContainer">
				<span class="urgency urgency-{$ticket.urgency}"><i class="fa fa-flag" aria-hidden="true"></i></span>
			</div>
		</div>
		<div class="structItem-cell structItem-cell--icon structItem-cell--iconExpanded">
			<div class="structItem-iconContainer">
				<xf:avatar user="$ticket.User" size="s" defaultname="{$ticket.username}" />
				<xf:if is="$ticket.assigned_user_id && $ticket.canViewAssigned()">
					<xf:avatar user="$ticket.AssignedUser" size="s"
						class="avatar--separated structItem-secondaryIcon" />
				</xf:if>
			</div>
		</div>
		<div class="structItem-cell structItem-cell--main" data-xf-init="touch-proxy">
			<xf:if contentcheck="true">
				<ul class="structItem-statuses">
				<xf:contentcheck>
					<xf:if is="{$showWatched} AND {$xf.visitor.user_id}">
						<xf:if is="{$ticket.Watch.{$xf.visitor.user_id}}">
							<li>
								<i class="structItem-status structItem-status--watched" aria-hidden="true" title="{{ phrase('mjst_ticket_watched')|for_attr }}"></i>
								<span class="u-srOnly">{{ phrase('mjst_ticket_watched') }}</span>
							</li>
						<xf:elseif is="!$department AND {$ticket.Department.Watch.{$xf.visitor.user_id}}" />
							<li>
								<i class="structItem-status structItem-status--watched" aria-hidden="true" title="{{ phrase('mjst_department_watched')|for_attr }}"></i>
								<span class="u-srOnly">{{ phrase('mjst_department_watched') }}</span>
							</li>
						</xf:if>
					</xf:if>
				</xf:contentcheck>
				</ul>
			</xf:if>
			<span class="mjstStatus mjstStatus--style{$ticket.ticket_status_id}">{$ticket.Status.title}</span>
			<div class="structItem-title">
				<xf:set var="$canPreview" value="{{ $ticket.canPreview() }}" />
				<xf:if is="$ticket.prefix_id">
					<xf:if is="$department">
						<a href="{{ link('support-tickets/departments', $department, {'prefix_id': $ticket.prefix_id}) }}" class="labelLink" rel="nofollow">{{ prefix('mjstTicket', $ticket, 'html', '') }}</a>
					<xf:else />
						{{ prefix('support_ticket', $ticket, 'html', '') }}
					</xf:if>
				</xf:if>
				<a href="{{ link('support-tickets' . (($ticket.isUnread() AND !$forceRead) ? '/unread' : ''), $ticket) }}" class="" data-tp-primary="on" data-xf-init="{{ $canPreview ? 'preview-tooltip' : '' }}" data-preview-url="{{ $canPreview ? link('support-tickets/preview', $ticket) : '' }}">{$ticket.getFullTitle(true)|raw}</a>
			</div>

			<div class="structItem-minor">
				<xf:if contentcheck="true">
					<ul class="structItem-extraInfo">
					<xf:contentcheck>
						<xf:if is="{$extraInfo}">
							<li>{$extraInfo}</li>
						</xf:if>
						<xf:if is="$chooseName">
							<li><xf:checkbox standalone="true">
								<xf:option name="{$chooseName}[]" value="{$ticket.support_ticket_id}" class="js-chooseItem" />
							</xf:checkbox></li>
						<xf:elseif is="$allowInlineMod AND $ticket.canUseInlineModeration()" />
							<li><xf:checkbox standalone="true"><xf:option value="{$ticket.support_ticket_id}"
								class="js-inlineModToggle"
								data-xf-init="tooltip" title="{{ phrase('select_for_moderation')|for_attr }}" /></xf:checkbox></li>
						</xf:if>
					</xf:contentcheck>
					</ul>
				</xf:if>

				<ul class="structItem-parts">
					<li><xf:username user="$ticket.User" defaultname="{$ticket.username}" /></li>
					<li class="structItem-startDate"><a href="{{ link('support-tickets', $ticket) }}" rel="nofollow"><xf:date time="{$ticket.open_date}" /></a></li>
					<xf:if is="!$department OR $department.hasChildren()">
						<li><a href="{{ link('support-tickets/departments', $ticket.Department) }}">{$ticket.Department.title}</a></li>
					</xf:if>
				</ul>
			</div>
		</div>
		<div class="structItem-cell structItem-cell--meta">
			<dl class="pairs pairs--justified structItem-minor structItem-metaItem structItem-metaItem--downloads">
				<dt>{{ phrase('replies') }}</dt>
				<dd>{$ticket.reply_count|number}</dd>
			</dl>
			<dl class="pairs pairs--justified structItem-minor structItem-metaItem structItem-metaItem--lastUpdate">
				<dd>
					<a href="{{ link('support-tickets/latest', $ticket) }}" rel="nofollow"><xf:date time="{$ticket.last_message_date}" class="structItem-latestDate" /></a>
					<div class="structItem-minor">
						<xf:if is="$xf.visitor.isIgnoring($ticket.last_message_user_id)">
							{{ phrase('ignored_member') }}
						<xf:else />
							<xf:username user="{$ticket.last_message_cache}" />
						</xf:if>
					</div>
				</dd>
			</dl>
		</div>
	</div>
</xf:macro>

<xf:macro name="ticket_simple" arg-ticket="!" arg-withMeta="{{ true }}">
	<div class="contentRow">
		<div class="contentRow-figure">
			<xf:avatar user="$ticket.User" size="xxs" />
		</div>
		<div class="contentRow-main contentRow-main--close">
			<a href="{{ link('support-tickets', $ticket) }}">{$ticket.title}</a>
			<xf:if is="$withMeta">
				<div class="contentRow-minor contentRow-minor--smaller">
					<ul class="listInline listInline--bullet">
						<li>{{ $ticket.User.username ?: $ticket.username }}</li>
						<li>{{ phrase('updated:') }} <xf:date time="{$ticket.last_update}" /></li>
					</ul>
				</div>
			</xf:if>
		</div>
	</div>
</xf:macro>]]></template>
  <template type="public" title="mjst_ticket_move" version_id="3000033" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_move_ticket:') }} {{ prefix('support_ticket', $ticket, 'escaped') }}{$ticket.title}</xf:title>
<xf:h1>{{ phrase('mjst_move_ticket:') }} {{ prefix('support_ticket', $ticket) }}{$ticket.title}</xf:h1>

<xf:breadcrumb source="$ticket.getBreadcrumbs()" />

<xf:form action="{{ link('support-tickets/move', $ticket) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body js-prefixListenContainer">
			<xf:prefixinputrow
				label="{{ phrase('title') }}"
				prefixes="{$prefixes}"
				type="support_ticket"
				prefix-value="{$ticket.prefix_id}"
				textbox-value="{$ticket.title}"
				href="{{ link('support-tickets/departments/prefixes') }}"
				listen-to="< .js-prefixListenContainer | .js-departmentList"
				autofocus="autofocus"
				maxlength="{{ max_length($ticket, 'title') }}" />

			<xf:selectrow name="target_department_id" value="{$ticket.department_id}"
				label="{{ phrase('mjst_destination_department') }}">
				<xf:foreach loop="$departments" value="$department">
					<xf:option value="{$department.department_id}">{$department.title}</xf:option>
				</xf:foreach>
			</xf:selectrow>

			<xf:checkboxrow>
				<xf:option name="notify_watchers" value="1" selected="{{ true }}">{{ phrase('mjst_notify_members_watching_destination_department') }}</xf:option>
			</xf:checkboxrow>

			<xf:if is="$ticket.canSendModeratorActionAlert()">
				<xf:macro template="mjst_helper_action" name="ticket_alert" arg-selected="{{ true }}" />
			</xf:if>
		</div>
		<xf:submitrow icon="save" sticky="true" />
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_ticket_multi_quote" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:macro template="multi_quote_macros" name="block"
	arg-quotes="{$quotes}"
	arg-messages="{$messages}"
	arg-containerRelation="Ticket"
	arg-dateKey="message_date"
	arg-bbCodeContext="support_ticket_message" />]]></template>
  <template type="public" title="mjst_ticket_new_messages" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:if is="$firstUnshownMessage">
	<div class="message">
		<div class="message-inner">
			<div class="message-cell message-cell--alert">
				{{ phrase('there_more_messages_to_display') }} <a href="{{ link('support-tickets/messages', $firstUnshownMessage) }}">{{ phrase('view_them') }}</a>
			</div>
		</div>
	</div>
</xf:if>

<xf:foreach loop="$messages" value="$message">
	<xf:macro template="mjst_message_macros" name="message" arg-message="{$message}" arg-ticket="{$ticket}" />
</xf:foreach>]]></template>
  <template type="public" title="mjst_ticket_open" version_id="3000250" version_string="3.0.2"><![CDATA[<xf:title>{{ phrase('mjst_open_ticket') }}</xf:title>

<xf:if is="$ticket.getBreadcrumbs()">
	<xf:breadcrumb source="$ticket.getBreadcrumbs()" />
</xf:if>

<xf:css src="mjst_ticket_open.less" />

<xf:form action="{{ link('support-tickets/open', $ticket) }}" upload="true" ajax="true" class="block"
	draft="{{ link('support-tickets/draft', $ticket) }}"
	data-preview-url="{{ link('support-tickets/ticket-preview') }}">
	<div class="block-container">
		<div class="block-body js-prefixListenContainer">
			<xf:macro template="mjst_ticket_edit_macros" name="department"
				arg-ticket="{$ticket}"
				arg-departments="{$departments}" />

			<xf:if is="!$xf.visitor.user_id">
				<hr class="formRowSep" />
				<xf:textboxrow name="_xfUsername" data-xf-init="guest-username"
					maxlength="{{ max_length($xf.visitor, 'username') }}"
					value="{$draf.guest_username}"
					label="{{ phrase('name') }}" />

				<xf:textboxrow name="guest_email"
					maxlength="{{ max_length($xf.visitor, 'email') }}"
					value="{$draf.guest_email}"
					label="{{ phrase('email') }}" />
			<xf:elseif is="{$xf.visitor.canOpenTicketForMember()}" />
				<xf:checkboxrow>
					<xf:option name="is_open" value="1" data-hide="true"
						checked="{$draft.is_open}"
						label="{{ phrase('mjst_open_ticket_for...') }}" >
						<xf:dependent>
							<xf:macro template="mjst_ticket_edit_macros" name="owner_type"
								arg-draft="{$draft}"
								arg-ticket="{$ticket}" />
						</xf:dependent>
					</xf:option>
				</xf:checkboxrow>
			</xf:if>

			<xf:if is="{$xf.options.mjstRequireCaptcha}">
				<xf:captcharow label="{{ phrase('verification') }}" />
			</xf:if>

			<xf:macro template="mjst_ticket_edit_macros" name="urgency"
				arg-ticket="{$ticket}" />

			<xf:macro template="mjst_ticket_edit_macros" name="title"
				arg-ticket="{$ticket}"
				arg-prefixes="{$prefixes}" />

			<xf:if is="{$xf.options.mjstNumberSuggestKb} && {$xf.visitor.canViewKb()}">
				<xf:js src="mj/mjst/kb.js" min="1" />
				<div class="formRow formRow--input formRow--fullWidth formRow--noLabel kbSuggest">
					<div class="mjstKbSuggest" data-xf-init="mjst-kb-suggest"></div>
				</div>
			</xf:if>

			<xf:macro template="mjst_ticket_edit_macros" name="message"
				arg-message="{$draft.message}"
				arg-attachmentData="{$attachmentData}" />

			<hr class="formRowSep" />
			<xf:macro template="mjst_ticket_edit_macros" name="custom_fields"
				arg-ticket="{$ticket}"
				arg-department="{$department}" />

			<hr class="formRowSep" />

			<xf:if is="$xf.visitor.user_id">
				<hr class="formRowSep" />
				<xf:macro template="mjst_ticket_edit_macros" name="watch_input" arg-ticket="{$ticket}" />
			</xf:if>
		</div>

		<xf:submitrow submit="{{ phrase('mjst_open_ticket') }}" icon="write" sticky="true">
			<xf:html>
				<xf:button class="u-jsOnly" data-xf-click="preview-click" icon="preview" />
			</xf:html>
		</xf:submitrow>
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_ticket_open.less" version_id="3000032" version_string="3.0.0"><![CDATA[.formRow.kbSuggest > dd{
	padding: 0;
}]]></template>
  <template type="public" title="mjst_ticket_page_macros" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:macro name="ticket_page_options" arg-department="!" arg-ticket="{{ null }}">
	<xf:page option="ticketDepartment" value="{$department}" />

	<xf:page option="searchConstraints" value="{{ {
		phrase('mjst_tickets'): {'search_type': 'support_ticket'},
		phrase('mjst_this_department'): {'search_type': 'support_ticket', 'd': {'categories': [$department.department_id]}}
	} }}" />
</xf:macro>]]></template>
  <template type="public" title="mjst_ticket_password" version_id="3000031" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_password_for_ticket:') }} {$ticket.full_title}</xf:title>

<xf:if is="$ticket.getBreadcrumbs()">
	<xf:breadcrumb source="$ticket.getBreadcrumbs()" />
</xf:if>

<xf:css>
	.blockMessage{
		text-align: center;
		font-size: 18px;
	}
	.bigText{
		font-size: 22px;
	}
	.codeText{
		font-family: @xf-fontFamilyCode;
		direction: ltr;
		//white-space: nowrap;
		word-wrap: normal;
	}
</xf:css>

<xf:if is="!{$ticket.canViewGuestTicket()}">
<xf:form action="{{ link('support-tickets/password', $ticket) }}" ajax="true" class="block">
	<div class="block-container">
		<div class="block-body">
			<xf:textboxrow name="password" type="password"
				label="{{ phrase('password') }}" />
		</div>
		<xf:submitrow submit="{{ phrase('mjst_enter_ticket') }}" icon="write" sticky="true">
		</xf:submitrow>
	</div>
</xf:form>
<xf:else />
	<div class="blockMessage blockMessage--important bigText">
		<xf:if is="!{$ticket.user_id}">
			{{ phrase('mjst_password:') }} <span class="codeText">{$ticket.guest_password}</span>
		</xf:if>
	</div>
</xf:if>]]></template>
  <template type="public" title="mjst_ticket_preview" version_id="2010670" version_string="1.0.0"><![CDATA[<div class="tooltip-content-inner">
	{{ bb_code($firstMessage.message, 'support_ticket_message:ticket_preview', $firstMessage, {
		'lightbox': false
	}) }}
	<span class="tooltip-content-cover"></span>
</div>]]></template>
  <template type="public" title="mjst_ticket_rate" version_id="3000031" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_rate_this_ticket') }}</xf:title>

<xf:breadcrumb source="$ticket.getBreadcrumbs()" />

<xf:form action="{{ link('support-tickets/rate', $ticket) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:if is="$existingRating">
				<xf:inforow rowtype="confirm">
					{{ phrase('mjst_you_have_already_rated_this_ticket_rerating_remove_existing') }}
				</xf:inforow>
			</xf:if>

			<xf:macro template="rating_macros" name="rating"
				arg-currentRating="{$ticket.submitter_rating}"/>
		</div>
		<xf:submitrow submit="{{ phrase('submit_rating') }}" icon="rate" />
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_ticket_reply" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:title>{{ phrase('mjst_reply_to_ticket') }}</xf:title>

<xf:head option="metaNoindex"><meta name="robots" content="noindex" /></xf:head>

<xf:breadcrumb source="$ticket.getBreadcrumbs()" />

<xf:form action="{{ link('support-tickets/add-reply', $ticket) }}" class="block" ajax="true" draft="{{ link('support-tickets/draft', $ticket) }}" data-xf-init="attachment-manager" data-preview-url="{{ link('tickets/reply-preview', $ticket) }}">
	<div class="block-container">
		<div class="block-body">
			<xf:editorrow name="message"
				value="{$defaultMessage}"
				attachments="{{ $attachmentData ? $attachmentData.attachments : [] }}"
				rowtype="fullWidth noLabel"
				placeholder="{{ phrase('reply_placeholder') }}"
				label="{{ phrase('message') }}" />

			<xf:formrow>
				<xf:if is="$attachmentData">
					<xf:macro template="helper_attach_upload" name="upload_block"
						arg-attachmentData="{$attachmentData}"
						arg-forceHash="{$ticket.draft_reply.attachment_hash}" />
				</xf:if>

				<xf:if is="$xf.options.multiQuote">
					<xf:macro template="multi_quote_macros" name="button"
						arg-href="{{ link('support-tickets/multi-quote', $ticket) }}"
						arg-messageSelector=".js-post"
						arg-storageKey="multiQuoteTicket" />
				</xf:if>
				<xf:button class="button--link u-jsOnly" data-xf-click="preview-click" icon="preview" />
			</xf:formrow>

			<xf:if is="!$xf.visitor.user_id">
				<xf:textboxrow name="_xfUsername" data-xf-init="guest-username"
					maxlength="{{ max_length($xf.visitor, 'username') }}"
					label="{{ phrase('name') }}"/>

				<xf:captcharow label="{{ phrase('verification') }}" />
			<xf:else />
				<xf:macro template="mjst_ticket_edit_macros" name="watch_input" arg-ticket="{$ticket}" />
			</xf:if>
		</div>
		<xf:submitrow submit="{{ phrase('post_reply') }}" icon="reply" sticky="true" />
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_ticket_view" version_id="3000331" version_string="3.0.3"><![CDATA[<xf:title page="{$page}">{{ prefix('support_ticket', $ticket, 'escaped') }}{$ticket.full_title}</xf:title>
<xf:h1><span class="urgency urgency-{$ticket.urgency}"><i class="fa fa-flag" aria-hidden="true"></i></span> {{ prefix('support_ticket', $ticket) }}{$ticket.getFullTitle(true)|raw}</xf:h1>

<xf:css src="mjst.less" />
<xf:description meta="false">
	<ul class="listInline listInline--bullet">
		<li>
			<i class="fa fa-user" aria-hidden="true" title="{{ phrase('mjst_ticket_sumitter')|for_attr }}"></i>
			<span class="u-srOnly">{{ phrase('mjst_ticket_sumitter') }}</span>

			<xf:username user="{$ticket.User}" defaultname="{$ticket.username}" class="u-concealed" />
		</li>
		<li>
			<i class="fa fa-clock-o" aria-hidden="true" title="{{ phrase('start_date')|for_attr }}"></i>
			<span class="u-srOnly">{{ phrase('start_date') }}</span>

			<a href="{{ link('support-tickets', $ticket) }}" class="u-concealed"><xf:date time="{$ticket.open_date}" /></a>
		</li>
	</ul>
</xf:description>

<xf:set var="$fpSnippet" value="{{ snippet($firstMessage.message, 0, {'stripBbCode': true}) }}" />

<xf:macro template="metadata_macros" name="metadata"
	arg-description="{$fpSnippet}"
	arg-shareUrl="{{ link('canonical:support-tickets', $ticket) }}"
	arg-canonicalUrl="{{ link('canonical:support-tickets', $ticket, {'page': $page}) }}" />

<!--[XF:content_top]-->

<xf:if is="$pendingApproval">
	<div class="blockMessage blockMessage--important">{{ phrase('content_submitted_displayed_pending_approval') }}</div>
</xf:if>

<xf:macro template="mjst_department_macros" name="department_page_options" arg-department="{$department}" arg-ticket="{$ticket}" />

<xf:breadcrumb source="$department.getBreadcrumbs()" />

<xf:if is="$canInlineMod OR $ticket.canUseInlineModeration()">
	<xf:js src="xf/inline_mod.js" min="1" />
</xf:if>

<xf:macro template="lightbox_macros" name="setup" arg-canViewAttachments="{$ticket.canViewAttachments()}" />

<xf:ad position="ticket_view_above_messages" arg-ticket="{$ticket}" />

<div class="block block--messages" data-xf-init="{{ $canInlineMod ? 'inline-mod' : '' }}" data-type="support_ticket_message" data-href="{{ link('inline-mod') }}">

	<div class="block-outer"><xf:trim>
		<xf:pagenav
			page="{$page}" perpage="{$perPage}" total="{{ $ticket.reply_count + 1 }}"
			link="support-tickets" data="{$ticket}"
			wrapperclass="block-outer-main" />
		<xf:if contentcheck="true">
			<div class="block-outer-opposite">
				<div class="buttonGroup">
				<xf:contentcheck>
					<xf:if is="$canInlineMod">
						<xf:macro template="inline_mod_macros" name="button" />
					</xf:if>
					<xf:if is="$ticket.canClose() AND !$ticket.isClosed()">
						<xf:button href="{{ link('support-tickets/close', $ticket) }}" class="button--link" overlay="true">
							{{ phrase('mjst_close') }}
						</xf:button>
					</xf:if>
					<xf:if is="$xf.visitor.user_id AND $ticket.isUnread()">
						<xf:button href="{{ $firstUnread ? ('#message-' . $firstUnread.message_id) : link('support-tickets/unread', $ticket, {'new': 1}) }}"
							class="button--link"
							data-xf-click="scroll-to"
							data-silent="true">
								{{ phrase('jump_to_new') }}
						</xf:button>
					</xf:if>
					<xf:if is="$ticket.canWatch()">
						<xf:button href="{{ link('support-tickets/watch', $ticket) }}" class="button--link"
							data-xf-click="switch-overlay"
							data-sk-watch="{{ phrase('watch') }}"
							data-sk-unwatch="{{ phrase('unwatch') }}">
							<xf:if is="{$ticket.Watch.{$xf.visitor.user_id}}">
								{{ phrase('unwatch') }}
							<xf:else />
								{{ phrase('watch') }}
							</xf:if>
						</xf:button>
					</xf:if>

					<xf:if contentcheck="true">
						<div class="buttonGroup-buttonWrapper">
							<xf:button class="button--link menuTrigger" data-xf-click="menu" aria-expanded="false" aria-haspopup="true" title="{{ phrase('more_options')|for_attr }}">&#8226;&#8226;&#8226;</xf:button>
							<div class="menu" data-menu="menu" aria-hidden="true">
								<div class="menu-content">
									<h4 class="menu-header">{{ phrase('more_options') }}</h4>
									<xf:contentcheck>
										<!--[XF:ticket_tools_menu:top]-->
										<xf:if is="$ticket.canAssignSupportTicket()">
											<a href="{{ link('support-tickets/assign', $ticket) }}" data-xf-click="overlay" class="menu-linkRow">{{ phrase('mjst_assign_ticket') }}</a>
										</xf:if>
										<xf:if is="$ticket.canEdit()">
											<a href="{{ link('support-tickets/edit', $ticket) }}" data-xf-click="overlay" class="menu-linkRow">{{ phrase('mjst_edit_ticket') }}</a>
										</xf:if>
										<xf:if is="$ticket.canDelete()">
											<a href="{{ link('support-tickets/delete', $ticket) }}" data-xf-click="overlay" class="menu-linkRow">{{ phrase('mjst_delete_ticket') }}</a>
										</xf:if>
										<xf:if is="$ticket.canMove()">
											<a href="{{ link('support-tickets/move', $ticket) }}" data-xf-click="overlay" class="menu-linkRow">{{ phrase('mjst_move_ticket') }}</a>
										</xf:if>
										<xf:if is="$ticket.canViewModeratorLogs()">
											<a href="{{ link('support-tickets/moderator-actions', $ticket) }}" data-xf-click="overlay" class="menu-linkRow">{{ phrase('moderator_actions') }}</a>
										</xf:if>
										<xf:if is="$ticket.canViewGuestTicket() && !$ticket.user_id">
											<a href="{{ link('support-tickets/password', $ticket) }}" data-xf-click="overlay" class="menu-linkRow">{{ phrase('mjst_guest_password') }}</a>
										</xf:if>
										<!--[XF:ticket_tools_menu:before_footer]-->
										<xf:if is="$ticket.canUseInlineModeration()">
											<div class="menu-footer"
												data-xf-init="inline-mod"
												data-type="support_ticket"
												data-href="{{ link('inline-mod') }}"
												data-toggle=".js-ticketInlineModToggle">
												<xf:checkbox>
													<xf:option class="js-ticketInlineModToggle" value="{$ticket.support_ticket_id}">{{ phrase('select_for_moderation') }}</xf:option>
												</xf:checkbox>
											</div>
										</xf:if>
										<!--[XF:ticket_tools_menu:bottom]-->
									</xf:contentcheck>
								</div>
							</div>
						</div>
					</xf:if>
				</xf:contentcheck>
				</div>
			</div>
		</xf:if>
	</xf:trim></div>

	<div class="block-outer js-ticketStatusField"><xf:trim>
		<xf:if contentcheck="true">
			<div class="blockStatus blockStatus--info">
				<xf:contentcheck>
					<xf:macro template="custom_fields_macros" name="custom_fields_view"
						arg-type="tickets"
						arg-group="ticket_status"
						arg-onlyInclude="{$department.field_cache}"
						arg-set="{$ticket.custom_fields}"
						arg-wrapperClass="blockStatus-message" />
				</xf:contentcheck>
			</div>
		</xf:if>
	</xf:trim></div>

	<div class="block-container lbContainer"
		data-xf-init="lightbox{{ $xf.options.selectQuotable ? ' select-to-quote' : '' }}"
		data-message-selector=".js-message"
		data-lb-id="ticket-{$ticket.support_ticket_id}"
		data-lb-universal="{$xf.options.lightBoxUniversal}">

		<div class="block-body js-replyNewMessageContainer">
			<xf:foreach loop="$messages" value="$message">
				<xf:if is="$message.message_state == 'deleted'">
					<xf:macro template="mjst_message_macros" name="message_deleted"
						arg-message="{$message}"
						arg-ticket="{$ticket}" />
				<xf:else />
					<xf:macro template="mjst_message_macros" name="message"
						arg-message="{$message}"
						arg-ticket="{$ticket}" />
				</xf:if>
			</xf:foreach>
		</div>
	</div>

	<xf:if contentcheck="true">
		<div class="block-outer block-outer--after">
			<xf:contentcheck>
				<xf:pagenav
					page="{$page}" perpage="{$perPage}" total="{{ $ticket.reply_count + 1 }}"
					link="support-tickets" data="{$ticket}"
					wrapperclass="block-outer-main" />
				<xf:showignored wrapperclass="block-outer-opposite" />
				<xf:if is="!$ticket.canReply()">
					<div class="block-outer-opposite">
						<xf:if is="$xf.visitor.user_id">
							<span class="button is-disabled">
								{{ phrase('no_permission_to_reply') }}
								<!-- this is not interactive so shouldn't be a button element -->
							</span>
						<xf:else />
							<xf:button href="{{ link('login') }}" class="button--link" overlay="true">
								{{ phrase('log_in_or_register_to_reply') }}
							</xf:button>
						</xf:if>
					</div>
				</xf:if>
			</xf:contentcheck>
		</div>
	</xf:if>
</div>

<xf:ad position="ticket_view_below_messages" arg-ticket="{$ticket}" />

<xf:if is="$ticket.canReply()">
	<xf:form action="{{ link('support-tickets/add-reply', $ticket) }}"
		ajax="true"
		draft="{{ link('support-tickets/draft', $ticket) }}"
		class="block js-quickReply"
		data-xf-init="attachment-manager quick-reply{{ $xf.visitor.isShownCaptcha() ? ' guest-captcha' : '' }}"
		data-message-container=".js-replyNewMessageContainer"
		data-preview-url="{{ link('support-tickets/reply-preview', $ticket, {'quick_reply': 1}) }}">

		<xf:js src="xf/message.js" min="1" />
		<xf:set var="$lastMessage" value="{$messages|last}" />

		<div class="block-container">
			<div class="block-body">
				<xf:macro template="quick_reply_macros" name="body"
					arg-message="{$ticket.draft_reply.message}"
					arg-attachmentData="{$attachmentData}"
					arg-forceHash="{$ticket.draft_reply.attachment_hash}"
					arg-messageSelector=".js-message"
					arg-multiQuoteHref="{{ link('support-tickets/multi-quote', $ticket) }}"
					arg-multiQuoteStorageKey="multiQuoteticket"
					arg-lastDate="{$lastMessage.message_date}"
					arg-lastKnownDate="{$ticket.last_message_date}" />
			</div>
		</div>
	</xf:form>
</xf:if>

<xf:sidebar>
	<xf:if is="{$ticket.ticket_status_id}==4">
		<div class="block">
			<div class="block-container">
				<h3 class="block-minorHeader">{{ phrase('mjst_submitter_rating') }}</h3>
				<div class="block-body">
					<xf:macro template="rating_macros" name="rating"
						arg-currentRating="{$ticket.submitter_rating}"
						arg-rowType="fullWidth"
						arg-ratingHref="{{ $ticket.canRate() ? link('support-tickets/rate', $ticket) : '' }}"/>
				</div>
			</div>
		</div>
	</xf:if>
	<div class="block">
		<div class="block-container">
			<h3 class="block-minorHeader">{{ phrase('mjst_ticket_info') }}</h3>
			<xf:if is="{{ $xf.options.mjstQuickUpdate && $ticket.canEdit() }}">
			<xf:form action="{{ link('support-tickets/edit', $ticket) }}" ajax="true">
				<div class="block-body js-prefixListenContainer">
					<xf:formrow rowtype="fullWidth" label="{{ phrase('mjst_open_date') }}">
						<xf:date time="{$ticket.open_date}" />
					</xf:formrow>
					<xf:if is="$ticket.canEditTicketDepartment() && {$departments}">
						<xf:macro template="mjst_ticket_edit_macros" name="department"
							arg-departments="{$departments}"
							arg-ticket="{$ticket}"
							arg-rowtype="fullWidth" />
					<xf:else />
						<xf:formrow rowtype="fullWidth" label="{{ phrase('mjst_department') }}">
							{$ticket.Department.title}
						</xf:formrow>
					</xf:if>
					<xf:if is="{$ticket.assigned_user_id} && ($department.canAssignTickets() || $department.canViewAssignedStaff())">
						<xf:formrow rowtype="fullWidth" label="{{ phrase('mjst_assigned_to') }}">
							{$ticket.AssignedUser.username}
						</xf:formrow>
						<xf:if is="$department.canAssignTickets()">
							<xf:checkboxrow label="" rowtype="fullWidth">
								<xf:option name="unassign" value="1" label="{{ phrase('unassign') }}" />
							</xf:checkboxrow>
						</xf:if>
					</xf:if>
					<xf:if is="$ticket.canEditTicketStatus() && {$ticketStatuses}">
						<xf:macro template="mjst_ticket_edit_macros" name="status"
							arg-ticketStatuses="{$ticketStatuses}"
							arg-ticket="{$ticket}"
							arg-rowtype="fullWidth" />
					<xf:else />
						<xf:formrow rowtype="fullWidth" label="{{ phrase('mjst_status') }}">
							<span class="mjstStatus mjstStatus--style{$ticket.ticket_status_id}">{$ticket.Status.title}</span>
						</xf:formrow>
					</xf:if>

					<xf:macro template="mjst_ticket_edit_macros" name="urgency"
						arg-ticket="{$ticket}"
						arg-rowtype="fullWidth" />

					<xf:macro template="mjst_ticket_edit_macros" name="custom_fields"
						arg-ticket="{$ticket}"
						arg-department="{$department}"
						arg-rowtype="fullWidth" />
				</div>
				<div class="block-footer">
					<span class="block-footer-controls">
						<xf:hiddenval name="quick_update" value="1" />
						<input type="submit" value="{{ phrase('update') }}" accesskey="s" class="button primary" />
						<xf:hiddenval name="quick_update" value="1" />
					</span>
				</div>
			</xf:form>
			<xf:else />
				<div class="block-body block-row">
					<dl class="pairs pairs--justified pairs--plainLabel">
						<dt>{{ phrase('mjst_open_date') }}</dt>
						<dd><xf:date time="{$ticket.open_date}" /></dd>
					</dl>
					<dl class="pairs pairs--justified pairs--plainLabel">
						<dt>{{ phrase('mjst_department') }}</dt>
						<dd>{$ticket.Department.title}</dd>
					</dl>
					<xf:if is="{$ticket.assigned_user_id} && ($department.canAssignTickets() || $department.canViewAssignedStaff())">
						<dl class="pairs pairs--justified pairs--plainLabel">
							<dt>{{ phrase('mjst_assigned_to') }}</dt>
							<dd>{$ticket.AssignedUser.username}</dd>
						</dl>
					</xf:if>
					<dl class="pairs pairs--justified pairs--plainLabel">
						<dt>{{ phrase('mjst_status') }}</dt>
						<dd><span class="mjstStatus mjstStatus--style{$ticket.ticket_status_id}">{$ticket.Status.title}</span></dd>
					</dl>
					<dl class="pairs pairs--justified pairs--plainLabel">
						<dt>{{ phrase('mjst_priority') }}</dt>
						<dd><span class="mjstPrioriy mjstPrioriy--{$ticket.urgency}">{$ticket.urgency_title}</span></dd>
					</dl>
					<xf:macro template="custom_fields_macros" name="custom_fields_view"
						arg-type="tickets"
						arg-group="ticket_info"
						arg-onlyInclude="{$ticket.Department.field_cache}"
						arg-set="{$ticket.custom_fields}"
						arg-wrapperClass="ticket-fields ticket-fields--ticket_info" />
				</div>
			</xf:if>
		</div>
	</div>

	<div class="block">
		<div class="block-container">
			<h3 class="block-minorHeader">{{ phrase('mjst_submitter_info') }}</h3>
			<div class="block-body block-row">
				<xf:if is="!{$ticket.user_id}">
					<dl class="pairs pairs--justified pairs--plainLabel">
						<dt>{{ phrase('name') }}</dt>
						<dd>{$ticket.username}</dd>
					</dl>
					<dl class="pairs pairs--justified pairs--plainLabel">
						<dt>{{ phrase('email') }}</dt>
						<dd>{$ticket.user_email}</dd>
					</dl>
				<xf:else />
					<dl class="pairs pairs--justified pairs--plainLabel">
						<dt>{{ phrase('name') }}</dt>
						<dd>{$ticket.User.username}</dd>
					</dl>
					<dl class="pairs pairs--justified pairs--plainLabel">
						<dt>{{ phrase('email') }}</dt>
						<dd>{$ticket.User.email}</dd>
					</dl>
					<dl class="pairs pairs--justified pairs--plainLabel">
						<dt>{{ phrase('mjst_tickets') }}</dt>
						<dd>{$ticket.User.mjst_ticket_count|number}</dd>
					</dl>
				</xf:if>
				<xf:if is="{{ $ticket.canViewSubmitterIp() && $xf.options.mjstDisplaySubmitterIp && $ticket.FirstMessage.Ip }}">
					<dl class="pairs pairs--justified pairs--plainLabel">
						<dt>{{ phrase('mjst_submitter_ip') }}</dt>
						<dd>{$ticket.FirstMessage.Ip.ip|ip}</dd>
					</dl>
				</xf:if>
				<xf:macro template="custom_fields_macros" name="custom_fields_view"
					arg-type="tickets"
					arg-group="submitter_info"
					arg-onlyInclude="{$ticket.Department.field_cache}"
					arg-set="{$ticket.custom_fields}"
					arg-wrapperClass="ticket-fields ticket-fields--submitter_info" />
			</div>
		</div>
	</div>
	<xf:if is="$ticket.canViewCurrentViewer() && $viewers is not empty">
		<xf:if contentcheck="true">
		<div class="block">
			<div class="block-container">
				<h3 class="block-minorHeader">{{ phrase('mjst_online_viewers') }}</h3>
				<ul class="block-body block-row">
					<xf:contentcheck>
					<xf:foreach loop="$viewers" value="$viewer"><xf:if is="{$viewer.User.user_id} !== {$xf.visitor.user_id}">
						<li class="block-row">
							<div class="contentRow contentRow--alignMiddle">
								<div class="contentRow-figure">
									<xf:avatar user="$viewer.User" size="xs" />
								</div>
								<div class="contentRow-main">
									<h3 class="contentRow-title">
										<xf:if is="$viewer.User && $viewer.User.username">
											<xf:username user="$viewer.User" rich="true" />
										<xf:else />
											{{ phrase('guest') }}
										</xf:if>
									</h3>
								</div>
							</div>
						</li>
					</xf:if></xf:foreach>
					</xf:contentcheck>
				</ul>
			</div>
		</div>
		</xf:if>
	</xf:if>
</xf:sidebar>
<xf:widgetpos id="mjst_ticket_view_sidebar" context-ticket="{$ticket}" position="sidebar" />

<xf:page option="ldJsonHtml">
	<xf:if is="$ticket.User.avatar_highdpi">
		<xf:set var="$image">{$ticket.User.getAvatarUrl('h', null, true)}</xf:set>
	<xf:elseif is="$ticket.User.avatar_date" />
		<xf:set var="$image">{$ticket.User.getAvatarUrl('l', null, true)}</xf:set>
	<xf:elseif is="property('publicMetadataLogoUrl')" />
		<xf:set var="$image">{{ base_url(property('publicMetadataLogoUrl'), true) }}</xf:set>
	</xf:if>
	<xf:if is="$image">
		<script type="application/ld+json">
		{
			"@context": "https://schema.org",
			"@type": "DiscussionDepartmentPosting",
			"@id": "{{ link('canonical:support-tickets', $ticket)|escape('json') }}",
			"headline": "{$ticket.title|escape('json')}",
			"articleBody": "{$fpSnippet|escape('json')}",
			"articleSection": "{$ticket.Department.title|escape('json')}",
			"author": {
				"@type": "Person",
				"name": "{{ ($ticket.User ? $ticket.User.username : $ticket.username)|escape('json') }}"
			},
			"datePublished": "{{ date($ticket.open_date, 'Y-m-d')|escape('json') }}",
			"dateModified": "{{ date($ticket.last_message_date, 'Y-m-d')|escape('json') }}",
			"image": "{$image|escape('json')}",
			"interactionStatistic": {
				"@type": "InteractionCounter",
				"interactionType": "https://schema.org/ReplyAction",
				"userInteractionCount": {$ticket.reply_count}
			}
		}
		</script>
	</xf:if>
</xf:page>]]></template>
  <template type="public" title="mjst_ticket_watch" version_id="2010670" version_string="1.0.0"><![CDATA[<xf:if is="$isWatched">
	<xf:title>{{ phrase('mjst_unwatch_ticket') }}</xf:title>
<xf:else />
	<xf:title>{{ phrase('mjst_watch_ticket') }}</xf:title>
</xf:if>

<xf:breadcrumb source="$ticket.getBreadcrumbs()" />

<xf:form action="{{ link('support-tickets/watch', $ticket) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-body">
			<xf:if is="$isWatched">
				<xf:inforow rowtype="confirm">
					{{ phrase('mjst_you_sure_you_want_to_unwatch_this_ticket') }}
				</xf:inforow>

				<xf:hiddenval name="stop">1</xf:hiddenval>
			<xf:else />
				<xf:radiorow name="email_subscribe"
					value="{{ $xf.visitor.Option.interaction_watch_state == 'watch_email' ? 1 : 0}}"
					rowtype="noColon"
					label="{{ phrase('mjst_watch_this_ticket...') }}">

					<xf:option value="1">{{ phrase('and_receive_email_notifications') }}</xf:option>
					<xf:option value="0">{{ phrase('without_receiving_email_notifications') }}</xf:option>
				</xf:radiorow>
			</xf:if>
		</div>
		<xf:if is="$isWatched">
			<xf:submitrow submit="{{ phrase('unwatch') }}" rowtype="simple" />
		<xf:else />
			<xf:submitrow submit="{{ phrase('watch') }}" />
		</xf:if>
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_watched_departments_list" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_watched_ticket_departments') }}</xf:title>

<xf:css src="department_list.less" />

<xf:if is="$watchedDepartments is not empty">
	<xf:form action="{{ link('watched/ticket-departments/update') }}" ajax="true" class="block" autocomplete="off">

		<div class="block-outer">

			<div class="block-outer-opposite">
				<xf:button class="button--link menuTrigger" data-xf-click="menu" aria-expanded="false" aria-haspopup="true">{{ phrase('mjst_watched_ticket_departments') }}</xf:button>
				<div class="menu" data-menu="menu" aria-hidden="true">
					<div class="menu-content">
						<h3 class="menu-header">{{ phrase('mjst_watched_ticket_departments') }}</h3>
						<!--[XF:manage_menu:top]-->
						<a href="{{ link('watched/departments/manage', null, {'state': 'watch_no_email'}) }}" data-xf-click="overlay" class="menu-linkRow">{{ phrase('disable_email_notification') }}</a>
						<a href="{{ link('watched/departments/manage', null, {'state': 'delete'}) }}" data-xf-click="overlay" class="menu-linkRow">{{ phrase('mjst_stop_watching_ticket_departments') }}</a>
						<!--[XF:manage_menu:bottom]-->
					</div>
				</div>
			</div>
		</div>

		<div class="block-container">
			<div class="block-body">
				<xf:foreach loop="$departments" key="$id" value="$department">
					<xf:set var="$departmentWatch" value="{$watchedDepartments.{$department.department_id}}" />
					<xf:if is="$departmentWatch">
						<xf:set var="$bonusInfo">
							<ul class="listInline listInline--bullet">
								<xf:if is="$departmentWatch.notify_on == 'ticket'">
									<li>{{ phrase('mjst_new_tickets') }}</li>
								<xf:elseif is="$departmentWatch.notify_on == 'message'" />
									<li>{{ phrase('new_messages') }}</li>
								</xf:if>
								<xf:if is="$departmentWatch.send_alert"><li>{{ phrase('alerts') }}</li></xf:if>
								<xf:if is="$departmentWatch.send_email"><li>{{ phrase('emails') }}</li></xf:if>
							</ul>
						</xf:set>
						<xf:macro template="mjst_department_list_macros" name="department"
							arg-department="{$department}"
							arg-chooseName="department_ids"
							arg-bonusInfo="{$bonusInfo}" />
					</xf:if>
				</xf:foreach>
			</div>
			<div class="block-footer block-footer--split">
				<span class="block-footer-counter"></span>
				<span class="block-footer-select"><xf:checkbox standalone="true">
					<xf:option class="input--inline" check-all="< .block-container" label="{{ phrase('select_all') }}" />
				</xf:checkbox></span>
				<span class="block-footer-controls">
					<xf:select name="action" class="input--inline">
						<xf:option>{{ phrase('with_selected...') }}</xf:option>
						<!--[XF:action_menu:top]-->
						<xf:option value="email">{{ phrase('enable_email_notification') }}</xf:option>
						<xf:option value="no_email">{{ phrase('disable_email_notification') }}</xf:option>
						<xf:option value="alert">{{ phrase('enable_alerts') }}</xf:option>
						<xf:option value="no_alert">{{ phrase('disable_alerts') }}</xf:option>
						<xf:option value="delete">{{ phrase('stop_watching') }}</xf:option>
						<!--[XF:action_menu:bottom]-->
					</xf:select>
					<xf:button type="submit">{{ phrase('go') }}</xf:button>
				</span>
			</div>
		</div>
	</xf:form>
<xf:else />
	<div class="blockMessage">{{ phrase('mjst_you_not_watching_any_departments') }}</div>
</xf:if>]]></template>
  <template type="public" title="mjst_watched_departments_manage" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_manage_watched_departments') }}</xf:title>

<xf:form action="{{ link('watched/ticket-departments/manage', null, {'state': $state}) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-row">
			<xf:inforow rowtype="confirm">
				<xf:if is="$state == 'delete'">
					{{ phrase('mjst_you_sure_you_want_to_stop_watching_all_departments') }}
				<xf:else />
					{{ phrase('mjst_you_sure_you_want_to_update_notification_settings_for_all_departments') }}
				</xf:if>
			</xf:inforow>
		</div>
		<xf:submitrow submit="{{ phrase('proceed') }}" icon="notificationsOff" rowtype="simple" />
	</div>
</xf:form>]]></template>
  <template type="public" title="mjst_watched_tickets_list" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title page="{$page}">{{ phrase('mjst_watched_tickets') }}</xf:title>

<xf:if is="$tickets is not empty">
	<xf:form action="{{ link('watched/tickets/update') }}" ajax="true" class="block" autocomplete="off">
		<div class="block-outer">
			<xf:pagenav
				page="{$page}" perpage="{$perPage}" total="{$total}"
				link="watched/tickets"
				wrapperclass="block-outer-main" />
			<div class="block-outer-opposite">
				<xf:button class="button--link menuTrigger" data-xf-click="menu" aria-expanded="false" aria-haspopup="true">{{ phrase('mjst_manage_watched_tickets') }}</xf:button>
				<div class="menu" data-menu="menu" aria-hidden="true">
					<div class="menu-content">
						<h3 class="menu-header">{{ phrase('mjst_manage_watched_tickets') }}</h3>
						<!--[XF:manage_menu:top]-->
						<a href="{{ link('watched/tickets/manage', null, {'state': 'watch_no_email'}) }}" data-xf-click="overlay" class="menu-linkRow">{{ phrase('disable_email_notification') }}</a>
						<a href="{{ link('watched/tickets/manage', null, {'state': 'delete'}) }}" data-xf-click="overlay" class="menu-linkRow">{{ phrase('mjst_stop_watching_tickets') }}</a>
						<!--[XF:manage_menu:bottom]-->
					</div>
				</div>
			</div>
		</div>

		<div class="block-container">
			<div class="block-body">
				<div class="structItemContainer">
					<xf:foreach loop="$tickets" value="$ticket">
						<xf:set var="$extra" value="{{ {$ticket.Watch.{$xf.visitor.user_id}.email_subscribe} ? phrase('email') : '' }}" />
						<xf:macro template="mjst_ticket_list_macros" name="ticket"
							arg-ticket="{$ticket}"
							arg-chooseName="ticket_ids"
							arg-showWatched="{{ false }}"
							arg-extraInfo="{$extra}"
							arg-allowEdit="{{ false }}" />
					</xf:foreach>
				</div>
			</div>
			<div class="block-footer block-footer--split">
				<span class="block-footer-counter"></span>
				<span class="block-footer-select"><xf:checkbox standalone="true"><xf:option check-all="< .block-container" label="{{ phrase('select_all') }}" /></xf:checkbox></span>
				<span class="block-footer-controls">
						<xf:select name="state" class="input--inline">
						<xf:option>{{ phrase('with_selected...') }}</xf:option>
						<!--[XF:action_menu:top]-->
							<xf:option value="watch_email">{{ phrase('enable_email_notification') }}</xf:option>
							<xf:option value="watch_no_email">{{ phrase('disable_email_notification') }}</xf:option>
							<xf:option value="delete">{{ phrase('stop_watching') }}</xf:option>
						<!--[XF:action_menu:bottom]-->
					</xf:select>
					<xf:button type="submit">{{ phrase('go') }}</xf:button>
				</span>
			</div>
		</div>

		<xf:pagenav link="watched/tickets" page="{$page}" perpage="{$perPage}" total="{$total}"
			wrapperclass="block-outer block-outer--after" />

		<xf:showignored wrapperclass="block-outer block-outer-opposite block-outer--after" />
	</xf:form>
<xf:else />
	<div class="blockMessage">
		<xf:if is="$page > 1">
			{{ phrase('mjst_there_no_tickets_to_display') }}
		<xf:else />
			{{ phrase('mjst_you_not_watching_any_tickets') }}
		</xf:if>
	</div>
</xf:if>]]></template>
  <template type="public" title="mjst_watched_tickets_manage" version_id="3000030" version_string="3.0.0"><![CDATA[<xf:title>{{ phrase('mjst_manage_watched_tickets') }}</xf:title>

<xf:form action="{{ link('watched/tickets/manage', null, {'state': $state}) }}" class="block" ajax="true">
	<div class="block-container">
		<div class="block-row">
			<xf:inforow rowtype="confirm">
				<xf:if is="$state == 'delete'">
					{{ phrase('mjst_you_sure_you_want_to_stop_watching_all_tickets') }}
				<xf:else />
					{{ phrase('mjst_you_sure_you_want_to_update_notification_settings_for_all_tickets') }}
				</xf:if>
			</xf:inforow>
		</div>
		<xf:submitrow submit="{{ phrase('proceed') }}" icon="notificationsOff" rowtype="simple" />
	</div>
</xf:form>]]></template>
  <template type="public" title="search_form_support_ticket_message" version_id="3000134" version_string="3.0.1"><![CDATA[<xf:title>{{ phrase('mjst_search_support_tickets') }}</xf:title>

<xf:macro template="search_form_macros" name="keywords" arg-input="{$input}" />
<xf:macro template="search_form_macros" name="user" arg-input="{$input}" />
<xf:macro template="search_form_macros" name="date" arg-input="{$input}" />

<xf:numberboxrow name="c[min_reply_count]" value="{$input.c.min_reply_count|default(0)}" min="0"
	label="{{ phrase('minimum_number_of_replies') }}" />

<xf:if is="$prefixesGrouped is not empty">
	<xf:selectrow name="c[prefixes][]" size="7" multiple="true" value="{$input.c.prefixes|default([0])}"
		label="{{ phrase('prefixes') }}">

		<xf:option value="">{{ phrase('(any)') }}</xf:option>
		<xf:foreach loop="$prefixGroups" key="$groupId" value="$prefixGroup" if="{{ count($prefixesGrouped.{$groupId}) > 0 }}">
			<xf:optgroup label="{{ prefix_group('support_ticket', $groupId) }}">
				<xf:foreach loop="{$prefixesGrouped.{$groupId}}" key="$prefixId" value="$prefix">
					<xf:option value="{$prefixId}">{{ prefix_title('support_ticket', $prefixId) }}</xf:option>
				</xf:foreach>
			</xf:optgroup>
		</xf:foreach>
	</xf:selectrow>
</xf:if>

<xf:formrow rowtype="input"
	label="{{ phrase('mjst_search_in_departments') }}">

	<ul class="inputList">
		<li><xf:select name="c[departments][]" size="7" multiple="multiple" value="{$input.c.departments|default([0])}">
			<xf:option value="">{{ phrase('mjst_all_departments') }}</xf:option>
			<xf:foreach loop="$departments" value="$department">
				<xf:option value="{$department.department_id}">{$department.title}</xf:option>
			</xf:foreach>
		</xf:select></li>
	</ul>
</xf:formrow>

<xf:macro template="search_form_macros" name="order"
	arg-isRelevanceSupported="{$isRelevanceSupported}"
	arg-options="{{ {
		'replies': phrase('most_replies')
	} }}"
	arg-input="{$input}" />

<xf:macro template="search_form_macros" name="grouped"
	arg-label="{{ phrase('mjst_display_results_as_support_tickets') }}"
	arg-input="{$input}" />]]></template>
  <template type="public" title="search_result_support_ticket" version_id="3000332" version_string="3.0.3"><![CDATA[<li class="block-row block-row--separated {{ $ticket.isIgnored() ? 'is-ignored' : '' }} js-inlineModContainer" data-author="{{ $ticket.User.username ?: $ticket.username }}">
	<div class="contentRow">
		<span class="contentRow-figure">
			<xf:avatar user="{$ticket.User}" size="s" defaultname="{$ticket.username}" />
		</span>
		<div class="contentRow-main">
			<h3 class="contentRow-title">
				<a href="{{ link('support-tickets', $ticket) }}">{{ prefix('support_ticket', $ticket) . highlight($ticket.title, $options.term) }}</a>
			</h3>

			<div class="contentRow-snippet">{{ snippet($ticket.FirstMessage.message, 300, {'term': $options.term, 'stripQuote': true}) }}</div>

			<div class="contentRow-minor contentRow-minor--hideLinks">
				<ul class="listInline listInline--bullet">
					<xf:if is="$options.mod == 'ticket' && $ticket.canUseInlineModeration()">
						<li><xf:checkbox standalone="true">
							<xf:option value="{$ticket.ticket_id}" class="js-inlineModToggle"
								data-xf-init="tooltip"
								title="{{ phrase('select_for_moderation')|for_attr }}" />
						</xf:checkbox></li>
					</xf:if>
					<li><xf:username user="{$ticket.User}" defaultname="{$ticket.username}" /></li>
					<li>{{ phrase('mjst_ticket') }}</li>
					<li><xf:date time="{$ticket.open_date}" /></li>
					<li>{{ phrase('replies:') }} {$ticket.reply_count|number}</li>
					<li>{{ phrase('mjst_department:') }} <a href="{{ link('support-tickets/departments', $ticket.Department) }}">{$ticket.Department.title}</a></li>
				</ul>
			</div>
		</div>
	</div>
</li>]]></template>
  <template type="public" title="search_result_support_ticket_message" version_id="3000034" version_string="3.0.0"><![CDATA[<li class="block-row block-row--separated {{ $message.isIgnored() ? 'is-ignored' : '' }} js-inlineModContainer" data-author="{{ $message.User.username ?: $message.username }}">
	<div class="contentRow {{ !$message.isVisible() ? 'is-deleted' : '' }}">
		<span class="contentRow-figure">
			<xf:avatar user="{$message.User}" size="s" defaultname="{$message.username}" />
		</span>
		<div class="contentRow-main">
			<h3 class="contentRow-title">
				<a href="{{ link('support-tickets/message', $message.Ticket, {'message_id': $message.message_id}) }}">{{ prefix('support_ticket2', $message.Ticket) . highlight($message.Ticket.title, $options.term) }}</a>
			</h3>

			<div class="contentRow-snippet">{{ snippet($message.message, 300, {'term': $options.term, 'stripQuote': true}) }}</div>

			<div class="contentRow-minor contentRow-minor--hideLinks">
				<ul class="listInline listInline--bullet">
					<xf:if is="$options.mod == 'message' && $message.canUseInlineModeration()">
						<li><xf:checkbox standalone="true">
							<xf:option value="{$message.message_id}" class="js-inlineModToggle"
								data-xf-init="tooltip"
								title="{{ phrase('select_for_moderation')|for_attr }}" />
						</xf:checkbox></li>
					</xf:if>
					<li><xf:username user="{$message.User}" defaultname="{$message.username}" /></li>
					<li>{{ phrase('mjst_message_x', {'position': number($message.position + 1)}) }}</li>
					<li><xf:date time="{$message.message_date}" /></li>
					<li>{{ phrase('mjst_department:') }} <a href="{{ link('support-tickets/departments', $message.Ticket.Department) }}">{$message.Ticket.Department.title}</a></li>
				</ul>
			</div>
		</div>
	</div>
</li>]]></template>
</templates>
