<?xml version="1.0" encoding="utf-8"?>
<template_modifications>
  <modification type="public" template="forum_post_thread" modification_key="SimilarThreads_forum_post_thread_2" description="SimilarThreads_forum_post_thread_2" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<div class="js-inlineNewPostFields">]]></find>
    <replace><![CDATA[<xf:if is="{$xf.options.similarThreadsShowPostThread}">
<xf:css src="andy_similarthreads.less" />
<xf:js>
!function($, window, document, _undefined)
{
	$(document).ready(function()
	{
		var pathname = $(location).attr('href');
		var url = pathname.replace('post-thread','similarthreads');		

		$("#title").keyup(function() 
		{ 
			currentTitle = $('#title').val();
			$.ajax(
			{
				type: "POST",
				url: url,
				data: { 
					'title': currentTitle,
					_xfToken: XF.config.csrf
				},
				dataType: "html",
				timeout: 500,
				success: function(data) 
				{
					$(data).find('.similarthreads-wrapper').each(function()
					{
						$('#similarthreads-result').empty();
						$('#similarthreads-result').append($(this).html());
						$('#similarthreads-result').slideDown("slow");
					});
				},
				error: function(request, status, err) 
				{
					if(status != "success") {
						$('#similarthreads-result').slideUp("slow");
						$('#similarthreads-result').empty();
					}
				}
			});	
		});
	});	
}
(jQuery, this, document);
</xf:js>

<div id="similarthreads-result"></div>
</xf:if>
$0]]></replace>
  </modification>
  <modification type="public" template="forum_post_thread" modification_key="SimilarThreads_forum_post_thread_1" description="SimilarThreads_forum_post_thread_1" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[maxlength="{{ max_length('XF:Thread', 'title') }}"]]></find>
    <replace><![CDATA[$0
id="title"
autocomplete="off"]]></replace>
  </modification>
  <modification type="public" template="prefix_input" modification_key="SimilarThreads_prefix_input" description="SimilarThreads_prefix_input" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<xf:macro name="template">]]></find>
    <replace><![CDATA[<xf:if is="{$xf.options.similarThreadsShowPostThreadQuickThread}">
<xf:css src="andy_similarthreads.less" />
<xf:js>
!function($, window, document, _undefined)
{
	$(document).ready(function()
	{
		var pathname = $(location).attr('href');
		var n = pathname.indexOf("post-thread");

		if (n == -1)
		{
			var url = pathname + 'similarthreads';
		}

		$("#title").keyup(function() 
		{ 
			currentTitle = $('#title').val();
			$.ajax(
			{
				type: "POST",
				url: url,
				data: { 
					'title': currentTitle,
					_xfToken: XF.config.csrf
				},
				dataType: "html",
				timeout: 500,
				success: function(data) 
				{
					$(data).find('.similarthreads-wrapper').each(function()
					{
						$('#similarthreads-result').empty();
						$('#similarthreads-result').append($(this).html());
						$('#similarthreads-result').slideDown("slow");
					});
				},
				error: function(request, status, err) 
				{
					if(status != "success") {
						$('#similarthreads-result').slideUp("slow");
						$('#similarthreads-result').empty();
					}
				}
			});	
		});
	});	
}
(jQuery, this, document);
function similarThreadsClose() {
	$('#similarthreads-result').slideUp("slow");
	$('#similarthreads-result').empty();
}
</xf:js>

<div id="similarthreads-result"></div>
</xf:if>
$0]]></replace>
  </modification>
  <modification type="public" template="thread_list_macros" modification_key="SimilarThreads_thread_list_macros" description="SimilarThreads_thread_list_macros" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[placeholder="{$forum.thread_prompt}"]]></find>
    <replace><![CDATA[$0
id="title"
onblur="setTimeout(similarThreadsClose, 1000)"]]></replace>
  </modification>
  <modification type="public" template="thread_view" modification_key="SimilarThreads_thread_view_2" description="SimilarThreads_thread_view_2" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<xf:macro name="thread_status" arg-thread="!" arg-wrapperClass="">]]></find>
    <replace><![CDATA[<xf:if is="{$xf.options.similarThreadsShowBelowQuickReply}">
	<xf:include template="andy_similarthreads" />
</xf:if>
$0]]></replace>
  </modification>
  <modification type="public" template="thread_view" modification_key="SimilarThreads_thread_view_1" description="SimilarThreads_thread_view_1" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[				<xf:if is="$post.message_state == 'deleted'">
					<xf:macro template="post_macros" name="post_deleted"
						arg-post="{$post}"
						arg-thread="{$thread}" />
				<xf:else />
					<xf:macro template="post_macros" name="post"
						arg-post="{$post}"
						arg-thread="{$thread}" />
				</xf:if>]]></find>
    <replace><![CDATA[$0
<xf:if is="{$xf.options.similarThreadsShowBelowFirstPost}">
	<xf:if is="{{ number($post.position + 1) }} == 1">
		<xf:include template="andy_similarthreads" />
	</xf:if>
</xf:if>]]></replace>
  </modification>
</template_modifications>
