!function(c,b,a,d){XF.SiropuShoutbox=XF.Element.newHandler({options:{lastId:0,refreshInterval:0,loadMore:0,lastActive:0,reverse:false,collapsed:false,sound:"on"},audio:"",init:function(){if(!this.options.collapsed){this.startRefreshInterval()}if(this.options.sound=="on"){this.loadAudio()}var f=this;var e=this.$target.find(".siropuShoutboxShouts");if(f.options.reverse){e.scrollTop(100000)}c(a).on("shoutbox:sound-on",function(){f.soundOn()});c(a).on("shoutbox:sound-off",function(){f.soundOff()});c(a).on("shoutbox:toggle-reverse",function(j,h){var i=f.options.loadMore;e.html("");f.options.reverse=h;f.options.loadMore=0;f.options.lastId=0;f.refresh(false);setTimeout(function(){f.options.loadMore=i},1000)});c(a).on("shoutbox:collapse",function(){f.stopRefreshInterval()});c(a).on("shoutbox:expand",function(){if(e.find("> li:not([data-id])").length){f.refresh(false)}f.startRefreshInterval()});c(a).on("shoutbox:submit",function(j){var h=c(this).find('input[name="shout"]');var i=h.val().trim();if(!i){return h.focus()}h.val("").attr("placeholder",XF.phrase("siropu_shoutbox_please_wait")).prop("disabled",true);f.stopRefreshInterval();XF.ajax("POST",XF.canonicalizeUrl("index.php?shoutbox/submit"),{last_id:f.options.lastId,shout:i},function(k){f.update(k);f.startRefreshInterval();f.options.lastActive=k.time;if(k.prune){e.find("li[data-id]").not(e.find('li[data-id="'+k.lastId+'"]')).remove()}},{global:false});setTimeout(function(){h.prop("disabled",false).attr("placeholder",XF.phrase("siropu_shoutbox_placeholder")).focus()},1000)});this.$target.on("mouseover mouseout",".siropuShoutboxShouts > li[data-id]",function(){c(this).find('a[data-xf-click="overlay"]').toggle()});var g=false;e.on("scroll",function(){var l=c(this)[0].scrollHeight-c(this).innerHeight();var j=parseInt(c(this).scrollTop());if(f.options.loadMore&&!g&&(!f.options.reverse&&(j==l||j+1==l||j-1==l)||f.options.reverse&&j==0)){g=true;var k=c(this).find("> li:"+(f.options.reverse?"first":"last")).data("id");var i=c('<div class="siropuShoutboxLoadingMoreShouts" />');i.html('<i class="fa fa-cog fa-spin"></i> '+XF.phrase("siropu_shoutbox_loading_more_shouts"));if(f.options.reverse){i.addClass("siropuShoutboxReverse").insertBefore(c(this))}else{i.insertAfter(c(this))}var h=c(this).parents().find(".siropuShoutboxLoadingMoreShouts");setTimeout(function(){h.fadeOut();h.remove()},1000);XF.ajax("POST",XF.canonicalizeUrl("index.php?shoutbox/load-more"),{last_id:k},function(m){if(m.html&&m.html.content){XF.setupHtmlInsert(m.html,function(n,o,p){if(f.options.reverse){e.prepend(n)}else{e.append(n)}})}else{f.options.loadMore=0}g=false})}})},update:function(h,g){var f=this;var e=this.$target.find(".siropuShoutboxShouts");if(h.html&&h.html.content){XF.setupHtmlInsert(h.html,function(i,l,m){var j=c.grep(i,function(n){return e.find('li[data-id="'+c(n).data("id")+'"]').length?false:true});var k=e.find("> li:not([data-id])");if(k.length){k.remove()}if(f.options.reverse){c(j).appendTo(e);c(j).show();e.scrollTop(100000)}else{c(j).hide();c(j).prependTo(e);c(j).slideDown()}if(g===undefined){f.playSound()}})}if(h.lastId){f.setLastId(h.lastId)}if(h.time-f.options.lastActive>=600){f.stopRefreshInterval()}},refresh:function(f){var e=this;XF.ajax("POST",XF.canonicalizeUrl("index.php?shoutbox/refresh"),{last_id:e.options.lastId},function(g){e.update(g,f)},{global:false})},startRefreshInterval:function(){if(this.options.refreshInterval){this.refreshSet=setInterval(c.proxy(this,"refresh"),this.options.refreshInterval)}},stopRefreshInterval:function(){clearInterval(this.refreshSet)},setLastId:function(f,e){this.options.lastId=f;if(this.$target){this.$target.attr("data-last-id",f)}},loadAudio:function(){this.audio=new Audio("styles/default/siropu/shoutbox/new.mp3")},soundOn:function(){this.$target.attr("data-sound","on");this.options.sound="on";if(!this.audio){this.loadAudio()}},soundOff:function(){this.$target.attr("data-sound","off");this.options.sound="off"},playSound:function(){if(this.options.sound=="on"){this.audio.play()}}});XF.SiropuShoutboxToggleSound=XF.Click.newHandler({eventNameSpace:"siropuShoutboxToggleSound",options:{},init:function(){},click:function(){var e=c('.siropuShoutbox a[data-xf-click="siropu-shoutbox-toggle-sound"] .fa');if(e.hasClass("fa-volume-up")){c(a).trigger("shoutbox:sound-off");e.removeClass("fa-volume-up").addClass("fa-volume-off");XF.Cookie.set("siropuShoutboxNoSound",true)}else{c(a).trigger("shoutbox:sound-on");e.removeClass("fa-volume-off").addClass("fa-volume-up");XF.Cookie.remove("siropuShoutboxNoSound")}}});XF.SiropuShoutboxToggleDirection=XF.Click.newHandler({eventNameSpace:"SiropuShoutboxToggleDirection",options:{},init:function(){},click:function(){var f=c('.siropuShoutbox a[data-xf-click="siropu-shoutbox-toggle-direction"] .fa');var g=c(".siropuShoutbox form");var e=c(".siropuShoutboxShouts");g.remove();if(f.hasClass("fa-arrow-down")){g.insertAfter(e);f.removeClass("fa-arrow-down").addClass("fa-arrow-up");XF.Cookie.set("siropuShoutboxReverse",1);c(a).trigger("shoutbox:toggle-reverse",true)}else{g.insertBefore(e);f.removeClass("fa-arrow-up").addClass("fa-arrow-down");XF.Cookie.set("siropuShoutboxReverse",0);c(a).trigger("shoutbox:toggle-reverse",false)}g.toggleClass("siropuShoutboxReverse");XF.activate(g)}});XF.SiropuShoutboxToggleVisibility=XF.Click.newHandler({eventNameSpace:"siropuShoutboxToggleVisibility",options:{},init:function(){},click:function(){var e=c('.siropuShoutbox a[data-xf-click="siropu-shoutbox-toggle-visibility"] .fa');if(e.hasClass("fa-minus")){c(a).trigger("shoutbox:collapse");e.removeClass("fa-minus").addClass("fa-plus");XF.Cookie.set("siropuShoutboxCollapsed",true)}else{c(a).trigger("shoutbox:expand");e.removeClass("fa-plus").addClass("fa-minus");XF.Cookie.remove("siropuShoutboxCollapsed")}c(".siropuShoutbox .block-body").toggle()}});XF.SiropuShoutboxEdit=XF.Element.newHandler({options:{},init:function(){this.$target.on("ajax-submit:response",c.proxy(this,"ajaxResponse"))},ajaxResponse:function(g,f){c(".siropuShoutboxShouts > li[data-id="+f.shout_id+"]").find("> span").html(f.shout_message)}});XF.SiropuShoutboxDelete=XF.Element.newHandler({options:{},init:function(){this.$target.on("ajax-submit:response",c.proxy(this,"ajaxResponse"))},ajaxResponse:function(g,f){c(".siropuShoutboxShouts > li[data-id="+f.shout_id+"]").fadeOut()}});XF.SiropuShoutboxSubmit=XF.Element.newHandler({options:{},init:function(){this.$target.on("submit",function(f){f.preventDefault();c(a).trigger("shoutbox:submit")})}});XF.Element.register("siropu-shoutbox","XF.SiropuShoutbox");XF.Element.register("siropu-shoutbox-submit","XF.SiropuShoutboxSubmit");XF.Element.register("siropu-shoutbox-edit-shout","XF.SiropuShoutboxEdit");XF.Element.register("siropu-shoutbox-delete-shout","XF.SiropuShoutboxDelete");XF.Click.register("siropu-shoutbox-toggle-sound","XF.SiropuShoutboxToggleSound");XF.Click.register("siropu-shoutbox-toggle-direction","XF.SiropuShoutboxToggleDirection");XF.Click.register("siropu-shoutbox-toggle-visibility","XF.SiropuShoutboxToggleVisibility")}(jQuery,window,document);